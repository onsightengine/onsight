/**
 * @description Salinity Engine
 * @about       Easy to use JavaScript game engine.
 * @author      Stephens Nunnally <@stevinz>
 * @version     v0.0.6
 * @license     MIT - Copyright (c) 2024 Stephens Nunnally
 * @source      https://github.com/salinityengine/engine
 */
import*as THREE$1 from"three";import{mergeGeometries}from"three/addons/utils/BufferGeometryUtils.js";import{EffectComposer}from"three/addons/postprocessing/EffectComposer.js";import{ClearPass}from"three/addons/postprocessing/ClearPass.js";import{RenderPass}from"three/addons/postprocessing/RenderPass.js";import{ShaderPass}from"three/addons/postprocessing/ShaderPass.js";import{SVGLoader}from"three/addons/loaders/SVGLoader.js";import{LineMaterial}from"three/addons/lines/LineMaterial.js";import{Wireframe}from"three/addons/lines/Wireframe.js";import{WireframeGeometry2}from"three/addons/lines/WireframeGeometry2.js";import{Line2}from"three/addons/lines/Line2.js";import{LineGeometry}from"three/addons/lines/LineGeometry.js";import{LineSegmentsGeometry}from"three/addons/lines/LineSegmentsGeometry.js";import{Pass,FullScreenQuad}from"three/addons/postprocessing/Pass.js";import{LoopSubdivision}from"three-subdivide";import{RoundedBoxGeometry}from"three/addons/geometries/RoundedBoxGeometry.js";import{SimplifyModifier}from"three/addons/modifiers/SimplifyModifier.js";import RAPIER from"rapier";import{ConvexGeometry}from"three/addons/geometries/ConvexGeometry.js";import{CopyShader}from"three/addons/shaders/CopyShader.js";import{UnrealBloomPass}from"three/addons/postprocessing/UnrealBloomPass.js";import{ColorifyShader}from"three/addons/shaders/ColorifyShader.js";import{SobelOperatorShader}from"three/addons/shaders/SobelOperatorShader.js";const VERSION="0.0.6",APP_SIZE=1e3,APP_EVENTS=["init","update","destroy","keydown","keyup","pointerdown","pointerup","pointermove"],APP_ORIENTATION={PORTRAIT:"portrait",LANDSCAPE:"landscape"},LAYERS={BASE:0,BLOOM:30},WORLD_TYPES={World2D:"World2D",World3D:"World3D",WorldUI:"WorldUI"},SCRIPT_FORMAT={JAVASCRIPT:"js",PYTHON:"python"},MESH_REBUILD_TYPES=["geometry","material","palette","shape","texture"],_lut=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];class Maths{static radiansToDegrees(e){return e*(180/Math.PI)}static degreesToRadians(e){return Math.PI/180*e}static clamp(e,t,i){return(e=Number(e))<t&&(e=t),e>i&&(e=i),e}static damp(e,t,i,n){return Maths.lerp(e,t,1-Math.exp(-i*n))}static lerp(e,t,i){return(1-i)*e+i*t}static roundTo(e,t=0){const i=Math.pow(10,t);return Math.round(e*i)/i}static fuzzyFloat(e,t,i=.001){return e<t+i&&e>t-i}static fuzzyVector(e,t,i=.001){return!1!==Maths.fuzzyFloat(e.x,t.x,i)&&(!1!==Maths.fuzzyFloat(e.y,t.y,i)&&!1!==Maths.fuzzyFloat(e.z,t.z,i))}static fuzzyQuaternion(e,t,i=.001){return!1!==Maths.fuzzyVector(e,t,i)&&!1!==Maths.fuzzyFloat(e.w,t.w,i)}static isPowerOfTwo(e){return!(e&e-1)&&0!==e}static addCommas(e){return e.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")}static countDecimals(e){return Math.floor(e.valueOf())===e.valueOf()?0:e.toString().split(".")[1].length||0}static isNumber(e){return null!=e&&"number"==typeof e&&!Number.isNaN(e)&&Number.isFinite(e)}static noZero(e,t=1e-5){return t=Math.abs(t),(e=Maths.sanity(e))>=0&&e<t&&(e=t),e<0&&e>-1*t&&(e=-1*t),e}static sanity(e){return isNaN(e)&&(e=0),e}static lineCollision(e,t,i,n,s,a,o,r){let c=(r-a)*(i-e)-(o-s)*(n-t);if(Maths.fuzzyFloat(c,0,1e-7))return!1;let l=((o-s)*(t-a)-(r-a)*(e-s))/c,d=((i-e)*(t-a)-(n-t)*(e-s))/c;return l>=0&&l<=1&&d>=0&&d<=1}static lineRectCollision(e,t,i,n,s,a,o,r){const c=Maths.lineCollision(e,t,i,n,s,a,s,r),l=Maths.lineCollision(e,t,i,n,o,a,o,r),d=Maths.lineCollision(e,t,i,n,s,a,o,a),h=Maths.lineCollision(e,t,i,n,s,r,o,r);return c||l||d||h}static randomFloat(e,t){return e+Math.random()*(t-e)}static randomInt(e=0,t=1){return e+Math.floor(Math.random()*(t-e))}static uuid(){if(window.crypto&&window.crypto.randomUUID)return crypto.randomUUID();const e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,i=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return(_lut[255&e]+_lut[e>>8&255]+_lut[e>>16&255]+_lut[e>>24&255]+"-"+_lut[255&t]+_lut[t>>8&255]+"-"+_lut[t>>16&15|64]+_lut[t>>24&255]+"-"+_lut[63&i|128]+_lut[i>>8&255]+"-"+_lut[i>>16&255]+_lut[i>>24&255]+_lut[255&n]+_lut[n>>8&255]+_lut[n>>16&255]+_lut[n>>24&255]).toLowerCase()}}class Strings{static addSpaces(e){return"string"!=typeof e&&(e=String(e)),(e=(e=e.replace(/([a-z])([A-Z])/g,"$1 $2")).replace(/([A-Z])([A-Z][a-z])/g,"$1 $2")).trim()}static capitalize(e){const t=String(e).split(" ");for(let e=0;e<t.length;e++)t[e]=t[e][0].toUpperCase()+t[e].substring(1);return t.join(" ")}static countDigits(e){return parseFloat(e).toString().length}static escapeHTML(e){return null==e?e:e.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}static nameFromUrl(e,t=!0){let i=new String(e.replace(/^.*[\\\/]/,""));return i=i.replace(/\.[^/.]+$/,""),t&&(i=Strings.capitalize(i)),i}}class System{static isIterable(e){return null!=e&&"function"==typeof e[Symbol.iterator]}static isObject(e){return"object"==typeof e&&!Array.isArray(e)&&null!==e}static swapArrayItems(e,t,i){return e[t]=e.splice(i,1,e[t])[0],e}static save(e,t){try{const i=document.createElement("a");document.body.appendChild(i),i.href=e,i.download=t||"data.json",i.click(),setTimeout((function(){document.body.removeChild(i),window.URL.revokeObjectURL(e)}),0)}catch(e){return void console.warn(e)}}static saveBuffer(e,t,i={type:"application/octet-stream"}){let n=URL.createObjectURL(new Blob([e],{type:i}));System.save(n,t)}static saveImage(e,t){System.save(e,t)}static saveString(e,t){let i=URL.createObjectURL(new Blob([e],{type:"text/plain"}));System.save(i,t)}static detectOS(){let e={Android:["android"],iOS:["iphone","ipad","ipod","ios"],Linux:["linux","x11","wayland"],Mac:["mac","darwin","osx","os x"],Win:["win"]},t=window.navigator.userAgent,i=window.navigator.userAgentData,n=i?i.platform:t;n=n.toLowerCase();for(let t in e)for(let i of e[t])if(-1!==n.indexOf(i))return t;return"Unknown OS"}static fullscreen(e){if(document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement){let e=document;(e.cancelFullScreen||e.exitFullscreen||e.webkitCancelFullScreen||e.webkitExitFullscreen||e.mozCancelFullScreen).call(e)}else{let t=e??document.body;(t.requestFullScreen||t.webkitRequestFullScreen||t.mozRequestFullScreen||t.msRequestFullScreen).call(t)}}static metaKeyOS(){return"Mac"===System.detectOS()?"⌘":"⌃"}static sleep(e){const t=Date.now();let i=t;for(;i-t<e;)i=Date.now()}static waitForObject(e="",t,i,n=100,s=-1,a=5e3){let o=Date.now(),r=Date.now();!function c(){s>0&&Date.now()-o>s?console.info(`Operation: ${e} timed out`):(a>0&&Date.now()-r>a&&(console.info(`Still waiting on operation: ${e}`),r=Date.now()),t&&"function"==typeof t&&!t()?setTimeout(c,n):i&&"function"==typeof i&&i())}()}}const _registered={};class ComponentManager{static defaultValue(e){switch(e){case"select":case"asset":case"divider":return null;case"number":case"int":case"angle":case"slider":return 0;case"variable":return[0,0];case"vector":return[0];case"option":return[!1];case"boolean":return!1;case"color":return 16777215;case"string":case"key":return"";case"object":return{};default:console.warn(`ComponentManager.defaultValue(): Unknown property type: '${e}'`)}return null}static registered(e=""){const t=_registered[e];return t||console.warn(`ComponentManager.registered: Component '${e}' not registered'`),t}static registeredTypes(){return Object.keys(_registered)}static register(e="",t){if(e=e.toLowerCase(),_registered[e])return console.warn(`ComponentManager.register: Component '${e}' already registered`);System.isObject(t.config)||(t.config={}),System.isObject(t.config.schema)||(t.config.schema={});const i=t.config.schema;for(const e in i){const t=Array.isArray(i[e])?i[e]:[i[e]];for(const e of t){if(void 0===e.type)console.warn("ComponentManager.register(): All schema properties require a 'type' value");else if("divider"===e.type)continue;void 0===e.default&&(e.default=ComponentManager.defaultValue(e.type)),void 0!==e.proMode&&(e.promode=e.proMode)}}_registered[e]=class extends t{constructor(){super(),this.isComponent=!0,this.type=e,this.attached=!0,this.expanded=!0,this.order=0,this.tag="",this.entity=null,this.backend=void 0,this.data={}}init(e={}){this.dispose(),"function"==typeof super.init&&super.init(e)}dispose(){"function"==typeof super.dispose&&super.dispose(),"object"==typeof this.backend&&"function"==typeof this.backend.dispose&&this.backend.dispose(),this.backend=void 0}attach(){this.attached=!0,"function"==typeof super.attach&&super.attach()}detach(){this.attached=!1,"function"==typeof super.detach&&super.detach()}defaultData(){const e={};for(let t=0,i=arguments.length;t<i;t+=2)e[arguments[t]]=arguments[t+1];return ComponentManager.sanitizeData(this.type,e),e.base={isComponent:!0,attached:this.attached,expanded:this.expanded,order:this.order,tag:this.tag,type:this.type},e}toJSON(){let e;e=this.data&&this.data.style?this.defaultData("style",this.data.style):this.defaultData();for(const t in e)void 0!==this.data[t]&&(this.data[t]&&this.data[t].isTexture?e[t]=this.data[t].uuid:e[t]=structuredClone(this.data[t]));return e}}}static includeData(e,t,i=void 0){for(const n in e.if){const s=Array.isArray(e.if[n])?e.if[n]:[e.if[n]];let a=!1,o=!1;for(const e of s)a=a||t[n]===e,o=!(!o&&void 0!==i)||i[n]===e;if(!a||!o)return!1}for(const n in e.not){const s=Array.isArray(e.not[n])?e.not[n]:[e.not[n]];let a=!1,o=!1;for(const e of s)a=a||t[n]===e,o=!o&&void 0!==i&&i[n]===e;if(a||o)return!1}return!0}static sanitizeData(e,t){t&&"object"==typeof t||(t={});const i=ComponentManager.registered(e);if(!i||!i.config||!i.config.schema)return;const n=i.config.schema;if(System.isObject(n))for(const e in n){const i=Array.isArray(n[e])?n[e]:[n[e]];let s;for(const e of i)if("divider"!==e.type&&ComponentManager.includeData(e,t)){s=e;break}if(void 0!==s){if(void 0===t[e]&&(Array.isArray(s.default)?t[e]=[...s.default]:"object"==typeof s.default?t[e]=structuredClone(s.default):t[e]=s.default),Maths.isNumber(t[e])){const i=s.min??-1/0,n=s.max??1/0;t[e]<i&&(t[e]=i),t[e]>n&&(t[e]=n)}}else delete t[e]}}static stripData(e,t,i){const n=ComponentManager.registered(e);if(!n||!n.config||!n.config.schema)return;const s=n.config.schema;if(System.isObject(s))for(const e in s){let n=!1;const a=Array.isArray(s[e])?s[e]:[s[e]];for(const e of a)if("divider"!==e.type&&ComponentManager.includeData(e,t,i)){n=!0;break}!0!==n&&delete i[e]}}}class Vectors{static absolute(e){return e.x=Math.abs(e.x),e.y=Math.abs(e.y),e.z=Math.abs(e.z),e}static isNaN(e){return!!isNaN(e.x)||(!!isNaN(e.y)||(!!isNaN(e.z)||!(null==e.w||!isNaN(e.w))))}static noZero(e,t=.001){return t=Math.abs(t),Vectors.sanity(e),e.x>=0&&e.x<t&&(e.x=t),e.y>=0&&e.y<t&&(e.y=t),e.z>=0&&e.z<t&&(e.z=t),e.x<0&&e.x>-1*t&&(e.x=-1*t),e.y<0&&e.y>-1*t&&(e.y=-1*t),e.z<0&&e.z>-1*t&&(e.z=-1*t),e}static printOut(e,t=""){return""!==t&&(t+=" - "),console.info(`${t}X: ${e.x}, Y: ${e.y}, Z: ${e.z}`),e}static round(e,t=0){const i=Math.pow(10,t);return e.x=Math.round(e.x*i)/i,e.y=Math.round(e.y*i)/i,e.z=Math.round(e.z*i)/i,e}static sanity(e){return isNaN(e.x)&&(e.x=0),isNaN(e.y)&&(e.y=0),isNaN(e.z)&&(e.z=0),null!=e.w&&isNaN(e.w)&&(e.w=1),e}}const _boxCenter=new THREE$1.Box3,_tempMatrix=new THREE$1.Matrix4,_tempVector=new THREE$1.Vector3,_startQuaternion=new THREE$1.Quaternion,_tempQuaternion=new THREE$1.Quaternion,_testQuaternion=new THREE$1.Quaternion,_objPosition$2=new THREE$1.Vector3,_objQuaternion$2=new THREE$1.Quaternion,_objRotation=new THREE$1.Euler,_objScale$2=new THREE$1.Vector3,_tempBounds=new THREE$1.Box3,_tempScale$1=new THREE$1.Vector3;class ObjectUtils{static childByProperty(e,t,i){for(const n of e.children)if(n[t]===i)return n}static clearObject(e,t=!0){if(e&&e.isObject3D){for(e.geometry&&"function"==typeof e.geometry.dispose&&e.geometry.dispose(),e.material&&ObjectUtils.clearMaterial(e.material),e.dispose&&"function"==typeof e.dispose&&e.dispose();e.children.length>0;)ObjectUtils.clearObject(e.children[0],!0);ObjectUtils.resetTransform(e),t&&e.removeFromParent(),e=null}}static clearMaterial(e){if(e){e=Array.isArray(e)?e:[...arguments];for(const t of e){const e=Object.keys(t);for(const i of e){const e=t[i];e&&"function"==typeof e.dispose&&e.dispose()}"function"==typeof t.dispose&&t.dispose()}}}static compareQuaternions(e){(e=Array.isArray(e)?e:[...arguments])[0].getWorldQuaternion(_startQuaternion);for(let t=1;t<e.length;t++)if(e[t].getWorldQuaternion(_testQuaternion),!1===Maths.fuzzyQuaternion(_startQuaternion,_testQuaternion))return!1;return!0}static computeBounds(e,t,i=!1){if(t&&!0===t.isBox3||(t=new THREE$1.Box3),t.makeEmpty(),e=Array.isArray(e)?e:[e],i&&1===ObjectUtils.countGeometry(e)){let i;for(const t of e)t.traverse((e=>{e.geometry&&(i=e)}));if(i&&i.geometry)return i.geometry.computeBoundingBox(),t.copy(i.geometry.boundingBox),i.matrixWorld.decompose(_objPosition$2,_objQuaternion$2,_objScale$2),_objQuaternion$2.identity(),_tempMatrix.compose(_objPosition$2,_objQuaternion$2,_objScale$2),t.applyMatrix4(_tempMatrix),t}for(const i of e)t.expandByObject(i);return t}static computeCenter(e,t){if(e=Array.isArray(e)?e:[e],ObjectUtils.computeBounds(e,_boxCenter),_boxCenter.isEmpty())for(const t of e)t.getWorldPosition(_tempVector),_boxCenter.expandByPoint(_tempVector);return _boxCenter.getCenter(t),t}static containsObject(e,t){if(t&&t.uuid&&Array.isArray(e))for(const i of e)if(i.uuid&&i.uuid===t.uuid)return!0;return!1}static copyTransform(e,t){t.position.copy(e.position),t.rotation.order=e.rotation.order,t.quaternion.copy(e.quaternion),t.scale.copy(e.scale),t.matrix.copy(e.matrix),t.matrixWorld.copy(e.matrixWorld)}static copyWorldTransform(e,t,i=!0){e.updateWorldMatrix(!0,!1),e.matrixWorld.decompose(t.position,_tempQuaternion,t.scale),Vectors.sanity(_tempQuaternion),t.rotation.setFromQuaternion(_tempQuaternion,void 0,!1),t.quaternion.setFromEuler(t.rotation,!1),i&&(t.updateMatrix(),t.updateMatrixWorld(!0))}static countGeometry(e){e=Array.isArray(e)?e:[e];let t=0;for(const i of e)i.traverse((e=>{e.geometry&&t++}));return t}static flattenGroup(e){if(e&&e.parent){for(;e.children;)e.parent.attach(e.children[0]);ObjectUtils.clearObject(e,!0)}}static identityBoundsCalculate(e,t){return t=t??new THREE$1.Vector3,_tempScale$1.copy(e.scale),e.scale.set(1,1,1),e.updateMatrixWorld(!0),ONE.ObjectUtils.computeBounds(e,_tempBounds,!0),_tempBounds.getSize(t),e.scale.copy(_tempScale$1),e.updateMatrixWorld(!0),t}static resetTransform(e){e.position.set(0,0,0),e.rotation.set(0,0,0),e.quaternion.set(0,0,0,1),e.scale.set(1,1,1),e.updateMatrix(),e.updateMatrixWorld(!0)}static uuidArray(e){e=Array.isArray(e)?e:[...arguments];const t=[];for(const i of e)"object"==typeof i&&i.uuid&&t.push(i.uuid);return t}}const _m1=new THREE$1.Matrix4,_camPosition$2=new THREE$1.Vector3,_camQuaternion$1=new THREE$1.Quaternion,_camRotation$1=new THREE$1.Euler,_camScale$1=new THREE$1.Vector3,_lookQuaternion=new THREE$1.Quaternion,_lookUpVector=new THREE$1.Vector3,_objPosition$1=new THREE$1.Vector3,_objScale$1=new THREE$1.Vector3,_objQuaternion$1=new THREE$1.Quaternion,_parentQuaternion=new THREE$1.Quaternion,_parentQuaternionInv=new THREE$1.Quaternion,_rotationQuaternion$1=new THREE$1.Quaternion,_rotationQuaternionInv=new THREE$1.Quaternion,_worldPosition$1=new THREE$1.Vector3,_worldQuaternion$1=new THREE$1.Quaternion,_worldScale$1=new THREE$1.Vector3,_worldRotation=new THREE$1.Euler;class Entity3D extends THREE$1.Object3D{constructor(e="Entity"){super(),this.name=e,this.castShadow=!0,this.receiveShadow=!0,this.isEntity=!0,this.isEntity3D=!0,this.type="Entity3D",this.locked=!1,this.lookAtCamera=!1,this.lookAtYOnly=!1,this.bloom=!1,this.category=null,this.components=[]}componentGroup(){return"Entity3D"}addComponent(e,t={},i=!0){const n=ComponentManager.registered(e);if(void 0===n)return;const s=n.config;let a=this.getComponent(e);if(a&&!n.config.multiple||(a=new n,this.components.push(a)),s.dependencies&&i)for(const e of s.dependencies)null==this.getComponent(e)&&this.addComponent(e,{},!1);return ComponentManager.sanitizeData(e,t),a.detach(),a.entity=this,a.init(t),a.attach(),a}attachComponent(e){return this.components.push(e),e.detach(),e.entity=this,e.init(e.toJSON()),e.attach(),e}updateComponent(e,t={},i=0){const n=this.getComponentsWithProperties("type",e)[i];if(!n||!n.isComponent)return;const s=n.data??{};return Object.assign(s,t),ComponentManager.sanitizeData(e,s),this.detach(),this.init(s),this.attach(),n}replaceComponent(e,t={},i=0){const n=this.getComponentsWithProperties("type",e)[i];if(n&&n.isComponent)return ComponentManager.sanitizeData(e,t),n.detach(),n.init(t),n.attach(),n}getComponent(e,t){if(void 0===t)return this.getComponentByProperty("type",e);const i=this.getComponentsWithProperties("type",e,"tag",t);return i.length>0?i[0]:void 0}getComponentByTag(e){return this.getComponentByProperty("tag",e)}getComponentByType(e){return this.getComponentByProperty("type",e)}getComponentsByType(e){return this.getComponentsWithProperties("type",e)}getComponentByProperty(e,t){for(const i of this.components)if(i[e]===t)return i}getComponentsWithProperties(){const e=[];for(const t of this.components){let i=!0;for(let e=0;e<arguments.length;e+=2){const n=arguments[e+1];if(t[arguments[e]]!==n){i=!1;break}}i&&e.push(t)}return e}removeComponent(e){if(!e)return;const t=this.components.indexOf(e);if(-1!==t)return this.components.splice(t,1),e.detach(),e;console.warn(`Entity3D.removeComponent: Component ${e.uuid}, type '${e.type}' not found`)}rebuildComponents(){for(const e of this.components)e.detach(),e.init(e.toJSON()),e.attach();return this}traverseComponents(e){for(const t of this.components)if("function"==typeof e&&e(t))return}addEntity(e,t=-1,i=!1){return e&&e.isEntity3D?(-1!==this.children.indexOf(e)||(i&&e.parent?this.attach(e):this.add(e),-1!==t&&(this.children.splice(t,0,e),this.children.pop())),this):this}getEntities(){const e=[];for(const t of this.children)t&&t.isEntity3D&&(t.userData.flagIgnore||t.userData.flagHelper||e.push(t));return e}getEntityById(e){return this.getEntityByProperty("id",parseInt(e))}getEntityByName(e){return this.getEntityByProperty("name",e)}getEntityByUUID(e){return this.getEntityByProperty("uuid",e)}getEntityByProperty(e,t){if(this[e]===t)return this;for(const i of this.getEntities()){const n=i.getEntityByProperty(e,t);if(n)return n}}removeEntity(e,t=!1){if(e){if(!t){if(e.locked)return;if(e.userData.flagHelper)return}return this.remove(e),e}}traverse(e,t=!0){if("function"!=typeof e||!e(this))for(const i of this.children)i.traverse(e,t)}traverseEntities(e,t=!0){if("function"!=typeof e||!e(this))for(const i of this.getEntities())i.traverseEntities(e,t)}changeParent(e=void 0,t=-1){if(e||(e=this.parent),!e||!e.isObject3D)return;const i=this.parent;return-1===t&&i&&(t=i.children.indexOf(this)),e.safeAttach(this),-1!==t&&(e.children.splice(t,0,this),e.children.pop()),this}parentStage(){return this.isStage||this.isWorld?this:this.parent&&this.parent.isEntity3D?this.parent.parentStage():null}parentWorld(){return this.isWorld?this:this.parent&&this.parent.isEntity3D?this.parent.parentWorld():null}updateMatrix(){const e=this.rotation._onChangeCallback,t=this.rotation._onChangeCallback;this.rotation._onChange((()=>{})),this.quaternion._onChange((()=>{}));const i=window.activeCamera;let n=Boolean(this.lookAtCamera&&i);n&&this.parent&&this.parent.isObject3D&&this.traverseAncestors((e=>{e.lookAtCamera&&(n=!1)})),n?(this.parent&&this.parent.isObject3D?(this.parent.getWorldQuaternion(_parentQuaternion,!1),_parentQuaternionInv.copy(_parentQuaternion).invert(),this.quaternion.copy(_parentQuaternionInv)):this.quaternion.identity(),_rotationQuaternion$1.setFromEuler(this.rotation,!1),this.matrixWorld.decompose(_worldPosition$1,_worldQuaternion$1,_worldScale$1),i.matrixWorld.decompose(_camPosition$2,_camQuaternion$1,_camScale$1),this.lookAtYOnly?(_camRotation$1.set(0,Math.atan2(_camPosition$2.x-_worldPosition$1.x,_camPosition$2.z-_worldPosition$1.z),0),_lookQuaternion.setFromEuler(_camRotation$1,!1)):_lookQuaternion.copy(_camQuaternion$1),this.quaternion.copy(_lookQuaternion),this.quaternion.multiply(_rotationQuaternion$1)):this.quaternion.setFromEuler(this.rotation,!1),this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0,this.rotation._onChange(e),this.quaternion._onChange(t)}getWorldQuaternion(e,t=!0){let i=this.lookAtCamera;return t&&i&&(this.lookAtCamera=!1),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(_objPosition$1,e,_objScale$1),t&&i&&(this.lookAtCamera=!0,this.updateWorldMatrix(!0,!1)),e}safeAttach(e){if(e&&e.isObject3D)return e.getWorldQuaternion(_worldQuaternion$1),e.getWorldScale(_worldScale$1),e.getWorldPosition(_worldPosition$1),e.removeFromParent(),e.rotation.copy(_worldRotation.setFromQuaternion(_worldQuaternion$1,void 0,!1)),e.scale.copy(_worldScale$1),e.position.copy(_worldPosition$1),this.attach(e),this}clone(e){return(new this.constructor).copy(this,e)}copy(e,t=!0){if(super.copy(e,!1),this.position.copy(e.position),this.rotation.copy(e.rotation),this.scale.copy(e.scale),e.locked&&(this.locked=!0),e.lookAtCamera&&(this.lookAtCamera=!0),e.lookAtYOnly&&(this.lookAtYOnly=!0),this.updateMatrix(),t)for(const t of e.children)t.userData.flagIgnore||t.userData.flagHelper||this.add(t.clone());return this}cloneEntity(e=!0){return(new this.constructor).copyEntity(this,e)}copyEntity(e,t=!0){this.dispose(),this.copy(e,!1),this.locked=e.locked,this.lookAtCamera=e.lookAtCamera,this.lookAtYOnly=e.lookAtYOnly,this.bloom=e.bloom,this.category=e.category;for(const t of e.components){this.addComponent(t.type,t.toJSON(),!1).tag=t.tag}if(t)for(const t of e.getEntities())this.add(t.cloneEntity());return this}dispose(){for(;this.components.length>0;){const e=this.components[0];this.removeComponent(e),"function"==typeof e.dispose&&e.dispose()}for(;this.children.length>0;)ObjectUtils.clearObject(this.children[0],!0);this.dispatchEvent({type:"destroy"})}fromJSON(e){const t=e.object;void 0!==t.name&&(this.name=t.name),void 0!==t.uuid&&(this.uuid=t.uuid),void 0!==t.position&&this.position.fromArray(t.position),void 0!==t.rotation&&this.rotation.fromArray(t.rotation),void 0!==t.scale&&this.scale.fromArray(t.scale),void 0!==t.castShadow&&(this.castShadow=t.castShadow),void 0!==t.receiveShadow&&(this.receiveShadow=t.receiveShadow),void 0!==t.visible&&(this.visible=t.visible),void 0!==t.frustumCulled&&(this.frustumCulled=t.frustumCulled),void 0!==t.renderOrder&&(this.renderOrder=t.renderOrder),void 0!==t.layers&&(this.layers.mask=t.layers),void 0!==t.up&&this.up.fromArray(t.up),void 0!==t.matrixAutoUpdate&&(this.matrixAutoUpdate=t.matrixAutoUpdate),"object"==typeof t.userData&&(this.userData=structuredClone(t.userData)),void 0!==t.locked&&(this.locked=t.locked),void 0!==t.lookAtCamera&&(this.lookAtCamera=t.lookAtCamera),void 0!==t.lookAtYOnly&&(this.lookAtYOnly=t.lookAtYOnly),void 0!==t.bloom&&(this.bloom=t.bloom),void 0!==t.category&&(this.category=t.category);for(const t of e.object.components)if(t&&t.base&&t.base.type){this.addComponent(t.base.type,t,!1).tag=t.base.tag}return this.loadChildren(t.entities),this.updateMatrix(),this}loadChildren(jsonEntities=[]){for(const entityData of jsonEntities){const entity=new(eval(entityData.object.type));this.add(entity.fromJSON(entityData))}}toJSON(){const e={object:{type:this.type,name:this.name,uuid:this.uuid,components:[],entities:[]}};e.object.position=this.position.toArray(),e.object.rotation=this.rotation.toArray(),e.object.scale=this.scale.toArray(),e.object.castShadow=this.castShadow,e.object.receiveShadow=this.receiveShadow,e.object.visible=this.visible,e.object.frustumCulled=this.frustumCulled,e.object.renderOrder=this.renderOrder,e.object.layers=this.layers.mask,e.object.up=this.up.toArray(),e.object.matrixAutoUpdate=this.matrixAutoUpdate,Object.keys(this.userData).length>0&&(e.object.userData=structuredClone(this.userData)),e.object.locked=this.locked,e.object.lookAtCamera=this.lookAtCamera,e.object.lookAtYOnly=this.lookAtYOnly,e.object.bloom=this.bloom,e.object.category=this.category;for(const t of this.components)e.object.components.push(t.toJSON());for(const t of this.getEntities())e.object.entities.push(t.toJSON());return e}}class Camera3D extends Entity3D{constructor({name:e,type:t="PerspectiveCamera",width:i=APP_SIZE,height:n=APP_SIZE,fit:s,near:a,far:o,fieldOfView:r}={}){super(e??"Camera"),"OrthographicCamera"!==t&&"PerspectiveCamera"!==t&&(t="PerspectiveCamera"),this.isCamera=!0,this.isCamera3D=!0,this.type=t,this.matrixWorldInverse=new THREE$1.Matrix4,this.projectionMatrix=new THREE$1.Matrix4,this.projectionMatrixInverse=new THREE$1.Matrix4,this.coordinateSystem=THREE$1.WebGLCoordinateSystem,"width"!==s&&"height"!==s&&(s="none"),this.fit=s,this.near=a??("PerspectiveCamera"===t?.01:-1e3),this.far=o??1e3,this.fieldOfView=r??58.1,this.isPerspectiveCamera="PerspectiveCamera"===t,this.isOrthographicCamera="OrthographicCamera"===t,this.aspect=1,this.rotateLock=!1,this.view=null,this.zoom=1,this.fov=58.1,this.target=new THREE$1.Vector3,this.setSize(i,n)}updateMatrix(){THREE$1.Object3D.prototype.updateMatrix.bind(this)()}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}changeType(e){if(!e||"string"!=typeof e)return this;if("orthographic"===(e=e.toLowerCase().replace("camera","")))this.type="OrthographicCamera";else{if("perspective"!==e)return this;this.type="PerspectiveCamera"}return this.isPerspectiveCamera="PerspectiveCamera"===this.type,this.isOrthographicCamera="OrthographicCamera"===this.type,this.isPerspectiveCamera&&(this.near=10/this.far),this.isOrthographicCamera&&(this.near=-1*this.far),this.updateProjectionMatrix(),this}changeFit(e){return"landscape"===e&&(e="width"),"portrait"===e&&(e="height"),"width"!==e&&"height"!==e&&(e="none"),this.fit=e,this}setSize(e=APP_SIZE,t=APP_SIZE){if(this.lastWidth=e,this.lastHeight=t,this.aspect=e/t,"height"===this.fit)this.fov=this.fieldOfView;else{const e=Math.tan(Math.PI/180*this.fieldOfView/2);"width"===this.fit?this.fov=360/Math.PI*Math.atan(e/this.aspect):this.fov=360/Math.PI*Math.atan(e*(t/APP_SIZE))}return"width"===this.fit?t=(e=APP_SIZE)/this.aspect:"height"===this.fit&&(e=(t=APP_SIZE)*this.aspect),this.left=-e/2,this.right=e/2,this.top=t/2,this.bottom=-t/2,this.updateProjectionMatrix(),this}updateProjectionMatrix(e){e&&(e.isObject3D&&(e=e.position),this.target.copy(e));const t=this.position.distanceTo(this.target),i=Maths.noZero(1e3/t);if(this.zoom=i,this.isPerspectiveCamera){let e=this.near*Math.tan(Math.PI/180*.5*this.fov),t=2*e,i=this.aspect*t,n=-.5*i;const s=this.view;if(s&&s.enabled){const a=s.fullWidth,o=s.fullHeight;n+=s.offsetX*i/a,e-=s.offsetY*t/o,i*=s.width/a,t*=s.height/o}this.projectionMatrix.makePerspective(n,n+i,e,e-t,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}if(this.isOrthographicCamera){const e=(this.right-this.left)/(2*i),t=(this.top-this.bottom)/(2*i),n=(this.right+this.left)/2,s=(this.top+this.bottom)/2;let a=n-e,o=n+e,r=s+t,c=s-t;const l=this.view;if(l&&l.enabled){const e=(this.right-this.left)/l.fullWidth/i,t=(this.top-this.bottom)/l.fullHeight/i;a+=e*l.offsetX,o=a+e*l.width,r-=t*l.offsetY,c=r-t*l.height}this.projectionMatrix.makeOrthographic(a,o,r,c,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}}setViewOffset(e,t,i,n,s,a){this.view||(this.view={}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=n,this.view.width=s,this.view.height=a,this.setSize(e,t)}clearViewOffset(){this.view&&this.view.enabled&&(this.view.enabled=!1,this.setSize(this.view.fullWidth,this.view.fullHeight))}clone(e){return(new this.constructor).copy(this,e)}copy(e,t=!0){return super.copy(e,t),this.changeType(e.type),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this.fit=e.fit,this.near=e.near,this.far=e.far,this.fieldOfView=e.fieldOfView,this.setSize(e.lastWidth,e.lastHeight),this}cloneEntity(e=!0){return(new this.constructor).copyEntity(this,e)}copyEntity(e,t=!0){return super.copyEntity(e,t),this}fromJSON(e){const t=e.object;return super.fromJSON(e,this),void 0!==t.cameraType&&(this.type=t.cameraType,this.changeType(this.type)),void 0!==t.fit&&(this.fit=t.fit),void 0!==t.near&&(this.near=t.near),void 0!==t.far&&(this.far=t.far),void 0!==t.fieldOfView&&(this.fieldOfView=t.fieldOfView),this.updateProjectionMatrix(),this}toJSON(){const e=super.toJSON();return e.object.cameraType=this.type,e.object.type="Camera3D",e.object.fit=this.fit,e.object.near=this.near,e.object.far=this.far,e.object.fieldOfView=this.fieldOfView,e}}const _directional=new THREE$1.DirectionalLight,_point=new THREE$1.PointLight,_spot=new THREE$1.SpotLight,_loader=new THREE$1.ObjectLoader,_matrix$1=new THREE$1.Matrix4;class Light3D extends Entity3D{constructor({name:e,type:t="AmbientLight",color:i=16777215,intensity:n,skyColor:s=8454143,groundColor:a=8413248,distance:o=0,decay:r=2,angle:c=Math.PI/3,penumbra:l=0}={}){super(e??"Light"),this.castShadow=!1,this.receiveShadow=!1,t=Light3D.validateType(t),this.isLight=!0,this.isLight3D=!0,this.type="Light3D",this.color=new THREE$1.Color("HemisphereLight"===t?s:i),this.position.copy(THREE$1.Object3D.DEFAULT_UP),this.shadow=void 0,this.target=new THREE$1.Object3D,this.groundColor=new THREE$1.Color(a),this.intensity=isNaN(n)?Light3D.defaultIntensity(t):n,this.distance=o,this.decay=r,this.angle=c,this.penumbra=l,this.map=null,this.changeType(t,!1),this.updateMatrix()}changeType(e,t=!0){const i=this.type;let n;switch(e=Light3D.validateType(e),this.type=e,this.isAmbientLight="AmbientLight"===this.type,this.isDirectionalLight="DirectionalLight"===this.type,this.isHemisphereLight="HemisphereLight"===this.type,this.isPointLight="PointLight"===this.type,this.isSpotLight="SpotLight"===this.type,this.type){case"DirectionalLight":case"PointLight":case"SpotLight":n=this.shadow,this.castShadow=!0;break;default:this.castShadow=!1}this.shadow=void 0;let s=this;switch(t&&(s=(new this.constructor).copyEntity(this,!0),s.uuid=this.uuid),s.intensity=Light3D.mapIntensity(s.intensity,i,s.type),this.type){case"DirectionalLight":s.shadow=new _directional.shadow.constructor;break;case"PointLight":s.shadow=new _point.shadow.constructor;break;case"SpotLight":s.shadow=new _spot.shadow.constructor}return s.shadow&&(s.shadow.mapSize.width=2048,s.shadow.mapSize.height=2048,s.shadow.camera.isOthographicCamera&&(s.shadow.camera.left=-10,s.shadow.camera.right=10,s.shadow.camera.top=10,s.shadow.camera.bottom=-10,s.shadow.camera.near=-500,s.shadow.camera.far=500),s.shadow.camera.updateProjectionMatrix()),n&&(s.shadow.copy(n),ObjectUtils.clearObject(n)),s}static defaultIntensity(e){switch(e=Light3D.validateType(e)){case"AmbientLight":case"DirectionalLight":return 1.5;case"HemisphereLight":return 3;case"PointLight":case"SpotLight":return 10}}static mapIntensity(e,t,i){if(isNaN(e))return e;switch(t){case"AmbientLight":case"HemisphereLight":if("DirectionalLight"===i)return 2*e;if("PointLight"===i||"SpotLight"===i)return 6.6666666*e;break;case"HemisphereLight":if("AmbientLight"===i||"HemisphereLight"===i)return e/2;if("PointLight"===i||"SpotLight"===i)return 3.3333333*e;break;case"PointLight":case"SpotLight":if("AmbientLight"===i||"HemisphereLight"===i)return e/6.6666666;if("DirectionalLight"===i)return e/3.3333333}return e}static validateType(e){switch(e){case"AmbientLight":case"DirectionalLight":case"HemisphereLight":case"PointLight":case"SpotLight":return e;default:return"AmbientLight"}}get power(){switch(this.type){case"PointLight":return 4*this.intensity*Math.PI;case"SpotLight":return this.intensity*Math.PI}return this.intensity}set power(e){switch(this.type){case"PointLight":return void(this.intensity=e/(4*Math.PI));case"SpotLight":return void(this.intensity=e/Math.PI)}this.intensity=e}clone(e){return(new this.constructor).copy(this,e)}copy(e,t=!0){return super.copy(e,t),this.changeType(e.type,!1),this.color.copy(e.color),this.intensity=e.intensity,void 0!==e.target&&(this.target&&ObjectUtils.clearObject(this.target),this.target=e.target.clone()),void 0!==e.groundColor&&this.groundColor.copy(e.groundColor),void 0!==e.distance&&(this.distance=e.distance),void 0!==e.decay&&(this.decay=e.decay),void 0!==e.angle&&(this.angle=e.angle),void 0!==e.penumbra&&(this.penumbra=e.penumbra),void 0!==e.shadow&&(this.shadow&&ObjectUtils.clearObject(this.shadow),this.shadow=e.shadow.clone()),this}cloneEntity(e=!0){return(new this.constructor).copyEntity(this,e)}copyEntity(e,t=!0){return super.copyEntity(e,t),this}dispose(){this.shadow&&ObjectUtils.clearObject(this.shadow),this.target&&ObjectUtils.clearObject(this.target),super.dispose()}fromJSON(e){const t=e.object;return super.fromJSON(e,this),void 0!==t.lightType&&(this.type=t.lightType,this.changeType(this.type,!1)),void 0!==t.color&&this.color.set(t.color),void 0!==t.intensity&&(this.intensity=t.intensity),void 0!==t.target&&this.target.applyMatrix4(_matrix$1.fromArray(t.target)),void 0!==t.groundColor&&this.groundColor.set(t.groundColor),void 0!==t.distance&&(this.distance=t.distance),void 0!==t.decay&&(this.decay=t.decay),void 0!==t.angle&&(this.angle=t.angle),void 0!==t.penumbra&&(this.penumbra=t.penumbra),void 0!==t.shadow&&void 0!==this.shadow&&(void 0!==t.shadow.bias&&(this.shadow.bias=t.shadow.bias),void 0!==t.shadow.normalBias&&(this.shadow.normalBias=t.shadow.normalBias),void 0!==t.shadow.radius&&(this.shadow.radius=t.shadow.radius),void 0!==t.shadow.mapSize&&this.shadow.mapSize.fromArray(t.shadow.mapSize),void 0!==t.shadow.camera&&(this.shadow.camera=_loader.parseObject(t.shadow.camera))),this}toJSON(){const e=super.toJSON();return e.object.lightType=this.type,e.object.type="Light3D",e.object.color=this.color.getHex(),e.object.intensity=this.intensity,void 0!==this.target&&(e.object.target=this.target.matrix.toArray()),void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),void 0!==this.shadow&&(e.object.shadow=this.shadow.toJSON()),e}}class Stage3D extends Entity3D{constructor(e="Start"){super(e),this.isStage=!0,this.isStage3D=!0,this.type="Stage3D",this.enabled=!0,this.start=0,this.finish=-1,this.beginPosition=(new THREE$1.Matrix4).setPosition(-2,0,0),this.endPosition=(new THREE$1.Matrix4).setPosition(2,0,0)}componentGroup(){return"Stage3D"}cloneEntity(e=!0){return(new this.constructor).copyEntity(this,e)}copyEntity(e,t=!0){return super.copyEntity(e,t),this.enabled=e.enabled,this.start=e.start,this.finish=e.finish,this.beginPosition.copy(e.beginPosition),this.endPosition.copy(e.endPosition),this}dispose(){super.dispose()}fromJSON(e){const t=e.object;return super.fromJSON(e),void 0!==t.enabled&&(this.enabled=t.enabled),void 0!==t.start&&(this.start=t.start),void 0!==t.finish&&(this.finish=t.finish),void 0!==t.beginPosition&&this.beginPosition.fromArray(t.beginPosition),void 0!==t.endPosition&&this.endPosition.fromArray(t.endPosition),this}loadChildren(jsonEntities=[]){for(const entityData of jsonEntities){const entity=new(eval(entityData.object.type));this.add(entity.fromJSON(entityData))}}toJSON(){const e=super.toJSON();return e.object.enabled=this.enabled,e.object.start=this.start,e.object.finish=this.finish,e.object.beginPosition=this.beginPosition.toArray(),e.object.endPosition=this.endPosition.toArray(),e}}class World3D extends Entity3D{constructor(e="World 1"){super(e),this.isScene=!0,this.isWorld=!0,this.isWorld3D=!0,this.type="World3D",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,this.xPos=0,this.yPos=0,this.activeStageUUID=null,this.loadPosition=new THREE$1.Matrix4,this.loadDistance=0,this.shadowPlane=new THREE$1.Mesh(new THREE$1.PlaneGeometry(1e5,1e5),new THREE$1.ShadowMaterial({color:0,transparent:!0,opacity:.2,depthWrite:!1})),this.shadowPlane.name="Shadow Plane",this.shadowPlane.userData.flagIgnore=!0,this.shadowPlane.rotation.x=-Math.PI/2,this.shadowPlane.castShadow=!1,this.shadowPlane.receiveShadow=!0,this.shadowPlane.visible=!1,this.add(this.shadowPlane)}componentGroup(){return"World3D"}activeStage(){return this.getStageByUUID(this.activeStageUUID)??this}setActiveStage(e){return e&&e.isEntity&&this.getStageByUUID(e.uuid)?this.activeStageUUID=e.uuid:this.activeStageUUID=null,this}addEntity(e,t=-1,i=!1){return e&&e.isEntity3D?(-1!==this.children.indexOf(e)||e.isWorld||(e.isStage&&(i=!1),super.addEntity(e,t,i),e.isStage&&1===this.getStages().length&&this.setActiveStage(e)),this):this}getEntities(e=!0){const t=[];for(const i of super.getEntities())!e&&i.isStage||t.push(i);return t}getFirstStage(){const e=this.getStages();if(e.length>0)return e[0]}getStages(){const e=[];for(const t of super.getEntities())t.isStage&&e.push(t);return e}getStageByName(e){const t=this.getEntityByProperty("name",e);if(t&&t.isStage)return t}getStageByUUID(e){const t=this.getEntityByProperty("uuid",e);if(t&&t.isStage)return t}getStageByProperty(e,t){for(const i of this.getStages())if(i[e]===t)return i}traverseStages(e,t=!0){if(!("function"==typeof e&&e(this)))for(const i of this.getStages())i.traverseEntities(e,t)}cloneEntity(e=!0){return(new this.constructor).copyEntity(this,e)}copyEntity(e,t=!0){super.copyEntity(e,t),e.background&&(e.background.isColor?this.background=e.background.clone():this.background=e.background),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.xPos=e.xPos,this.yPos=e.yPos;const i=e.getStages().indexOf(e.activeStage());return this.activeStageUUID=-1!==i?this.getStages()[i].uuid:null,this.loadPosition.copy(e.loadPosition),this.loadDistance=e.loadDistance,this}dispose(){super.dispose(),this.background&&"function"==typeof this.background.dispose&&this.background.dispose(),this.environment&&"function"==typeof this.environment.dispose&&this.environment.dispose(),this.fog&&"function"==typeof this.fog.dispose&&this.fog.dispose(),this.overrideMaterial&&"function"==typeof this.overrideMaterial.dispose&&this.overrideMaterial.dispose(),this.shadowPlane&&ObjectUtils.clearObject(this.shadowPlane)}fromJSON(e){const t=e.object;if(super.fromJSON(e),void 0!==t.background&&(Number.isInteger(t.background)?this.background=new THREE$1.Color(t.background):this.background=t.background),void 0!==t.environment){const e=AssetManager.getAsset(t.background);e&&e.isTexture&&(this.environment=e)}return void 0!==t.fog&&("Fog"===t.fog.type?this.fog=new THREE$1.Fog(t.fog.color,t.fog.near,t.fog.far):"FogExp2"===t.fog.type&&(this.fog=new THREE$1.FogExp2(t.fog.color,t.fog.density))),void 0!==t.backgroundBlurriness&&(this.backgroundBlurriness=t.backgroundBlurriness),void 0!==t.backgroundIntensity&&(this.backgroundIntensity=t.backgroundIntensity),void 0!==t.xPos&&(this.xPos=t.xPos),void 0!==t.yPos&&(this.yPos=t.yPos),void 0!==t.activeStageUUID&&(this.activeStageUUID=t.activeStageUUID),void 0!==t.loadPosition&&this.loadPosition.fromArray(t.loadPosition),void 0!==t.loadDistance&&(this.loadDistance=t.loadDistance),this}loadChildren(jsonEntities=[]){for(const entityData of jsonEntities){const entity=new(eval(entityData.object.type));this.add(entity.fromJSON(entityData))}}toJSON(){const e=super.toJSON();return this.background&&(this.background.isColor?e.object.background=this.background.toJSON():e.object.background=this.background),this.environment,this.fog&&(e.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(e.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(e.object.backgroundIntensity=this.backgroundIntensity),e.object.xPos=this.xPos,e.object.yPos=this.yPos,e.object.activeStageUUID=this.activeStageUUID,e.object.loadPosition=this.loadPosition.toArray(),e.object.loadDistance=this.loadDistance,e}}class Iris{static get NAMES(){return COLOR_KEYWORDS}constructor(e=16777215,t,i,n=""){this.isColor=!0,this.isIris=!0,this.type="Color",this.r=1,this.g=1,this.b=1,this.set(e,t,i,n)}copy(e){return this.set(e)}clone(){return new this.constructor(this.r,this.g,this.b)}set(e=0,t,i,n=""){if(0===arguments.length)return this.set(0);if(null==e||Number.isNaN(e))(t||i)&&console.warn(`Iris: Passed some valid arguments, however 'r' was ${e}`);else if(void 0===t&&void 0===i){let i=e;if("number"==typeof i||0===i)return this.setHex(i);if(i&&isRGB(i))return this.setRGBF(i.r,i.g,i.b);if(i&&isHSL(i))return this.setHSL(360*i.h,i.s,i.l);if(i&&isRYB(i))return this.setRYB(255*i.r,255*i.y,255*i.b);if(Array.isArray(i)&&i.length>2){let e=null!=t&&!Number.isNaN(t)&&t>0?t:0;return this.setRGBF(i[e],i[e+1],i[e+2])}if("string"==typeof i)return this.setStyle(i)}else switch(n){case"rgb":return this.setRGB(e,t,i);case"hsl":return this.setHSL(e,t,i);case"ryb":return this.setRYB(e,t,i);default:return this.setRGBF(e,t,i)}return this}setColorName(e){const t=COLOR_KEYWORDS[e.toLowerCase()];return t?this.setHex(t):(console.warn(`Iris: Unknown color ${e}`),this)}setHex(e){((e=Math.floor(e))>16777215||e<0)&&(console.warn(`Iris: Given decimal outside of range, value was ${e}`),e=clamp(e,0,16777215));const t=(16711680&e)>>16,i=(65280&e)>>8,n=255&e;return this.setRGB(t,i,n)}setHSL(e,t,i){e=keepInRange(e,0,360),t=clamp(t,0,1),i=clamp(i,0,1);let n=(1-Math.abs(2*i-1))*t,s=n*(1-Math.abs(e/60%2-1)),a=i-n/2,o=0,r=0,c=0;return e<60?(o=n,r=s,c=0):60<=e&&e<120?(o=s,r=n,c=0):120<=e&&e<180?(o=0,r=n,c=s):180<=e&&e<240?(o=0,r=s,c=n):240<=e&&e<300?(o=s,r=0,c=n):300<=e&&(o=n,r=0,c=s),this.setRGBF(o+a,r+a,c+a),this}setRandom(){return this.setRGBF(Math.random(),Math.random(),Math.random())}setRGB(e,t,i){return this.setRGBF(e/255,t/255,i/255)}setRGBF(e,t,i){return this.r=clamp(e,0,1),this.g=clamp(t,0,1),this.b=clamp(i,0,1),this}setRYB(e,t,i){const n=cubicInterpolation(clamp(e,0,255),clamp(t,0,255),clamp(i,0,255),255,CUBE.RYB_TO_RGB);return this.setHex(n)}setScalar(e){return this.setRGB(e,e,e)}setScalarF(e){return this.setRGBF(e,e,e)}setStyle(e){let t;if(t=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let e;const i=t[1],n=t[2];switch(i){case"rgb":case"rgba":if(e=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(n)){const t=Math.min(255,parseInt(e[1],10)),i=Math.min(255,parseInt(e[2],10)),n=Math.min(255,parseInt(e[3],10));return this.setRGB(t,i,n)}if(e=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(n)){const t=Math.min(100,parseInt(e[1],10))/100,i=Math.min(100,parseInt(e[2],10))/100,n=Math.min(100,parseInt(e[3],10))/100;return this.setRGBF(t,i,n)}break;case"hsl":case"hsla":if(e=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(n)){const t=parseFloat(e[1]),i=parseInt(e[2],10)/100,n=parseInt(e[3],10)/100;return this.setHSL(t,i,n)}}}else if(t=/^\#([A-Fa-f\d]+)$/.exec(e)){const e=t[1],i=e.length;if(3===i){const t=parseInt(e.charAt(0)+e.charAt(0),16),i=parseInt(e.charAt(1)+e.charAt(1),16),n=parseInt(e.charAt(2)+e.charAt(2),16);return this.setRGB(t,i,n)}if(6===i){const t=parseInt(e.charAt(0)+e.charAt(1),16),i=parseInt(e.charAt(2)+e.charAt(3),16),n=parseInt(e.charAt(4)+e.charAt(5),16);return this.setRGB(t,i,n)}}return e&&e.length>0?this.setColorName(e):this}cssString(e){return"rgb("+this.rgbString(e)+")"}hex(){return(this.red()<<16)+(this.green()<<8)+this.blue()}hexString(e){return e&&this.set(e),Iris.hexString(this.hex())}static hexString(e=0){return _temp$1.set(e),"#"+("000000"+(_temp$1.hex()>>>0).toString(16)).slice(-6)}static randomHex(){return _random.setRandom().hex()}rgbString(e){const t=this.red()+", "+this.green()+", "+this.blue();return null!=e?String(t+", "+e):t}toJSON(){return this.hex()}getHSL(e){if(!e||!isHSL(e))return{h:hueF(this.hex()),s:saturation(this.hex()),l:lightness(this.hex())};e.h=hueF(this.hex()),e.s=saturation(this.hex()),e.l=lightness(this.hex())}getRGB(e){if(!e||!isHSL(e))return{r:this.r,g:this.g,b:this.b};e.r=this.r,e.g=this.g,e.b=this.b}getRYB(e){let t=cubicInterpolation(this.r,this.g,this.b,1,CUBE.RGB_TO_RYB);return e&&isRYB(e)?(e.r=redF(t),e.y=greenF(t),e.b=blueF(t),e):{r:redF(t),y:greenF(t),b:blueF(t)}}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}red(){return clamp(Math.floor(255*this.r),0,255)}green(){return clamp(Math.floor(255*this.g),0,255)}blue(){return clamp(Math.floor(255*this.b),0,255)}redF(){return this.r}greenF(){return this.g}blueF(){return this.b}hue(){return hue(this.hex())}saturation(){return saturation(this.hex())}lightness(){return lightness(this.hex())}hueF(){return hueF(this.hex())}hueRYB(){for(let e=1;e<RYB_OFFSET.length;e++)if(RYB_OFFSET[e]>this.hue())return e-2}add(e){return e.isColor||console.warn("Iris: add() was not called with a 'Color' object"),this.setRGBF(this.r+e.r,this.g+e.g,this.b+e.b)}addScalar(e){return this.setRGB(this.red()+e,this.green()+e,this.blue()+e)}addScalarF(e){return this.setRGBF(this.r+e,this.g+e,this.b+e)}brighten(e=.5){let t=hue(this.hex()),i=saturation(this.hex()),n=lightness(this.hex());return n+=(1-n)*e,this.setHSL(t,i,n),this}darken(e=.5){let t=hue(this.hex()),i=saturation(this.hex()),n=lightness(this.hex())*e;return this.setHSL(t,i,n)}greyscale(e=1,t="luminosity"){return this.grayscale(e,t)}grayscale(e=1,t="luminosity"){let i=0;"luminosity"===t&&(i=.21*this.r+.72*this.g+.07*this.b),i=(this.r+this.g+this.b)/3,e=clamp(e,0,1);const n=this.r*(1-e)+e*i,s=this.g*(1-e)+e*i,a=this.b*(1-e)+e*i;return this.setRGBF(n,s,a)}hslOffset(e,t,i){return this.setHSL(this.hue()+e,this.saturation()+t,this.lightness()+i)}mix(e,t=.5){e.isColor||console.warn("Iris: mix() was not called with a 'Color' object"),t=clamp(t,0,1);const i=this.r*(1-t)+t*e.r,n=this.g*(1-t)+t*e.g,s=this.b*(1-t)+t*e.b;return this.setRGBF(i,n,s)}multiply(e){return e.isColor||console.warn("Iris: multiply() was not called with a 'Color' object"),this.setRGBF(this.r*e.r,this.g*e.g,this.b*e.b)}multiplyScalar(e){return this.setRGBF(this.r*e,this.g*e,this.b*e)}rgbComplementary(){return this.rgbRotateHue(180)}rgbRotateHue(e=90){const t=keepInRange(this.hue()+e);return this.setHSL(t,this.saturation(),this.lightness())}rybAdjust(){return this.setHSL(hue(matchSpectrum(this.hue(),SPECTRUM.RYB)),this.saturation(),this.lightness())}rybComplementary(){return this.rybRotateHue(180)}rybRotateHue(e=90){const t=keepInRange(this.hueRYB()+e);return this.setHSL(hue(matchSpectrum(t,SPECTRUM.RYB)),this.saturation(),this.lightness())}subtract(e){return e.isColor||console.warn("Iris: subtract() was not called with a 'Color' object"),this.setRGBF(this.r-e.r,this.g-e.g,this.b-e.b)}equals(e){return e.isColor||console.warn("Iris: equals() was not called with a 'Color' object"),fuzzy(this.r,e.r)&&fuzzy(this.g,e.g)&&fuzzy(this.b,e.b)}isEqual(e){return this.equals(e)}isDark(){const e=this.hue(),t=this.lightness();return t<.6&&(e>=210||e<=27)||t<=.32}isLight(){return!this.isDark()}}function isRGB(e){return void 0!==e.r&&void 0!==e.g&&void 0!==e.b}function isHSL(e){return void 0!==e.h&&void 0!==e.s&&void 0!==e.l}function isRYB(e){return void 0!==e.r&&void 0!==e.y&&void 0!==e.b}function clamp(e,t,i){return Math.max(t,Math.min(i,e))}function red(e){return clamp((16711680&e)>>16,0,255)}function green(e){return clamp((65280&e)>>8,0,255)}function blue(e){return clamp(255&e,0,255)}function redF(e){return red(e)/255}function greenF(e){return green(e)/255}function blueF(e){return blue(e)/255}function hue(e){return hsl(e,"h")}function hueF(e){return hue(e)/360}function saturation(e){return hsl(e,"s")}function lightness(e){return hsl(e,"l")}function fuzzy(e,t,i=.0015){return e<t+i&&e>t-i}function keepInRange(e,t=0,i=360){for(;e>=i;)e-=i-t;for(;e<t;)e+=i-t;return e}let _hslHex,_hslH,_hslS,_hslL;function hsl(e,t="h"){if(e!==_hslHex){if(null==e)return 0;const t=redF(e),i=greenF(e),n=blueF(e),s=Math.max(t,i,n),a=Math.min(t,i,n),o=s-a;if(_hslL=(s+a)/2,0===o)_hslH=_hslS=0;else{switch(_hslS=_hslL<=.5?o/(s+a):o/(2-s-a),s){case t:_hslH=(i-n)/o+(i<n?6:0);break;case i:_hslH=(n-t)/o+2;break;case n:_hslH=(t-i)/o+4}_hslH=Math.round(60*_hslH),_hslH<0&&(_hslH+=360)}_hslHex=e}switch(t){case"h":return _hslH;case"s":return _hslS;case"l":return _hslL;default:console.warn(`Iris: Unknown channel (${t}) requested in hsl()`)}return 0}const _interpolate=new Iris,_mix1=new Iris,_mix2=new Iris,_random=new Iris,_temp$1=new Iris;function matchSpectrum(e,t=SPECTRUM.RYB){let i=360/t.length,n=i,s=0;for(let a=0;a<t.length;a++){if(e<n){let a=(n-e)/i;return _mix1.set(t[s+1]),_mix1.mix(_mix2.set(t[s]),a).hex()}n+=i,s+=1}}function cubicInterpolation(e,t,i,n=255,s=CUBE.RYB_TO_RGB){e=clamp(e/n,0,1),t=clamp(t/n,0,1),i=clamp(i/n,0,1);const a=s[0],o=s[1],r=s[2],c=s[3],l=s[4],d=s[5],h=s[6],u=s[7],p=1-e,m=1-t,y=1-i,g=p*m*y,f=p*m*i,b=p*t*y,E=e*m*y,v=p*t*i,x=e*m*i,w=e*t*y,S=e*t*i,A=g*a[0]+f*o[0]+b*r[0]+E*c[0]+v*l[0]+x*d[0]+w*h[0]+S*u[0],T=g*a[1]+f*o[1]+b*r[1]+E*c[1]+v*l[1]+x*d[1]+w*h[1]+S*u[1],R=g*a[2]+f*o[2]+b*r[2]+E*c[2]+v*l[2]+x*d[2]+w*h[2]+S*u[2];return _interpolate.set(A,T,R,"gl").hex()}const CUBE={RYB_TO_RGB:[[1,1,1],[.163,.373,.6],[1,1,0],[1,0,0],[0,.66,.2],[.5,0,.5],[1,.5,0],[0,0,0]],RGB_TO_RYB:[[1,1,1],[0,0,1],[0,1,.483],[1,0,0],[0,.053,.21],[.309,0,.469],[0,1,0],[0,0,0]]},SPECTRUM={RYB:[16711680,16730368,16741376,16749056,16755200,16760576,16765696,16771072,16776960,13432320,10481152,6808320,52224,44900,39321,745892,1196203,1776563,3740847,5443501,7408042,10879142,13434996,14942277,16711680]},RYB_OFFSET=[0,1,2,3,5,6,7,8,9,10,11,13,14,15,16,17,18,19,19,20,21,21,22,23,23,24,25,25,26,27,27,28,28,29,29,30,30,31,31,32,32,32,33,33,34,34,35,35,35,36,36,37,37,37,38,38,38,39,39,40,40,40,41,41,41,42,42,42,43,43,43,44,44,44,45,45,45,46,46,46,47,47,47,47,48,48,48,49,49,49,50,50,50,51,51,51,52,52,52,53,53,53,54,54,54,55,55,55,56,56,56,57,57,57,58,58,59,59,59,60,60,61,61,62,63,63,64,65,65,66,67,68,68,69,70,70,71,72,72,73,73,74,75,75,76,77,77,78,79,79,80,81,82,82,83,84,85,86,87,88,88,89,90,91,92,93,95,96,98,100,102,104,105,107,109,111,113,115,116,118,120,122,125,127,129,131,134,136,138,141,143,145,147,150,152,154,156,158,159,161,163,165,166,168,170,171,173,175,177,178,180,182,184,185,187,189,191,192,194,196,198,199,201,203,205,206,207,208,209,210,212,213,214,215,216,217,218,219,220,221,222,223,224,226,227,228,229,230,232,233,234,235,236,238,239,240,241,242,243,244,245,246,247,248,249,250,251,251,252,253,254,255,256,257,257,258,259,260,260,261,262,263,264,264,265,266,267,268,268,269,270,271,272,273,274,274,275,276,277,278,279,280,282,283,284,286,287,289,290,292,293,294,296,297,299,300,302,303,305,307,309,310,312,314,316,317,319,321,323,324,326,327,328,329,330,331,332,333,334,336,337,338,339,340,341,342,343,344,345,347,348,349,350,352,353,354,355,356,358,359,999],COLOR_KEYWORDS={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,transparent:0,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};class Palette{constructor(){this.isPalette=!0,this.type="Palette",this.name="New Palette",this.uuid=Maths.uuid(),this.colors=[]}default16(){return this.colors=[0,8421504,12632256,16777215,65535,255,128,8388736,16711935,16711680,8388608,8421376,16776960,65280,32768,32896],this}purpleGold(){return this.colors=[0,16777215,13893887,16762880],this}fromJSON(e){const t=e.object;return void 0!==t.name&&(this.name=t.name),void 0!==t.uuid&&(this.uuid=t.uuid),void 0!==t.colors&&(this.colors=JSON.parse(t.colors)),this}toJSON(){const e={object:{type:this.type,name:this.name,uuid:this.uuid}};return e.object.colors=JSON.stringify(this.colors),e}}class Script$1{constructor(e=SCRIPT_FORMAT.JAVASCRIPT,t=!1){this.isScript=!0,this.type="Script",this.name="New Script",this.uuid=Maths.uuid(),this.format=e,this.category=null,this.line=0,this.char=0,this.errors=!1,e===SCRIPT_FORMAT.JAVASCRIPT&&(this.source=`//\n// Lifecycle Events:    init, update, destroy\n// Input Events:        keydown, keyup, pointerdown, pointerup, pointermove\n// Within Events:\n//      'this'          represents entity this script is attached to\n//      'app'           access .renderer, .project, .scene, .camera, .keys\n// Pointer Events:\n//      'event.entity'  entity under pointer (if there is one)\n// Update Event:\n//      'event.delta'   time since last frame (in seconds)\n//      'event.total'   total elapsed time (in seconds)\n//\n${variableTemplate(t)}\n// ...script scope variable declarations allowed here...\n\n// "init()" is executed when an entity is loaded\nfunction init() {\n\n}\n\n// "update()" is executed once each frame\nfunction update(event) {\n\n}\n\n// "destroy()" is executed right before an entity is removed\nfunction destroy() {\n\n}\n\n// Example Input Event\nfunction keydown(event) {\n\n}\n`)}fromJSON(e){const t=e.object;return void 0!==t.name&&(this.name=t.name),void 0!==t.uuid&&(this.uuid=t.uuid),void 0!==t.format&&(this.format=t.format),void 0!==t.category&&(this.category=t.category),void 0!==t.line&&(this.line=t.line),void 0!==t.char&&(this.char=t.char),void 0!==t.errors&&(this.errors=t.errors),void 0!==t.source&&(this.source=t.source),this}toJSON(){const e={object:{type:this.type,name:this.name,uuid:this.uuid,format:this.format,category:this.category}};return e.object.line=this.line,e.object.char=this.char,e.object.errors=structuredClone(this.errors),e.object.source=this.source,e}}function variableTemplate(e=!1){return e?"\n//\n// Example Script Properties\n//      - 'info' property text will appear in Advisor\n//      - see 'ComponentManager.js' for more information\n//\nlet variables = {\n\n    // The following 'asset' types are saved as asset UUID values\n    geometry: { type: 'asset', class: 'geometry', info: 'Geometry Asset' },\n    material: { type: 'asset', class: 'material', info: 'Material Asset' },\n    script: { type: 'asset', class: 'script', info: 'Script Asset' },\n    shape: { type: 'asset', class: 'shape', info: 'Shape Asset' },\n    texture: { type: 'asset', class: 'texture', info: 'Texture Asset' },\n    divider1: { type: 'divider' },\n    prefab: { type: 'asset', class: 'prefab', info: 'Prefab Asset' },\n    divider2: { type: 'divider' },\n\n    // Dropdown selection box, saved as 'string' value\n    select: { type: 'select', default: 'Banana', select: [ 'Apple', 'Banana', 'Cherry' ], info: 'Selection Box' },\n\n    // Numeric values, saved as 'number' values\n    number: { type: 'number', default: 0.05, min: 0, max: 1, step: 0.05, label: 'test', info: 'Floating Point' },\n    int: { type: 'int', default: 5, min: 3, max: 10, info: 'Integer' },\n\n    // Angle, saved as 'number' value in radians\n    angle: { type: 'angle', default: 2 * Math.PI, min: 0, max: 360, info: 'Angle' },\n\n    // Numeric value +/- a range value, saved as Array\n    variable: { type: 'variable', default: [ 0, 0 ], min: 0, max: 100, info: 'Ranged Value' },\n    slider: { type: 'slider', default: 0, min: 0, max: 9, step: 1, precision: 0, info: 'Numeric Slider' },\n\n    // Boolean\n    boolean: { type: 'boolean', default: true, info: 'true || false' },\n\n    // Color returns integer value at runtime\n    color: { type: 'color', default: 0xff0000, info: 'Color Value' },\n\n    // Strings\n    string: { type: 'string', info: 'String Value' },\n    multiline: { type: 'string', rows: 4, info: 'Multiline String' },\n    keyboard: { type: 'key', default: 'Escape' },\n\n    // Vectors returned as Array types at runtime\n    numberArray: { type: 'vector', size: 1, info: 'Numeric Array' },\n    vector2: { type: 'vector', size: 2, tint: true, label: [ 'x', 'y' ], info: 'Vector 2' },\n    vector3: { type: 'vector', size: 3, tint: true, min: [ 1, 1, 1 ], max: [ 2, 2, 2 ], step: 0.1, precision: 2, info: 'Vector 3' },\n    vector4: { type: 'vector', size: 4, tint: true, info: 'Vector 4' },\n}\n":"\n// Script Properties:\nlet variables = {\n//  myNumber: { type: 'number', default: 10 },\n//  myString: { type: 'string', default: '' },\n//  myColor: { type: 'color', default: 0x0000ff },\n};\n"}const _assets={},_textureCache={},_textureLoader=new THREE$1.TextureLoader,_types={Camera3D:Camera3D,Entity3D:Entity3D,Light3D:Light3D,Stage3D:Stage3D,World3D:World3D};class AssetManager$1{static clear(){for(const e in _assets){_assets[e].isBuiltIn||AssetManager$1.removeAsset(_assets[e],!0)}}static checkType(e){if(e)return e.isBufferGeometry?"geometry":"Shape"===e.type?"shape":e.isMaterial?"material":e.isPalette?"palette":e.isScript?"script":e.isTexture?"texture":e.isEntity?"prefab":"asset"}static addAsset(e){const t=Array.isArray(e)?e:[...arguments];let i;for(let e=0;e<t.length;e++){let n=t[e];if(!n||!n.uuid)continue;const s=AssetManager$1.checkType(n);if(void 0!==s){if(n.name&&""!==n.name||(n.name=n.constructor.name),"geometry"===s&&"BufferGeometry"!==n.constructor.name){const e=mergeGeometries([n]);e.name=n.name,e.uuid=n.uuid,"function"==typeof n.dispose&&n.dispose(),n=e}n.isEntity&&(n.isPrefab=!0),"script"!==s&&"prefab"!==s||n.category&&""!==n.category||(n.category="unknown"),_assets[n.uuid]=n,void 0===i&&(i=n)}}return i}static getAsset(e){return e&&e.uuid&&(e=e.uuid),_assets[e]}static getLibrary(e,t){const i=[];for(const[n,s]of Object.entries(_assets))e&&AssetManager$1.checkType(s)!==e||(null==t||s.category&&s.category===t)&&i.push(s);return i}static removeAsset(e,t=!0){const i=Array.isArray(e)?e:[e];for(const e of i)if(e&&e.uuid&&_assets[e.uuid]){if(e.isTexture)for(const t in _textureCache)_textureCache[t].uuid===e.uuid&&delete _textureCache[t];t&&"function"==typeof e.dispose&&e.dispose(),delete _assets[e.uuid]}}static loadTexture(e,t=void 0){if(!e||""===e)return null;const i=THREE$1.DefaultLoadingManager.resolveURL(e);if(_textureCache[i])return console.log("AssetManager.loadTexture: Duplicate image!"),_textureCache[i];const n=_textureLoader.load(e,(function(e){e.name=Strings.nameFromUrl(e.image.src),e.premultiplyAlpha=!0,e.wrapS=THREE$1.RepeatWrapping,e.wrapT=THREE$1.RepeatWrapping,e.needsUpdate=!0,t&&"function"==typeof t&&t(e);AssetManager$1.addAsset(e),window.signals&&signals.assetChanged&&signals.assetChanged.dispatch("texture",e)}),(function(){_textureCache[i]&&_textureCache[i].isTexture&&_textureCache[i].dispose();delete _textureCache[i]}));return _textureCache[i]=n,n}static fromJSON(e,t=(()=>{})){function i(e){for(const[t,i]of Object.entries(e))AssetManager$1.addAsset(i)}AssetManager$1.clear();const n={};if(e.palettes){for(const t of e.palettes){const e=(new Palette).fromJSON(t);n[e.uuid]=e}i(n)}const s={};if(e.prefabs){for(const t of e.prefabs){const e=new(0,_types[t.object.type]);e.fromJSON(t),s[e.uuid]=e}i(s)}const a={};if(e.scripts){for(const t of e.scripts){const e=(new Script$1).fromJSON(t);a[e.uuid]=e}i(a)}const o=new THREE$1.LoadingManager(t),r=new THREE$1.ObjectLoader(o),c=r.parseAnimations(e.animations),l=r.parseShapes(e.shapes),d=r.parseGeometries(e.geometries,{}),h=r.parseImages(e.images),u=r.parseTextures(e.textures,h),p=r.parseMaterials(e.materials,u);i(c),i(l),i(d),i(h),i(u),i(p)}static toJSON(e){const t={};e||(e={}),e.palettes||(e.palettes={}),e.prefabs||(e.prefabs={}),e.scripts||(e.scripts={}),e.shapes||(e.shapes={}),e.geometries||(e.geometries={}),e.images||(e.images={}),e.textures||(e.textures={}),e.materials||(e.materials={}),e.animations||(e.animations={}),e.skeletons||(e.skeletons={});const i={images:{},textures:{},materials:{}},n=AssetManager$1.getLibrary("palette");for(const t of n)t.uuid&&!e.palettes[t.uuid]&&(e.palettes[t.uuid]=t.toJSON());const s=AssetManager$1.getLibrary("prefab");for(const t of s)t.uuid&&!e.prefabs[t.uuid]&&(t.isBuiltIn||(e.prefabs[t.uuid]=t.toJSON()));const a=AssetManager$1.getLibrary("script");for(const t of a)t.uuid&&!e.scripts[t.uuid]&&(e.scripts[t.uuid]=t.toJSON());const o=AssetManager$1.getLibrary("geometry");for(const t of o)t.uuid&&!e.geometries[t.uuid]&&(e.geometries[t.uuid]=t.toJSON(e));const r=AssetManager$1.getLibrary("material");for(const t of r)t.uuid&&!e.materials[t.uuid]&&(e.materials[t.uuid]=t.toJSON(i));const c=AssetManager$1.getLibrary("shape");for(const t of c)t.uuid&&!e.shapes[t.uuid]&&(e.shapes[t.uuid]=t.toJSON(i));const l=AssetManager$1.getLibrary("texture");for(const t of l)t.uuid&&!e.textures[t.uuid]&&(e.textures[t.uuid]=t.toJSON(e));for(const i in e){const n=[];for(const t in e[i]){const s=e[i][t];delete s.metadata,n.push(s)}t[i]=n}return t}}const _camPosition$1=new THREE$1.Vector3,_camQuaternion=new THREE$1.Quaternion,_camScale=new THREE$1.Vector3,_rotationQuaternion=new THREE$1.Quaternion,_raycaster$1=new THREE$1.Raycaster;class CameraUtils{static fitCameraToObject(e,t,i=null,n=1.25,s=!1){const a=new THREE$1.Box3;a.setFromObject(t);const o=a.getCenter(new THREE$1.Vector3),r=a.getSize(new THREE$1.Vector3),c=r.z/(2*Math.atan(Math.PI*e.fov/360)),l=Math.max(c,r.y/(2*Math.atan(Math.PI*e.fov/360))),d=r.x/(2.5*Math.atan(Math.PI*e.fov/360))/e.aspect,h=n*Math.max(l,d);e.near=h/100,e.far=100*h,e.updateProjectionMatrix(),e.position.copy(o),s&&(e.position.x+=h/6,e.position.y+=h/6),e.position.z+=h,e.lookAt(o),i&&(i.maxDistance=10*h,i.target.copy(o),i.update())}static screenPoint(e,t){return t&&t.isCamera?new THREE$1.Vector3.copy(e).project(t):(console.warn("CameraUtils.screenPoint: No camera provided!"),new THREE$1.Vector3)}static worldPoint(e,t,i=new THREE$1.Vector3,n="none"){if(!t||!t.isCamera)return console.warn("CameraUtils.worldPoint: No camera provided!"),!1;n="string"==typeof n?n.toLowerCase():"none";const s=new THREE$1.PlaneGeometry(1e8,1e8,2,2);switch(n){case"xy":break;case"yz":s.rotateY(Math.PI/2);break;case"xz":s.rotateX(Math.PI/2);break;default:t.matrixWorld.decompose(_camPosition$1,_camQuaternion,_camScale),s.applyQuaternion(_camQuaternion)}s.translate(i.x,i.y,i.z);const a=new THREE$1.MeshBasicMaterial({side:THREE$1.DoubleSide}),o=new THREE$1.Mesh(s,a);_raycaster$1.setFromCamera(e,t),t.isOrthographicCamera&&_raycaster$1.ray.origin.set(e.x,e.y,-t.far).unproject(t);const r=_raycaster$1.intersectObject(o,!0);return s.dispose(),a.dispose(),r.length>0&&r[0].point.clone()}}const _timer=null==performance||"undefined"==typeof performance?Date:performance;class Clock{#e=!1;#t=0;#i=0;#n=0;#s=0;#a=0;#o=0;#r=0;constructor(e=!0,t=0){e&&this.start(),this.#t-=t,this.#n-=t}start(e=!1){e&&this.reset(),this.#t=_timer.now(),this.#n=this.#t,this.#e=!0}stop(){this.getDeltaTime(),this.#e=!1}toggle(){this.#e?this.stop():this.start()}reset(){this.#t=_timer.now(),this.#n=this.#t,this.#i=0,this.#s=0}getElapsedTime(){return this.#i}getDeltaTime(){if(!this.#e)return this.#r=0,0;const e=_timer.now(),t=(e-this.#n)/1e3;return this.#n=e,this.#i+=t,this.#s++,this.#a+=t,this.#o++,this.#a>1&&(this.#r=this.#o,this.#a=0,this.#o=0),t}isRunning(){return this.#e}isStopped(){return!this.#e}count(){return this.#s}averageDelta(){const e=1/this.#r;return Math.min(1,e)}fps(){return this.#r}}class EntityUtils{static combineEntityArrays(e,t){for(const i of t)!1===EntityUtils.containsEntity(e,i)&&e.push(i)}static commonEntity(e,t){e=Array.isArray(e)?e:[e],t=Array.isArray(t)?t:[t];for(let i=0;i<e.length;i++)if(!0===EntityUtils.containsEntity(t,e[i]))return!0;for(let i=0;i<t.length;i++)if(!0===EntityUtils.containsEntity(e,t[i]))return!0;return!1}static compareArrayOfEntities(e,t){e=Array.isArray(e)?e:[e],t=Array.isArray(t)?t:[t];for(let i=0;i<e.length;i++)if(!1===EntityUtils.containsEntity(t,e[i]))return!1;for(let i=0;i<t.length;i++)if(!1===EntityUtils.containsEntity(e,t[i]))return!1;return!0}static containsEntity(e,t){if(!Array.isArray(e))return!1;if(!t||!t.isEntity)return!1;for(const i of e)if(i.isEntity&&i.uuid===t.uuid)return!0;return!1}static containsMesh(e,t=!0){if(!e||!e.isEntity)return console.warn("EntityUtils.containsMesh: Object was not an Entity!"),!1;let i=!1;return e.traverseEntities((e=>{if(i)return!0;let t=!1,n=!1;e.traverseComponents((e=>{const s=e.backend;s&&(t=t||"geometry"===e.type&&s.isBufferGeometry,n=n||"material"===e.type&&s.isMaterial,i=i||"mesh"===e.type&&s.isMesh)})),i=i||t&&n}),t),i}static findCamera(e){if(!e||!e.isEntity)return;let t;return e.traverseEntities((e=>!!t||(e.isCamera?(t=e,!0):void 0))),t}static parentEntity(e,t=!1){for(;e&&e.parent;){if(e.parent.isStage)return e;if(e.parent.isWorld)return e;if(e=e.parent,t){let t=e.isEntity;if(t=t||e.userData.flagIgnore,t=t||e.userData.flagHelper,t)return e}}return e}static removeEntityFromArray(e,t){if(t&&t.isEntity&&Array.isArray(e)){for(let i=e.length-1;i>=0;--i)e[i].uuid===t.uuid&&e.splice(i,1);return e}}}class Project{constructor(e="My Project"){this.isProject=!0,this.type="Project",this.name=e,this.uuid=Maths.uuid(),this.activeWorldUUID=null,this.settings={orientation:APP_ORIENTATION.PORTRAIT,preload:10,unload:10},this.worlds={}}setting(e){switch("object"!=typeof this.settings&&(this.settings={}),e){case"orientation":case"orient":return this.settings.orientation??APP_ORIENTATION.PORTRAIT;case"preload":case"add":return this.settings.preload??10;case"unload":case"remove":return this.settings.unload??10}}activeWorld(){let e=this.getWorldByUUID(this.activeWorldUUID);if(!e||!e.isWorld){const t=Object.keys(this.worlds);t.length>0&&(e=this.worlds[t[0]])}return e}setActiveWorld(e){return e&&e.isWorld?(this.worlds[e.uuid]&&(this.activeWorldUUID=e.uuid),this):this}addWorld(e){return e&&e.isWorld?(WORLD_TYPES[e.type]?(this.worlds[e.uuid]=e,null==this.activeWorldUUID&&(this.activeWorldUUID=e.uuid)):console.error(`Project.addWorld: World type (${e.type}) not a valid world type`,e),this):this}getWorldByName(e){return this.getWorldByProperty("name",e)}getWorldByUUID(e){if(e)return this.worlds[e]}getWorldByProperty(e,t){for(const i in this.worlds){const n=this.worlds[i];if(n[e]===t)return n}}removeWorld(e){e&&e.isWorld&&delete this.worlds[e.uuid]}traverseWorlds(e,t=!0){for(const i in this.worlds){const n=this.worlds[i];"function"==typeof e&&e(n),t&&n.traverseStages(e,t)}}worldCount(){return Object.keys(this.worlds).length}findEntityByUUID(e,t=!1){const i=editor.viewport.world;let n=[];t?n=[...this.worlds]:i&&(n=[i]);for(const t of n){if(e&&t.uuid&&e===t.uuid)return t;const i=t.getEntityByProperty("uuid",e);if(i)return i}}clear(){for(const e in this.worlds){const t=this.worlds[e];this.removeWorld(t),"function"==typeof t.dispose&&t.dispose()}this.name="My Project",this.uuid=Maths.uuid(),this.activeWorldUUID=null}fromJSON(e,t=!0,i=(()=>{})){const n=e.metadata?e.metadata.type:"Undefined";if("Salinity"!==n)return void console.error(`Project.fromJSON: Unknown project type ('${n}'), expected 'Salinity'`);const s=e.metadata.version;if(s!==VERSION&&console.warn(`Project.fromJSON: Project saved in 'v${s}', attempting to load with 'v${VERSION}'`),e.object&&e.object.type===this.type){this.clear(),t&&AssetManager$1.fromJSON(e,i),this.name=e.object.name,this.uuid=e.object.uuid,this.activeWorldUUID=e.object.activeWorldUUID,this.settings=structuredClone(e.settings);for(const t of e.worlds){let e;if("World3D"===t.object.type)e=(new World3D).fromJSON(t);e&&e.isWorld&&this.addWorld(e)}return this}console.error("Project.fromJSON: Save file corrupt, no 'Project' object found!")}toJSON(){const e=AssetManager$1.toJSON({});e.metadata={type:"Salinity",version:VERSION,generator:"Salinity.Project.toJSON"},e.object={type:this.type,name:this.name,uuid:this.uuid,activeWorldUUID:this.activeWorldUUID},e.settings=structuredClone(this.settings),e.worlds=[];for(const t in this.worlds){const i=this.worlds[t];e.worlds.push(i.toJSON())}return e}}class Renderer3D extends THREE$1.WebGLRenderer{constructor(e={}){super(e);const t=this.render.bind(this);this.render=function(e,i){window.activeCamera=i,t(e,i)}}}const OpaqueShader={name:"OpaqueShader",uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:"\n        varying vec2 vUv;\n        void main() {\n            vUv = uv;\n            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n        }",fragmentShader:"\n        uniform sampler2D tDiffuse;\n        varying vec2 vUv;\n        void main() {\n            vec4 texel = texture2D(tDiffuse, vUv);\n            gl_FragColor = vec4(texel.rgb, 1.0);\n        }"},scriptFunctions=APP_EVENTS.toString(),scriptReturnObject={};for(const e of APP_EVENTS)scriptReturnObject[e]=e;const scriptParameters="app,"+scriptFunctions,scriptReturnString=JSON.stringify(scriptReturnObject).replace(/\"/g,""),_invQuaternion=new THREE$1.Quaternion,_tempRotation=new THREE$1.Quaternion,_beginPosition=new THREE$1.Vector3,_beginScale=new THREE$1.Vector3(1,1,1),_beginQuaternion=new THREE$1.Quaternion,_endPosition=new THREE$1.Vector3,_endScale=new THREE$1.Vector3(1,1,1),_endQuaternion=new THREE$1.Quaternion,_worldPosition=new THREE$1.Vector3,_worldScale=new THREE$1.Vector3(1,1,1),_worldQuaternion=new THREE$1.Quaternion,_composers={};class SceneManager{static app=void 0;static findCamera(e){let t;return t=EntityUtils.findCamera(e),t||(t=new Camera3D({width:1e3,height:1e3}),t.position.set(0,0,10),t.lookAt(0,0,0),t)}static cloneChildren(e,t){for(const i of t.getEntities()){const n=i.cloneEntity(!1);if(SceneManager.loadScriptsFromComponents(n,i),i.isStage||SceneManager.cloneChildren(n,i),n.bloom&&n.traverse((e=>{e.layers.disable(LAYERS.BASE),e.layers.enable(LAYERS.BLOOM)})),t.isStage){if(t.beginPosition.decompose(_beginPosition,_beginQuaternion,_beginScale),n.position.sub(_beginPosition),n.position.applyQuaternion(_invQuaternion.copy(_beginQuaternion).invert()),n.position.multiply(_beginScale),n.position.multiply(_worldScale),n.rotation.setFromQuaternion(_tempRotation.setFromEuler(n.rotation).premultiply(_beginQuaternion)),n.scale.multiply(_beginScale),e.isWorld){const t=e.loadDistance+Math.abs(n.position.length());n.traverse((e=>{e.userData.loadedDistance=t}))}n.scale.multiply(_worldScale),n.rotation.setFromQuaternion(_tempRotation.setFromEuler(n.rotation).premultiply(_worldQuaternion)),n.position.applyQuaternion(_worldQuaternion),n.position.add(_worldPosition)}e.add(n);for(const e of n.components)"function"==typeof e.onLoad&&e.onLoad()}}static loadScriptsFromComponents(e,t){if(e&&e.isEntity&&t&&t.isEntity&&t.components)for(const i of t.components){if("script"!==i.type||!i.data)continue;const n=i.data.script,s=AssetManager$1.getAsset(n);if(!s||!s.isScript)continue;if(s.errors){console.warn(`Entity '${t.name}' has errors in script '${s.name}'. Script will not be loaded!`);continue}let a=`${s.source}\n`;for(const e in i.data.variables){const t=i.data.variables[e];if(t&&"object"==typeof t)if(void 0!==t.value){let i=JSON.stringify(t.value);i=i.replace(/[.*+`'"?^${}()|[\]\\]/g,"\\$&"),a+=`let ${e} = JSON.parse('${i}');\n`}else a+=`let ${e} = undefined;\n`}a+=`return ${scriptReturnString};`;const o=new Function(scriptParameters,a).bind(e)(SceneManager.app);for(const t in o){if("function"!=typeof o[t])continue;const i=o[t].bind(e);SceneManager.app.addEvent(t,e,i)}}}static removeEntity(e,t){e&&e.isWorld3D&&t&&t.isObject3D&&(SceneManager.app.dispatch("destroy",{},[t.uuid]),e.removeEntity(t,!0),"function"==typeof t.dispose&&t.dispose())}static cloneStage(e,t,i=!0){e&&e.isWorld3D&&t&&t.isStage3D&&(e.loadPosition.decompose(_worldPosition,_worldQuaternion,_worldScale),SceneManager.cloneChildren(e,t),i&&(t.beginPosition.decompose(_beginPosition,_beginQuaternion,_beginScale),t.endPosition.decompose(_endPosition,_endQuaternion,_endScale),_endPosition.sub(_beginPosition),_endPosition.applyQuaternion(_invQuaternion.copy(_beginQuaternion).invert()),_endPosition.multiply(_beginScale),_endPosition.multiply(_worldScale),_endPosition.applyQuaternion(_worldQuaternion),_endQuaternion.premultiply(_beginQuaternion),_endScale.multiply(_beginScale),_worldScale.multiply(_endScale),_worldQuaternion.premultiply(_endQuaternion),_worldPosition.add(_endPosition),e.loadPosition.compose(_worldPosition,_worldQuaternion,_worldScale),e.loadDistance+=Math.abs(_endPosition.length())))}static loadStages(e,t,i=10){if(!e||!e.isWorld3D)return;if(!t||!t.isWorld3D)return;if(i<0)return;const n=e.loadDistance;let s=0;for(;e.loadDistance-n<i;){const n=[];for(const i of t.getStages())i.enabled&&(i.start>=0&&i.start>e.loadDistance||i.finish>=0&&i.finish<e.loadDistance||n.push(i));if(!(n.length>0)){e.loadDistance+=i;break}SceneManager.cloneStage(e,n[Math.floor(Math.random()*n.length)]),s++}s>0&&SceneManager.app.dispatch("init")}static loadWorld(e,t){if(!e||!e.isWorld3D)return;if(!t||!t.isWorld3D)return;if(null!=t.background)if(t.background.isColor)e.background=t.background.clone();else{const i=AssetManager$1.getAsset(t.background);i&&i.isTexture&&(e.background=i.clone())}null!=t.environment&&(e.environment=t.environment.clone()),null!=t.fog&&(e.fog=t.fog.clone()),e.backgroundBlurriness=t.backgroundBlurriness,e.backgroundIntensity=t.backgroundIntensity,null!=t.overrideMaterial&&(e.overrideMaterial=t.overrideMaterial.clone());const i=t.getComponentByType("physics");if(i){const t=e.addComponent(i.type,i.toJSON(),!1);t.onLoad(),e.physics=t}SceneManager.cloneChildren(e,t)}static renderWorld(e){if(!e||!e.isWorld3D)return;if(!_composers[e.uuid]){const t=new EffectComposer(SceneManager.app.renderer);t.renderToScreen=!0;const i=new ClearPass(new THREE$1.Color(0),0);t.addPass(i);const n=new RenderPass(SceneManager.app.scene,SceneManager.app.camera);n.clear=!1,t.addPass(n);const s=e.getComponentsWithProperties("type","post");for(const e of s){const i=e.backend;i&&(i.scene=SceneManager.app.scene,i.camera=SceneManager.app.camera,t.addPass(i))}const a=new ShaderPass(OpaqueShader);t.addPass(a),_composers[e.uuid]=t}const t=_composers[e.uuid];t&&t.render()}static setCamera(e,t){SceneManager.app.camera=t;const i=e.getComponentsWithProperties("type","post");for(const e of i){const i=e.backend;i&&(i.camera=t)}}static setSize(e,t){const i=SceneManager.app?.project?.settings?.orientation,n=APP_SIZE/("portrait"===i?t:e),s=e*n,a=t*n;for(const i in _composers){const n=_composers[i];n.setSize(e,t);for(const e of n.passes)"function"==typeof e.setFixedSize&&e.setFixedSize(s,a)}}static dispose(){for(const e in _composers){const t=_composers[e];if(t){for(const e of t.passes)"function"==typeof e.dispose&&e.dispose();"function"==typeof t.dispose&&t.dispose()}delete _composers[e]}}}const _position$2=new THREE$1.Vector3,_raycaster=new THREE$1.Raycaster;let _animationID=null;class App{constructor(){this.project=new Project,this.renderer=new Renderer3D({antialias:!0}),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.shadowMap.enabled=!0,this.dom=document.createElement("div"),this.dom.appendChild(this.renderer.domElement),this.events={},this.world=null,this.scene=null,this.camera=new Camera3D,this.gameClock=new Clock(!1),this.keys={},this.pointer=new THREE$1.Vector2,this.isPlaying=!1}addEvent(e,t,i){-1!==APP_EVENTS.indexOf(e)&&t&&t.uuid&&"function"==typeof i&&(this.events[e]||(this.events[e]={}),this.events[e][t.uuid]||(this.events[e][t.uuid]=[]),this.events[e][t.uuid].push(i))}clearEvents(e=[],t=[]){0===e.length&&(e=[...APP_EVENTS]);const i=[...t];for(const n of e){const e=this.events[n];if("object"!=typeof e)return;t=0===i.length?Object.keys(e):[...i];for(const i of t)delete e[i]}}dispatch(e,t={},i=[]){const n=this.events[e];if("object"==typeof n){0===i.length&&(i=Object.keys(n));for(const e of i){const i=n[e];if(Array.isArray(i))for(const e of i)if("function"==typeof e)try{e(t)}catch(e){console.error(e.message||e,e.stack||"")}}"init"===e?this.clearEvents([e],i):"destroy"===e&&this.clearEvents([],i)}}load(e,t=!0){SceneManager.app=this,this.project.fromJSON(e,t),this.world=this.project.activeWorld();const i=this.project.setting("preload");this.scene=new World3D,SceneManager.loadWorld(this.scene,this.world),this.camera=SceneManager.findCamera(this.scene),this.camera.changeFit(this.project.setting("orientation")),SceneManager.loadStages(this.scene,this.world,i)}animate(){if(this.gameClock.isRunning()){const e=this.gameClock.getDeltaTime(),t=this.gameClock.getElapsedTime();if(this.dispatch("update",{delta:e,total:t}),this.scene.physics){this.scene.physics.onUpdate(e);for(const t of this.scene.getEntities())for(const i of t.components)"function"==typeof i.onUpdate&&i.onUpdate(e)}if(this.camera&&this.camera.target&&this.camera.target.isVector3&&this.scene&&this.scene.isWorld3D){const e=this.project.setting("preload"),t=this.project.setting("unload");_position$2.set(0,0,0).applyMatrix4(this.scene.loadPosition);const i=this.camera.target.distanceTo(_position$2),n=this.scene.loadDistance-i;if(e>=0&&i<e)SceneManager.loadStages(this.scene,this.world,Math.max(e-i,.01));else if(t>=0)for(const e of this.scene.children)isNaN(e.userData.loadedDistance)||n<e.userData.loadedDistance||this.camera.target.distanceTo(e.position)<t||SceneManager.removeEntity(this.scene,e)}}SceneManager.renderWorld(this.world),this.isPlaying&&(_animationID=requestAnimationFrame(function(){this.animate()}.bind(this)))}start(){this.isPlaying||(this.isPlaying=!0,this._onKeyDown=onKeyDown.bind(this),this._onKeyUp=onKeyUp.bind(this),this._onPointerDown=onPointerDown.bind(this),this._onPointerUp=onPointerUp.bind(this),this._onPointerMove=onPointerMove.bind(this),document.addEventListener("keydown",this._onKeyDown),document.addEventListener("keyup",this._onKeyUp),document.addEventListener("pointerdown",this._onPointerDown),document.addEventListener("pointerup",this._onPointerUp),document.addEventListener("pointermove",this._onPointerMove),this.gameClock.start(!0),SceneManager.renderWorld(this.world),cancelAnimationFrame(_animationID),_animationID=requestAnimationFrame(function(){this.animate()}.bind(this)))}pause(){this.isPlaying&&this.gameClock.toggle()}stop(){this.isPlaying&&(this.isPlaying=!1,document.removeEventListener("keydown",this._onKeyDown),document.removeEventListener("keyup",this._onKeyUp),document.removeEventListener("pointerdown",this._onPointerDown),document.removeEventListener("pointerup",this._onPointerUp),document.removeEventListener("pointermove",this._onPointerMove),cancelAnimationFrame(_animationID),_animationID=null,this.renderer&&this.renderer.clear(),this.gameClock.stop(),SceneManager.dispose(),ObjectUtils.clearObject(this.camera),ObjectUtils.clearObject(this.scene),this.project.clear(),this.clearEvents())}setSize(e,t){e=Math.ceil(Math.max(1,e)),t=Math.ceil(Math.max(1,t)),this.camera&&this.camera.setSize(e,t),this.renderer&&this.renderer.setSize(e,t),SceneManager.setSize(e,t)}gameCoordinates(e){this.updatePointer(e);return CameraUtils.worldPoint({x:this.pointer.x,y:this.pointer.y},this.camera,this.camera.target,"none")}updatePointer(e){const t=this.dom.getBoundingClientRect(),i=e.clientX-t.left,n=e.clientY-t.top;this.pointer.x=i/t.width*2-1,this.pointer.y=-n/t.height*2+1}}function onKeyDown(e){this.isPlaying&&(this.keys[e.key]=!0,this.dispatch("keydown",e))}function onKeyUp(e){this.isPlaying&&(this.keys[e.key]=!1,this.dispatch("keyup",e))}function onPointerDown(e){if(this.isPlaying){this.updatePointer(e),_raycaster.setFromCamera(this.pointer,this.camera);const t=_raycaster.intersectObjects(this.scene.children,!0);e.entity=void 0;for(let i=0;i<t.length&&(e.entity=EntityUtils.parentEntity(t[i].object),!e.entity||!e.entity.isEntity);i++);this.dispatch("pointerdown",e)}}function onPointerUp(e){this.isPlaying&&this.dispatch("pointerup",e)}function onPointerMove(e){this.isPlaying&&this.dispatch("pointermove",e)}class EntityPool{constructor(){this.entities=[],this.expand()}getEntities(e){return e>this.entities.length&&this.expand(e-this.entities.length),this.entities.splice(0,e)}getEntity(){return this.entities.length||this.expand(),this.entities.pop()}recycle(e){e.dispose(),this.entities.push(e)}expand(e=10){for(let t=0;t<e;t++)this.entities.push(new Entity3D)}}class MoveCamera extends Script$1{constructor(){super(),this.name="Move Camera",this.category="camera",this.source="\n// Properties\nlet variables = {\n    // Rotation in degress per second\n    moveX: { type: 'number', default: 0 },\n    moveY: { type: 'number', default: 2 },\n    moveZ: { type: 'number', default: 0 },\n};\n\nfunction update(event) {\n    app.camera.position.x += moveX * event.delta;\n    app.camera.position.y += moveY * event.delta;\n    app.camera.position.z += moveZ * event.delta;\n}\n"}}class OrbitEntity extends Script$1{constructor(){super(),this.name="Orbit Entity",this.category="camera",this.source="\n// Properties\nlet variables = {\n    distance: { type: 'number', default: 10 },\n    orbit: { type: 'boolean', default: true },\n    pan: { type: 'boolean', default: false },\n    rotate: { type: 'boolean', default: false },\n    smooth: { type: 'boolean', default: true },\n};\n\n// Locals\nlet controls;\nlet direction;\nlet quaternion;\nlet up;\nlet rotation;\n\nfunction init() {\n    // Init Orbit Controls\n    app.camera.position.x = this.position.x;\n    app.camera.position.y = this.position.y;\n    app.camera.position.z = this.position.z + distance;\n    controls = new ONE.OrbitControls(app.camera, app.renderer.domElement, this);\n    controls.enablePan = pan;\n    controls.enableRotate = rotate;\n    controls.smoothAnimate = smooth;\n\n    // Initialize Temp Variables\n    direction = new THREE.Vector3();\n    quaternion = new THREE.Quaternion();\n    up = new THREE.Vector3(0, 1, 0);\n    rotation = new THREE.Vector3().copy(this.rotation)\n}\n\nfunction update(event) {\n    if (orbit) {\n        // Maintain World Up\n        this.getWorldQuaternion(quaternion);\n        direction.copy(up).applyQuaternion(quaternion);\n        app.camera.up.lerp(direction, event.delta * 10);\n\n        // Rotate to Match Entity\n        const angleDiff = (rotation.y - this.rotation.y);\n        controls.applyRotation(angleDiff);\n        rotation.copy(this.rotation);\n    }\n\n    // Update Orbit Controls\n    controls.centerOnTarget(this);\n    controls.update(event.delta);\n}\n"}}class DragControls extends Script$1{constructor(){super(),this.name="Drag Controls",this.category="control",this.source="\n// Properties\nlet variables = {\n    updateSpeed: { type: 'slider', default: 10, min: 0, max: 50 },\n};\n\n// Locals\nlet downOnEntity = false;\nlet position;\nlet pointer;\nlet camera;\n\nfunction init() {\n    position = new THREE.Vector3();\n    pointer = new THREE.Vector3();\n    camera = new THREE.Vector3();\n\n    // Starting Position\n    position.copy(this.position);\n}\n\nfunction pointerdown(event) {\n    if (event.entity === this && event.button !== 2) {\n        const coords = app.gameCoordinates(event);\n        pointer.copy(coords ? coords : this.position);\n        camera.copy(app.camera.position);\n        downOnEntity = true;\n    }\n}\n\nfunction pointermove(event) {\n    if (downOnEntity) {\n        const coords = app.gameCoordinates(event);\n        if (coords) pointer.copy(coords);\n    }\n}\n\nfunction pointerup(event) {\n    downOnEntity = false;\n}\n\nfunction update(event) {\n    if (downOnEntity) {\n        // Update Pointer\n        if (downOnEntity) position.lerp(pointer, event.delta * updateSpeed);\n\n        // Camera Moved?\n        pointer.x += app.camera.position.x - camera.x;\n        pointer.y += app.camera.position.y - camera.y;\n        pointer.z += app.camera.position.z - camera.z;\n        camera.copy(app.camera.position);\n    } else {\n        // Dissipate Target\n        position.lerp(this.position, event.delta * updateSpeed);\n    }\n\n    // Update Position\n    this.position.lerp(position, event.delta * updateSpeed);\n}\n\n"}}class DrivingControls extends Script$1{constructor(){super(),this.name="Driving Controls",this.category="control",this.source="\n// Properties\nlet variables = {\n    axis: { type: 'select', default: 'XY (2D)', select: [ 'XY (2D)', 'XZ (3D)' ] },\n    moveSpeed: { type: 'number', default: 5 },\n    turnSpeed: { type: 'number', default: 5 },\n    keyLeft: { type: 'key', default: 'ArrowLeft' },\n    keyRight: { type: 'key', default: 'ArrowRight' },\n    keyUp: { type: 'key', default: 'ArrowUp' },\n    keyDown: { type: 'key', default: 'ArrowDown' },\n};\n\n// Locals\nlet position, rotation;\nlet direction;\nlet quaternion;\nlet up;\nlet spin;\n\nfunction init() {\n    // Prep Variables\n    moveSpeed /= 100;\n    turnSpeed /= 100;\n\n    // Initialize Temp Variables\n    position = new THREE.Vector3();\n    rotation = new THREE.Vector3();\n    direction = new THREE.Vector3();\n    quaternion = new THREE.Quaternion();\n    up = new THREE.Vector3();\n    spin = new THREE.Vector3();\n\n    // Movement Type\n    if (axis === 'XY (2D)') {\n        spin.z = turnSpeed;\n        up.y = 1;\n    }\n    if (axis === 'XZ (3D)') {\n        spin.y = turnSpeed;\n        moveSpeed *= -1;\n        up.z = 1;\n    }\n\n    // Starting Position\n    position.copy(this.position);\n}\n\nfunction update(event) {\n    // Rotate\n    if (app.keys[keyLeft] || app.keys[keyRight]) {\n        rotation.setFromEuler(this.rotation);\n        if (app.keys[keyLeft]) rotation.add(spin);\n        if (app.keys[keyRight]) rotation.sub(spin);\n        this.rotation.setFromVector3(rotation);\n    }\n\n    // Movement\n    if (app.keys[keyUp] || app.keys[keyDown]) {\n        this.getWorldQuaternion(quaternion);\n        direction.copy(up).applyQuaternion(quaternion);\n        direction.multiplyScalar(moveSpeed);\n        if (app.keys[keyUp]) position.add(direction);\n        if (app.keys[keyDown]) position.sub(direction);\n    } else {\n        // Dissipate Movement\n        position.lerp(this.position, event.delta * 10);\n    }\n\n    // Update Position\n    this.position.lerp(position, event.delta * 10);\n}\n"}}class KeyControls extends Script$1{constructor(){super(),this.name="Key Controls",this.category="control",this.source="\n// Properties\nlet variables = {\n    moveSpeed: { type: 'number', default: 5 },\n    pixels: { type: 'number', default: 1 },\n    keyLeft: { type: 'key', default: 'ArrowLeft' },\n    keyRight: { type: 'key', default: 'ArrowRight' },\n    keyUp: { type: 'key', default: 'ArrowUp' },\n    keyDown: { type: 'key', default: 'ArrowDown' },\n};\n\n// Locals\nlet position;\n\nfunction init() {\n    // Starting Position\n    position = new THREE.Vector3().copy(this.position);\n\n    // \"Target\" Position (for smooth scrolling OrbitControls)\n    this.target = new THREE.Vector3().copy(position);\n}\n\nfunction update(event) {\n    // Movement\n    if (app.keys[keyLeft] || app.keys[keyRight] || app.keys[keyUp] || app.keys[keyDown]) {\n        if (app.keys[keyLeft]) position.x -= moveSpeed / 100;\n        if (app.keys[keyRight]) position.x += moveSpeed / 100;\n        if (app.keys[keyUp]) position.y += moveSpeed / 100;\n        if (app.keys[keyDown]) position.y -= moveSpeed / 100;\n    } else {\n        // Dissipate Movement\n        position.lerp(this.target, event.delta * moveSpeed);\n    }\n\n    this.target.lerp(position, event.delta * moveSpeed);\n\n    // Update Position\n    this.position.x = ((this.target.x * 100) - (this.target.x * 100) % pixels) / 100;\n    this.position.y = ((this.target.y * 100) - (this.target.y * 100) % pixels) / 100;\n    this.position.z = ((this.target.z * 100) - (this.target.z * 100) % pixels) / 100;\n}\n"}}class ZigZagControls extends Script$1{constructor(){super(),this.name="Zig Zag Controls",this.category="control",this.source="\n// Properties\nlet variables = {\n    forward: { type: 'number', default: 2 },\n    sideways: { type: 'number', default: 4 },\n    keySwitch: { type: 'key', default: ' ' },\n};\n\nfunction update(event) {\n    this.position.x += sideways * event.delta;\n    this.position.y += forward * event.delta;\n}\n\nfunction keydown(event) {\n    if (event.key === keySwitch) sideways *= -1;\n}\n"}}class ColorChange extends Script$1{constructor(){super(),this.name="Color Change",this.category="entity",this.source="\n// Properties\nlet variables = {\n    color: { type: 'color', default: 0xff0000 },\n};\n\nfunction init() {\n    this.updateComponent('material', { color: Number(color) });\n}\n\nfunction pointerdown(event) {\n    if (event.entity === this) {\n        const clr = new THREE.Color(Math.random(), Math.random(), Math.random());\n        this.replaceComponent('material', { color: clr });\n    }\n}\n"}}class FollowCamera extends Script$1{constructor(){super(),this.name="Follow Camera",this.category="entity",this.source="\n// Properties\nlet variables = {\n    offsetX: { type: 'number', default: 0 },\n\toffsetY: { type: 'number', default: 0 },\n    offsetZ: { type: 'number', default: 0 },\n};\n\nlet offset;\n\nfunction init() {\n    offset = new THREE.Vector3();\n    if (this.target) {\n    \toffset.copy(this.position).sub(this.target.position);\n    }\n}\n\nfunction update(event) {\n    if (app.camera && app.camera.target) {\n    \tthis.position.x = app.camera.target.x + offsetX;\n    \tthis.position.y = app.camera.target.y + offsetY;\n        this.position.z = app.camera.target.z + offsetZ;\n\n        if (this.target) {\n        \tthis.target.position.copy(this.position).sub(offset);\n        }\n    }\n}\n"}}class RotateEntity extends Script$1{constructor(){super(),this.name="Rotate Entity",this.category="entity",this.source="\n// Properties\nlet variables = {\n    // Rotation in degress per second\n    rotateX: { type: 'number', default: 0 },\n    rotateY: { type: 'number', default: 0 },\n    rotateZ: { type: 'number', default: 180 },\n};\n\nfunction update(event) {\n    this.rotation.x += (rotateX * (Math.PI / 180) * event.delta);\n    this.rotation.y += (rotateY * (Math.PI / 180) * event.delta);\n    this.rotation.z += (rotateZ * (Math.PI / 180) * event.delta);\n}\n"}}const _uv=[new THREE$1.Vector2,new THREE$1.Vector2,new THREE$1.Vector2],_vertex=[new THREE$1.Vector3,new THREE$1.Vector3,new THREE$1.Vector3],_temp=new THREE$1.Vector3;class GeometryUtils{static addAttribute(e,t="color",i=3,n=0){if(!e.getAttribute(t)){let s=new Float32Array(e.attributes.position.count*i).fill(n);const a=new THREE$1.BufferAttribute(s,i,!0).setUsage(THREE$1.DynamicDrawUsage);e.setAttribute(t,a)}return e}static coloredMesh(e){if(!e.geometry)return e;if(!e.material)return e;let t=e.material;!0!==Array.isArray(t)&&(t=[e.material]);for(let e=0;e<t.length;e++)!0!==t[e].vertexColors&&(t[e].vertexColors=!0,t[e].needsUpdate=!0);return GeometryUtils.addAttribute(e.geometry,"color",3,1),e}static modelSize(e,t="max"){let i=new THREE$1.Vector3;return e.computeBoundingBox(),e.boundingBox.getSize(i),"max"===t?Math.max(i.x,i.y,i.z):Math.min(i.x,i.y,i.z)}static repeatTexture(e,t,i){if(e&&e.attributes&&e.attributes.uv&&e.attributes.uv.array){for(let n=0;n<e.attributes.uv.array.length;n+=2)e.attributes.uv.array[n+0]*=t,e.attributes.uv.array[n+1]*=i;e.attributes.uv.needsUpdate=!0}}static uvFlip(e,t=!0,i=!0){if(e&&e.isBufferGeometry&&void 0!==e.attributes.uv)for(let n=0;n<e.attributes.uv.array.length;n+=2){let s=e.attributes.uv.array[n+0],a=e.attributes.uv.array[n+1];t&&(s=1-s),i&&(a=1-a),e.attributes.uv.array[n+0]=s,e.attributes.uv.array[n+1]=a}}static uvMapCube(e,t,i=!1){if(i&&null!==e.index){const t=e.toNonIndexed();e.dispose(),e=t}void 0===t&&(t=new THREE$1.Matrix4);const n=GeometryUtils.modelSize(e),s=n/2,a=new THREE$1.Box3(new THREE$1.Vector3(-s,-s,-s),new THREE$1.Vector3(s,s,s)),o=new THREE$1.Vector3;e.boundingBox.getCenter(o);const r=(new THREE$1.Matrix4).makeTranslation(-o.x,-o.y,-o.z),c=[];c.length=2*e.attributes.position.array.length/3;const l=e.attributes.position.array;if(e.index)for(let t=0;t<e.index.array.length;t+=3){const i=e.index.array[t+0],n=e.index.array[t+1],s=e.index.array[t+2];d(new THREE$1.Vector3(l[3*i+0],l[3*i+1],l[3*i+2]),new THREE$1.Vector3(l[3*n+0],l[3*n+1],l[3*n+2]),new THREE$1.Vector3(l[3*s+0],l[3*s+1],l[3*s+2])),c[2*i+0]=_uv[0].x,c[2*i+1]=_uv[0].y,c[2*n+0]=_uv[1].x,c[2*n+1]=_uv[1].y,c[2*s+0]=_uv[2].x,c[2*s+1]=_uv[2].y}else for(let t=0;t<e.attributes.position.array.length;t+=9){d(new THREE$1.Vector3(l[t+0],l[t+1],l[t+2]),new THREE$1.Vector3(l[t+3],l[t+4],l[t+5]),new THREE$1.Vector3(l[t+6],l[t+7],l[t+8]));const e=t/3,i=e+1,n=e+2;c[2*e+0]=_uv[0].x,c[2*e+1]=_uv[0].y,c[2*i+0]=_uv[1].x,c[2*i+1]=_uv[1].y,c[2*n+0]=_uv[2].x,c[2*n+1]=_uv[2].y}return void 0===e.attributes.uv&&e.addAttribute("uv",new THREE$1.Float32BufferAttribute(c,2)),e.attributes.uv.array=new Float32Array(c),e.attributes.uv.needsUpdate=!0,e;function d(e,s,o){e.applyMatrix4(r).applyMatrix4(t),s.applyMatrix4(r).applyMatrix4(t),o.applyMatrix4(r).applyMatrix4(t);const c=new THREE$1.Vector3;var l,d,h,u;if(l=c,d=e,h=s,u=o,_temp.subVectors(d,h),l.subVectors(h,u),l.cross(_temp).normalize(),Vectors.round(l,5),_uv[0].set(0,0,0),_uv[1].set(0,0,0),_uv[2].set(0,0,0),i){let t=c.z<0;t=t&&Math.abs(c.y)<.866,t=t&&Math.abs(c.x)<.866,t&&(_uv[0].x=(e.x-a.min.x)/n,_uv[0].y=(e.y-a.min.y)/n,_uv[1].x=(s.x-a.min.x)/n,_uv[1].y=(s.y-a.min.y)/n,_uv[2].x=(o.x-a.min.x)/n,_uv[2].y=(o.y-a.min.y)/n)}else c.x=Math.abs(c.x),c.y=Math.abs(c.y),c.z=Math.abs(c.z),c.y>c.x&&c.y>c.z?(_uv[0].x=(e.x-a.min.x)/n,_uv[0].y=(a.max.z-e.z)/n,_uv[1].x=(s.x-a.min.x)/n,_uv[1].y=(a.max.z-s.z)/n,_uv[2].x=(o.x-a.min.x)/n,_uv[2].y=(a.max.z-o.z)/n):c.x>c.y&&c.x>c.z?(_uv[0].x=(e.z-a.min.z)/n,_uv[0].y=(e.y-a.min.y)/n,_uv[1].x=(s.z-a.min.z)/n,_uv[1].y=(s.y-a.min.y)/n,_uv[2].x=(o.z-a.min.z)/n,_uv[2].y=(o.y-a.min.y)/n):c.z>c.y&&c.z>c.x&&(_uv[0].x=(e.x-a.min.x)/n,_uv[0].y=(e.y-a.min.y)/n,_uv[1].x=(s.x-a.min.x)/n,_uv[1].y=(s.y-a.min.y)/n,_uv[2].x=(o.x-a.min.x)/n,_uv[2].y=(o.y-a.min.y)/n)}}static uvMapSphere(e,t="uv"){if(null!==e.index){const t=e.toNonIndexed();t.uuid=e.uuid,t.name=e.name,e.dispose(),e=t}const i=[];i.length=2*e.attributes.position.array.length/3;const n=!(void 0===e.attributes.uv);n||e.addAttribute("uv",new THREE$1.Float32BufferAttribute(i,2));const s=!n||"u"===t||"uv"===t,a=!n||"v"===t||"uv"===t,o=e.attributes.position.array;for(let t=0;t<e.attributes.position.array.length;t+=9){_vertex[0].set(o[t+0],o[t+1],o[t+2]),_vertex[1].set(o[t+3],o[t+4],o[t+5]),_vertex[2].set(o[t+6],o[t+7],o[t+8]);let e=t/3;for(let t=0;t<3;t++){const i=c(_vertex[t]);if(0===i.theta&&(0===i.phi||i.phi===Math.PI)){const e=0===i.phi?"1":"0";i.theta=c(_vertex[e]).theta}r(i,e,t),e++}let n=!1;if(Math.abs(_uv[0].x-_uv[1].x)>.75&&(n=!0),Math.abs(_uv[0].x-_uv[2].x)>.75&&(n=!0),Math.abs(_uv[1].x-_uv[0].x)>.75&&(n=!0),Math.abs(_uv[1].x-_uv[2].x)>.75&&(n=!0),Math.abs(_uv[2].x-_uv[0].x)>.75&&(n=!0),Math.abs(_uv[2].x-_uv[1].x)>.75&&(n=!0),n){let e=t/3;for(let t=0;t<3;t++){i[2*e]>.75&&(i[2*e]=0),e++}}}return e.attributes.uv.array=new Float32Array(i),e.attributes.uv.needsUpdate=!0,e;function r(t,n,o){const r={x:((c=t).theta+Math.PI)/(2*Math.PI),y:c.phi/Math.PI};var c;const l=new THREE$1.Vector2(1-r.x,1-r.y),d=2*n+0,h=2*n+1;i[d]=s?l.x:e.attributes.uv.array[d],i[h]=a?l.y:e.attributes.uv.array[h],_uv[o].x=i[d],_uv[o].y=i[h]}function c(e){let t=e.x*e.x+e.y*e.y+e.z*e.z,i=Math.sqrt(t);return{r:i,theta:Math.atan2(e.z,e.x),phi:Math.acos(e.y/i)}}}}const _color=new THREE$1.Color,_position$1=new THREE$1.Vector3;class SVGBuilder{static createFromPaths(e,t,i,n=""){let s=0,a=0;if(t.forEach((t=>{let i=t.userData.style.fill,o=t.userData.style.fillOpacity;if(o||0===o||(o=1),void 0!==i&&"none"!==i){SVGLoader.createShapes(t).forEach((t=>{let r=`Fill ${a}`;""!==n&&(r=n+" "+r);const c=new Entity3D(r),l=.001;function d(e){e.aX&&(e.aX*=l),e.aY&&(e.aY*=l),e.xRadius&&(e.xRadius*=l),e.yRadius&&(e.yRadius*=l),e.v0&&e.v0.multiplyScalar(l),e.v1&&e.v1.multiplyScalar(l),e.v2&&e.v2.multiplyScalar(l),e.v3&&e.v3.multiplyScalar(l)}for(let e=0;e<t.curves.length;e++)d(t.curves[e]);for(let e=0;e<t.holes.length;e++)for(let i=0;i<t.holes[e].curves.length;i++)d(t.holes[e].curves[i]);const h=new THREE$1.ExtrudeGeometry(t,{depth:.256,bevelEnabled:!1,bevelThickness:.25,bevelSegments:8,curveSegments:16,steps:4});h.name=r,h.translate(0,0,-.128),h.scale(1,-1,-1),h.computeBoundingBox(),h.boundingBox.getCenter(_position$1),h.center(),c.position.copy(_position$1),GeometryUtils.uvFlip(h,!1,!0),c.addComponent("geometry",h),c.addComponent("material",{style:"standard",side:"FrontSide",color:_color.setStyle(i).getHex(),opacity:o}),c.position.z=s,e.add(c),s+=.001,a++}))}})),e.children&&e.children.length>0){const t=new THREE$1.Vector3;ObjectUtils.computeCenter(e.children,t);for(let i of e.children)i.position.x-=t.x-e.position.x,i.position.y-=t.y-e.position.y}e.name=n,i&&"function"==typeof i&&i(e)}static createFromFile(e,t){const i=new Entity3D;return(new SVGLoader).load(e,(function(n){SVGBuilder.createFromPaths(i,n.paths,t,Strings.nameFromUrl(e))})),i}}let _renderer$1;class RenderUtils{static offscreenRenderer(e,t){return void 0===_renderer$1&&(_renderer$1=new Renderer3D({alpha:!0}),_renderer$1.setSize(512,512,!1),_renderer$1.outputColorSpace=THREE$1.LinearSRGBColorSpace),Maths.isNumber(e)&&Maths.isNumber(t)&&_renderer$1.setSize(e,t,!1),_renderer$1}static renderGeometryToCanvas(e,t,i,n=16777215){const s=i??new THREE$1.MeshStandardMaterial({color:n}),a=t??new THREE$1.SphereGeometry,o=new THREE$1.Mesh(a,s);RenderUtils.renderMeshToCanvas(e,o),o&&"function"==typeof o.dispose&&o.dispose(),i||s.dispose(),t||a.dispose()}static renderMeshToCanvas(e,t){const i=new THREE$1.Scene,n=new THREE$1.HemisphereLight(16777215,2105376,7.5);i.add(n);const s=new THREE$1.PerspectiveCamera(50,e.width/e.height);s.position.set(0,0,1),CameraUtils.fitCameraToObject(s,t);const a=t.parent;i.add(t);const o=RenderUtils.offscreenRenderer(e.width,e.height);o.render(i,s),i.remove(t),a&&a.add(t),"function"==typeof n.dispose&&n.dispose();const r=e.getContext("2d");r&&(r.clearRect(0,0,e.width,e.height),r.drawImage(o.domElement,0,0,e.width,e.height))}static renderTextureToCanvas(e,t){const i=new THREE$1.Scene;let n,s,a,o,r=1;if(t.isCubeTexture){if(t.isCubeTexture){n=new THREE$1.PerspectiveCamera(50,e.width/e.height),n.position.set(0,0,-3),n.lookAt(new THREE$1.Vector3(0,0,0));const r=THREE$1.ShaderLib.cube;s=new THREE$1.ShaderMaterial({fragmentShader:r.fragmentShader,vertexShader:r.vertexShader,uniforms:THREE$1.UniformsUtils.clone(r.uniforms),depthWrite:!1,side:THREE$1.BackSide}),s.uniforms.tCube.value=t,s.needsUpdate=!0,a=new THREE$1.BoxGeometry(2,2,2),o=new THREE$1.Mesh(a,s),i.add(o)}}else{const e=t.image;if(!e||!e.complete)return;r=e.width/e.height,n=new THREE$1.OrthographicCamera(-1,1,1,-1,0,1),s=new THREE$1.MeshBasicMaterial({map:t,alphaTest:!0}),a=new THREE$1.PlaneGeometry(2,2),o=new THREE$1.Mesh(a,s),i.add(o)}const c=e.width,l=e.height,d=RenderUtils.offscreenRenderer(c,l);d.render(i,n),s&&"function"==typeof s.dispose&&s.dispose(),a&&"function"==typeof a.dispose&&a.dispose(),o&&"function"==typeof o.dispose&&o.dispose();const h=e.getContext("2d");if(h){const t=e.width/e.height;let i,n,s,a,o;r<t?(a=e.height,o=r/t,s=e.width*o):(s=e.width,o=t/r,a=e.height*o),i=(e.width-s)/2,n=(e.height-a)/2,h.clearRect(0,0,e.width,e.height),h.drawImage(d.domElement,0,0,c,l,i,n,s,a)}}}const MOUSE_MODES={SELECT:"select",LOOK:"look",MOVE:"move",ZOOM:"zoom"},ORBIT_STATES={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},ORBIT_ANIMATION={NONE:0,START:1,ZOOMING:2},_changeEvent={type:"change"},_startEvent={type:"start"},_endEvent={type:"end"};class OrbitControls extends THREE$1.EventDispatcher{constructor(e,t,i){super();const n=this;null==t&&console.warn('OrbitControls: The second parameter "domElement" is now mandatory.'),t===document&&console.error('OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.camera=e,this.domElement=t,this.domElement.style.touchAction="none",this.animating=ORBIT_ANIMATION.NONE,this.forceEndAnimation=!1,this.enabled=!0,this.signals=!1,this.target=new THREE$1.Vector3,i&&i.isObject3D?i.getWorldPosition(this.target):this.target.set(0,0,0),this.minDistance=.2,this.maxDistance=250,this.minZoom=.021,this.maxZoom=25,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.smoothAnimate=!0,this.enableSmooth=!0,this.dampSmooth=15,this.enableDamping=!0,this.dampingFactor=.2,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=20,this.autoRotate=!1,this.autoRotateSpeed=2;let s=ORBIT_STATES.NONE;const a=new THREE$1.Spherical,o=new THREE$1.Spherical;let r=1;const c=new THREE$1.Vector3;let l=!1,d=0;const h=new THREE$1.Vector2,u=new THREE$1.Vector2,p=new THREE$1.Vector2,m=new THREE$1.Vector2,y=new THREE$1.Vector2,g=new THREE$1.Vector2,f=new THREE$1.Vector2,b=new THREE$1.Vector2,E=new THREE$1.Vector2,v=new THREE$1.Vector3,x=[],w={},S=new THREE$1.Vector3,A=new THREE$1.Vector3;let T=0;const R=new THREE$1.Box3,M=new THREE$1.Vector3,C=new THREE$1.Sphere;new THREE$1.Vector3;function I(e){o.theta-=e}function P(e){o.phi-=e}this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.target0=this.target.clone(),this.position0=this.camera.position.clone(),this.zoom0=this.camera.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return a.phi},this.getAzimuthalAngle=function(){return a.theta},this.getDistance=function(){return this.camera.position.distanceTo(this.target)},this.listenToKeyEvents=function(e){e.addEventListener("keydown",Y),e.addEventListener("keyup",$),this._domElementKeyEvents=e},this.saveState=function(){this.target0.copy(this.target),this.position0.copy(this.camera.position),this.zoom0=this.camera.zoom},this.reset=function(){s===ORBIT_STATES.NONE&&(S.copy(this.position0),A.copy(this.target0),T=this.zoom0,this.animating=ORBIT_ANIMATION.START)},this.changeCamera=function(e){n.animating!==ORBIT_ANIMATION.NONE&&(n.forceEndAnimation=!0,n.update()),n.camera=e},this.centerOnTarget=function(e){if(!e||!e.isObject3D)return;if(s!==ORBIT_STATES.NONE)return;const t=e.target??e.position??e;S.copy(this.camera.position).add(t).sub(this.target),A.copy(t),T=this.camera.zoom,this.animating=ORBIT_ANIMATION.START},this.focusOnTarget=function(e){if(!e||!e.isObject3D)return;if(s!==ORBIT_STATES.NONE)return;const t=new THREE$1.Box3;e.traverseVisible((e=>{if(!e||!e.isObject3D)return;if(e.isWorld)return;if(e.isStage)return;if(e.userData.flagIgnore)return;const i=e.geometry;i&&i.isBufferGeometry&&(i.boundingBox||i.computeBoundingBox(),e.updateWorldMatrix(!1,!1),R.copy(i.boundingBox).applyMatrix4(e.matrixWorld),t.union(R))}));let i=.1;!1===t.isEmpty()&&(t.getBoundingSphere(C),i=C.radius,i=Math.pow(i,.7)),i*=5,M.set(0,0,i),M.applyQuaternion(this.camera.quaternion),S.copy(e.position).add(M),A.copy(e.position),T=this.camera.zoom,this.animating=ORBIT_ANIMATION.START},this.getCameraZoom=function(e=void 0){return this.position0.distanceTo(this.target0)/this.distanceToTarget(e)},this.distanceToTarget=function(e=void 0){return e&&e.isObject3D&&(e=e.position),this.camera.position.distanceTo(e??this.target)},this.applyRotation=function(e){I(e)},this.update=function(e){const t=new THREE$1.Vector3,i=(new THREE$1.Quaternion).setFromUnitVectors(n.camera.up,new THREE$1.Vector3(0,1,0)),h=i.clone().invert(),u=new THREE$1.Vector3,p=new THREE$1.Quaternion,m=2*Math.PI;return function(e){if(!1===n.enabled)return!1;e||(e=d),d=e;let y=!1;if(n.animating!==ORBIT_ANIMATION.NONE){let t,i;n.smoothAnimate&&!l&&s===ORBIT_STATES.NONE||(n.forceEndAnimation=!0),n.animating===ORBIT_ANIMATION.ZOOMING?(t=n.dampSmooth/2,i=2*e):(t=n.dampSmooth,i=e),n.camera.position.x=Maths.damp(n.camera.position.x,S.x,t,i),n.camera.position.y=Maths.damp(n.camera.position.y,S.y,t,i),n.camera.position.z=Maths.damp(n.camera.position.z,S.z,t,i),n.target.x=Maths.damp(n.target.x,A.x,t,i),n.target.y=Maths.damp(n.target.y,A.y,t,i),n.target.z=Maths.damp(n.target.z,A.z,t,i),n.camera.zoom=Maths.damp(n.camera.zoom,T,t,i);y=Maths.fuzzyVector(n.camera.position,S,.001)&&!0||n.forceEndAnimation,y&&(n.camera.position.copy(S),n.target.copy(A),n.camera.zoom=T),n.camera.updateWorldMatrix(!0),n.camera.updateProjectionMatrix(n.target),n.camera.lookAt(n.target),y&&(n.animating===ORBIT_ANIMATION.ZOOMING&&(l=!0),n.animating=ORBIT_ANIMATION.NONE,n.forceEndAnimation=!1),n.dispatchEvent(_changeEvent)}this.signals&&window.signals&&(l?signals.showInfo.dispatch(`${(100*this.getCameraZoom()).toFixed(0)}%`):n.animating!==ORBIT_ANIMATION.NONE&&signals.showInfo.dispatch(`${(100*this.getCameraZoom(A)).toFixed(0)}%`));const g=n.camera.position;if(t.copy(g).sub(n.target),t.applyQuaternion(i),a.setFromVector3(t),n.autoRotate&&s===ORBIT_STATES.NONE&&I(2*Math.PI/60/60*n.autoRotateSpeed),n.enableSmooth&&n.smoothAnimate){let t=a.theta+o.theta,i=a.phi+o.phi,s=Maths.damp(a.theta,t,n.dampSmooth,e),r=Maths.damp(a.phi,i,n.dampSmooth,e);Number.isNaN(s)&&(s=a.theta),Number.isNaN(r)&&(r=a.phi),o.theta-=s-a.theta,o.phi-=r-a.phi,a.theta=s,a.phi=r;let l=n.target.x+c.x,d=n.target.y+c.y,h=n.target.z+c.z,u=Maths.damp(n.target.x,l,2*n.dampSmooth,e),p=Maths.damp(n.target.y,d,2*n.dampSmooth,e),m=Maths.damp(n.target.z,h,2*n.dampSmooth,e);Number.isNaN(u)&&(u=n.target.x),Number.isNaN(p)&&(p=n.target.y),Number.isNaN(m)&&(m=n.target.z),c.x-=u-n.target.x,c.y-=p-n.target.y,c.z-=m-n.target.z,n.target.x=u,n.target.y=p,n.target.z=m}else n.enableDamping&&n.smoothAnimate?(a.theta+=o.theta*n.dampingFactor,a.phi+=o.phi*n.dampingFactor,o.theta*=1-n.dampingFactor,o.phi*=1-n.dampingFactor,n.target.addScaledVector(c,n.dampingFactor),c.multiplyScalar(1-n.dampingFactor)):(a.theta+=o.theta,a.phi+=o.phi,o.set(0,0,0),n.target.add(c),c.set(0,0,0));let f=n.minAzimuthAngle,b=n.maxAzimuthAngle;return isFinite(f)&&isFinite(b)&&(f<-Math.PI?f+=m:f>Math.PI&&(f-=m),b<-Math.PI?b+=m:b>Math.PI&&(b-=m),a.theta=f<=b?Math.max(f,Math.min(b,a.theta)):a.theta>(f+b)/2?Math.max(f,a.theta):Math.min(b,a.theta)),a.phi=Math.max(n.minPolarAngle,Math.min(n.maxPolarAngle,a.phi)),a.makeSafe(),a.radius*=r,a.radius=Math.max(n.minDistance,Math.min(n.maxDistance,a.radius)),t.setFromSpherical(a),t.applyQuaternion(h),g.copy(n.target).add(t),n.camera.lookAt(n.target),r=1,!!(l||u.distanceToSquared(n.camera.position)>.001||8*(1-p.dot(n.camera.quaternion))>.001)&&(n.dispatchEvent(_changeEvent),u.copy(n.camera.position),p.copy(n.camera.quaternion),l=!1,!0)}}(),this.dispose=function(){this.domElement.removeEventListener("contextmenu",Q),this.domElement.removeEventListener("pointerdown",F),this.domElement.removeEventListener("pointercancel",V),this.domElement.removeEventListener("wheel",_),this.domElement.removeEventListener("pointermove",Z),this.domElement.removeEventListener("pointerup",W),this._domElementKeyEvents&&(this._domElementKeyEvents.removeEventListener("keydown",Y),this._domElementKeyEvents.removeEventListener("keyup",$))};const H=function(){const e=new THREE$1.Vector3;return function(t,i){e.setFromMatrixColumn(i,0),e.multiplyScalar(-t),c.add(e)}}(),O=function(){const e=new THREE$1.Vector3;return function(t,i){!0===n.screenSpacePanning?e.setFromMatrixColumn(i,1):(e.setFromMatrixColumn(i,0),e.crossVectors(n.camera.up,e)),e.multiplyScalar(t),c.add(e)}}(),D=function(){const e=new THREE$1.Vector3;return function(t,i){const s=n.domElement;if(n.camera.isPerspectiveCamera||n.camera.isOrthographicCamera){const a=n.camera.position;e.copy(a).sub(n.target);let o=e.length();o*=Math.tan(n.camera.fov/2*Math.PI/180),H(2*t*o/s.clientHeight,n.camera.matrix),O(2*i*o/s.clientHeight,n.camera.matrix)}else console.warn("OrbitControls.pan: Unknown camera type, pan disabled"),n.enablePan=!1}}();function k(){return Math.pow(.95,n.zoomSpeed)}function z(e){n.camera.isPerspectiveCamera||n.camera.isOrthographicCamera?(r/=e,l=!0):(console.warn("OrbitControls.dollyOut: Unknown camera type, dolly / zoom disabled"),n.enableZoom=!1)}function B(e){var t;b.set(e.clientX,e.clientY),E.subVectors(b,f),E.y>0?z(k()):E.y<0&&(t=k(),n.camera.isPerspectiveCamera||n.camera.isOrthographicCamera?(r*=t,l=!0):(console.warn("OrbitControls.dollyIn: Unknown camera type, dolly / zoom disabled"),n.enableZoom=!1)),f.copy(b),n.update()}function L(e){!function(e,t=1){if(s===ORBIT_STATES.NONE){if(A.copy(n.target),n.camera.isPerspectiveCamera||n.camera.isOrthographicCamera){n.animating===ORBIT_ANIMATION.NONE?v.copy(n.camera.position):v.copy(S),n.position0.distanceTo(n.target0);let i,s=v.distanceTo(n.target);if(1===t){if(i=s*e-s,s+i<n.minDistance)return}else if(i=s/e-s,s+i>n.maxDistance)return;M.set(0,0,i).applyQuaternion(n.camera.quaternion),S.copy(v).add(M),T=n.camera.zoom}!isNaN(S.x)&&isFinite(S.x)||(S.x=0),!isNaN(S.y)&&isFinite(S.y)||(S.y=0),!isNaN(S.z)&&isFinite(S.z)||(S.z=5),!isNaN(T)&&isFinite(T)||(T=1),n.animating=ORBIT_ANIMATION.ZOOMING}}(k(),e.deltaY<0?1:-1),n.update()}function j(){n.enableZoom&&function(){const e=x[0].pageX-x[1].pageX,t=x[0].pageY-x[1].pageY,i=Math.sqrt(e*e+t*t);f.set(0,i)}(),n.enablePan&&function(){if(1===x.length)m.set(x[0].pageX,x[0].pageY);else{const e=.5*(x[0].pageX+x[1].pageX),t=.5*(x[0].pageY+x[1].pageY);m.set(e,t)}}()}function U(e){if(1==x.length)u.set(e.pageX,e.pageY);else{const t=K(e),i=.5*(e.pageX+t.x),n=.5*(e.pageY+t.y);u.set(i,n)}p.subVectors(u,h).multiplyScalar(n.rotateSpeed);const t=n.domElement;I(2*Math.PI*p.x/t.clientHeight),P(2*Math.PI*p.y/t.clientHeight),h.copy(u)}function N(e){if(1===x.length)y.set(e.pageX,e.pageY);else{const t=K(e),i=.5*(e.pageX+t.x),n=.5*(e.pageY+t.y);y.set(i,n)}g.subVectors(y,m).multiplyScalar(n.panSpeed),D(g.x,g.y),m.copy(y)}function G(e){const t=K(e),i=e.pageX-t.x,s=e.pageY-t.y,a=Math.sqrt(i*i+s*s);b.set(0,a),E.set(0,Math.pow(b.y/f.y,n.zoomSpeed)),z(E.y),f.copy(b)}function F(e){!1!==n.enabled&&(n.animating!==ORBIT_ANIMATION.NONE&&(n.forceEndAnimation=!0,n.update()),0===x.length&&(n.domElement.setPointerCapture(e.pointerId),n.domElement.addEventListener("pointermove",Z),n.domElement.addEventListener("pointerup",W)),function(e){x.push(e)}(e),"touch"===e.pointerType?function(e){switch(X(e),x.length){case 1:if(!1===n.enableRotate)return;if(!0===n.camera.rotateLock)return;!function(){if(1===x.length)h.set(x[0].pageX,x[0].pageY);else{const e=.5*(x[0].pageX+x[1].pageX),t=.5*(x[0].pageY+x[1].pageY);h.set(e,t)}}(),s=ORBIT_STATES.TOUCH_ROTATE;break;case 2:if(!1===n.enableZoom&&!1===n.enablePan)return;j(),s=ORBIT_STATES.TOUCH_DOLLY_PAN;break;default:s=ORBIT_STATES.NONE}s!==ORBIT_STATES.NONE&&(_startEvent.value=s,n.dispatchEvent(_startEvent))}(e):function(e){let t=THREE$1.MOUSE.ROTATE;if(n.domElement&&n.domElement.classList.contains("one-viewport"))if(0!==e.button||n.spaceKey)2===e.button||0===e.button&&n.spaceKey?n.camera.isOrthographicCamera?t=editor.viewport.mouseMode===MOUSE_MODES.MOVE?n.spaceKey?THREE$1.MOUSE.PAN:THREE$1.MOUSE.ROTATE:n.spaceKey?THREE$1.MOUSE.ROTATE:THREE$1.MOUSE.PAN:(t=editor.viewport.mouseMode===MOUSE_MODES.LOOK?n.spaceKey?THREE$1.MOUSE.ROTATE:THREE$1.MOUSE.PAN:n.spaceKey?THREE$1.MOUSE.PAN:THREE$1.MOUSE.ROTATE,n.camera.rotateLock&&(t=THREE$1.MOUSE.PAN)):t=-1;else switch(editor.viewport.mouseMode){case MOUSE_MODES.SELECT:t=THREE$1.MOUSE.PAN;break;case MOUSE_MODES.LOOK:t=THREE$1.MOUSE.ROTATE;break;case MOUSE_MODES.MOVE:t=THREE$1.MOUSE.PAN;break;case MOUSE_MODES.ZOOM:t=THREE$1.MOUSE.DOLLY;break;default:t=-1}else t=0===e.button?THREE$1.MOUSE.PAN:2===e.button?THREE$1.MOUSE.ROTATE:-1;switch(t){case THREE$1.MOUSE.DOLLY:if(!1===n.enableZoom)return;!function(e){f.set(e.clientX,e.clientY)}(e),s=ORBIT_STATES.DOLLY;break;case THREE$1.MOUSE.ROTATE:if(!1===n.enableRotate)return;if(!0===n.camera.rotateLock)return;!function(e){h.set(e.clientX,e.clientY)}(e),s=ORBIT_STATES.ROTATE;break;case THREE$1.MOUSE.PAN:if(!1===n.enablePan)return;!function(e){m.set(e.clientX,e.clientY)}(e),s=ORBIT_STATES.PAN;break;default:s=ORBIT_STATES.NONE}s!==ORBIT_STATES.NONE&&(_startEvent.value=s,n.dispatchEvent(_startEvent))}(e))}function Z(e){!1!==n.enabled&&document.activeElement.contains(n.domElement)&&("touch"===e.pointerType?function(e){switch(X(e),s){case ORBIT_STATES.TOUCH_ROTATE:if(!1===n.enableRotate)return;U(e),n.update();break;case ORBIT_STATES.TOUCH_PAN:if(!1===n.enablePan)return;N(e),n.update();break;case ORBIT_STATES.TOUCH_DOLLY_PAN:if(!1===n.enableZoom&&!1===n.enablePan)return;!function(e){n.enableZoom&&G(e),n.enablePan&&N(e)}(e),n.update();break;case ORBIT_STATES.TOUCH_DOLLY_ROTATE:if(!1===n.enableZoom&&!1===n.enableRotate)return;!function(e){n.enableZoom&&G(e),n.enableRotate&&U(e)}(e),n.update();break;default:s=ORBIT_STATES.NONE}}(e):function(e){if(!1===n.enabled)return;switch(s){case ORBIT_STATES.ROTATE:if(!1===n.enableRotate)return;!function(e){u.set(e.clientX,e.clientY),p.subVectors(u,h).multiplyScalar(n.rotateSpeed);const t=n.domElement;I(2*Math.PI*p.x/t.clientHeight),P(2*Math.PI*p.y/t.clientHeight),h.copy(u),n.update()}(e);break;case ORBIT_STATES.DOLLY:if(!1===n.enableZoom)return;B(e);break;case ORBIT_STATES.PAN:if(!1===n.enablePan)return;!function(e){y.set(e.clientX,e.clientY),g.subVectors(y,m).multiplyScalar(n.panSpeed),D(g.x,g.y),m.copy(y),n.update()}(e)}}(e))}function W(e){J(e),0===x.length&&(n.domElement.releasePointerCapture(e.pointerId),n.domElement.removeEventListener("pointermove",Z),n.domElement.removeEventListener("pointerup",W)),n.dispatchEvent(_endEvent),s=ORBIT_STATES.NONE}function V(e){J(e)}function _(e){!1!==n.enabled&&!1!==n.enableZoom&&s===ORBIT_STATES.NONE&&(e.preventDefault(),_startEvent.value=ORBIT_STATES.DOLLY,n.dispatchEvent(_startEvent),L(e),n.dispatchEvent(_endEvent))}function Y(e){!1!==n.enabled&&!1!==n.enablePan&&function(e){" "===e.key&&(n.spaceKey=!0)}(e)}function $(e){!1!==n.enabled&&!1!==n.enablePan&&function(e){" "===e.key&&(n.spaceKey=!1)}(e)}function Q(e){!1!==n.enabled&&e.preventDefault()}function J(e){delete w[e.pointerId];for(let t=0;t<x.length;t++)if(x[t].pointerId==e.pointerId)return void x.splice(t,1)}function X(e){let t=w[e.pointerId];null==t&&(t=new THREE$1.Vector2,w[e.pointerId]=t),t.set(e.pageX,e.pageY)}function K(e){const t=e.pointerId===x[0].pointerId?x[1]:x[0];return w[t.pointerId]}this.domElement.addEventListener("contextmenu",Q),this.domElement.addEventListener("pointerdown",F),this.domElement.addEventListener("pointercancel",V),this.domElement.addEventListener("wheel",_,{passive:!1}),this.update()}}class CapsuleGeometry extends THREE$1.BufferGeometry{constructor(e=1,t=1,i=2,n=12,s=1,a=5,o=5,r,c){super(),this.type="CapsuleGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:n,heightSegments:s,thetaStart:r,thetaLength:c},e=void 0!==e?e:1,t=void 0!==t?t:1,i=void 0!==i?i:2,e=Maths.clamp(e,.001,i),t=Maths.clamp(t,.001,i),i<.001&&(i=.001),n=Math.floor(n)||12,s=Math.floor(s)||1,a=Math.floor(a)||5,o=Math.floor(o)||5,r=void 0!==r?r:0,c=void 0!==c?c:2*Math.PI;let l=Math.acos((t-e)/i),d=(n+1)*(s+1+o+a),h=n*(s+o+a)*2*3,u=new THREE$1.BufferAttribute(new(h>65535?Uint32Array:Uint16Array)(h),1),p=new THREE$1.BufferAttribute(new Float32Array(3*d),3),m=new THREE$1.BufferAttribute(new Float32Array(3*d),3),y=new THREE$1.BufferAttribute(new Float32Array(2*d),2),g=0,f=0,b=[],E=i/2;!function(){let d,h,v=new THREE$1.Vector3,x=new THREE$1.Vector3,w=Math.cos(l),S=Math.sin(l),A=new THREE$1.Vector2(e*S,E+e*w).sub(new THREE$1.Vector2(t*S,t*w-E)).length(),T=e*l+A+t*(Math.PI/2-l),R=0;for(h=0;h<=a;h++){let t=[],i=Math.PI/2-l*(h/a);R+=e*l/a;let s=Math.cos(i),o=Math.sin(i),u=s*e;for(d=0;d<=n;d++){let i=d/n,a=i*c+r,l=Math.sin(a),h=Math.cos(a);x.x=u*l,x.y=E+o*e,x.z=u*h,p.setXYZ(g,x.x,x.y,x.z),v.set(s*l,o,s*h),m.setXYZ(g,v.x,v.y,v.z),y.setXY(g,i,1-R/T),t.push(g),g++}b.push(t)}let M=i+w*e-w*t,C=S*(t-e)/M;for(h=1;h<=s;h++){let i=[];R+=A/s;let a=S*(h*(t-e)/s+e);for(d=0;d<=n;d++){let t=d/n,o=t*c+r,l=Math.sin(o),u=Math.cos(o);x.x=a*l,x.y=E+w*e-h*M/s,x.z=a*u,p.setXYZ(g,x.x,x.y,x.z),v.set(l,C,u).normalize(),m.setXYZ(g,v.x,v.y,v.z),y.setXY(g,t,1-R/T),i.push(g),g++}b.push(i)}for(h=1;h<=o;h++){let e=[],i=Math.PI/2-l-(Math.PI-l)*(h/o);R+=t*l/o;let s=Math.cos(i),a=Math.sin(i),u=s*t;for(d=0;d<=n;d++){let i=d/n,o=i*c+r,l=Math.sin(o),h=Math.cos(o);x.x=u*l,x.y=a*t-E,x.z=u*h,p.setXYZ(g,x.x,x.y,x.z),v.set(s*l,a,s*h),m.setXYZ(g,v.x,v.y,v.z),y.setXY(g,i,1-R/T),e.push(g),g++}b.push(e)}for(d=0;d<n;d++)for(h=0;h<a+s+o;h++){let e=b[h][d],t=b[h+1][d],i=b[h+1][d+1],n=b[h][d+1];u.setX(f,e),f++,u.setX(f,t),f++,u.setX(f,n),f++,u.setX(f,t),f++,u.setX(f,i),f++,u.setX(f,n),f++}}(),this.setIndex(u),this.setAttribute("position",p),this.setAttribute("normal",m),this.setAttribute("uv",y)}static fromPoints(e,t,i,n,s,a,o,r,c,l){let d=null,h=null,u=null,p=null;h=e,d=t,p=i,u=n;const m=d,y=h,g=u,f=p,b=new THREE$1.Vector3(m.x,m.y,m.z),E=new THREE$1.Vector3(y.x,y.y,y.z),v=g,x=f;let w=b.distanceTo(E);if(w<Math.abs(g-f)){let e=new THREE$1.SphereGeometry(f,s,r,c,l);return e.translate(f.x,f.y,f.z),e}const S=Math.acos((x-v)/w),A=Math.cos(S),T=new THREE$1.Matrix4,R=new THREE$1.Quaternion,M=new THREE$1.Vector3(0,1,0),C=new THREE$1.Vector3;C.subVectors(b,E),C.normalize(),R.setFromUnitVectors(M,C),T.makeRotationFromQuaternion(R);const I=new THREE$1.Matrix4,P=new THREE$1.Vector3;P.subVectors(b,E),P.normalize();let H=new THREE$1.Vector3;H=b,H.addScaledVector(P,A*v);let O=new THREE$1.Vector3;O=E,O.addScaledVector(P,A*x);const D=new THREE$1.Vector3;D.subVectors(O,H),D.normalize();const k=new THREE$1.Vector3;k.lerpVectors(O,H,.5),I.makeTranslation(k.x,k.y,k.z);let z=new CapsuleGeometry(x,v,w,s,a,o,r,c,l);return z.applyMatrix(T),z.applyMatrix(I),z}}class CylinderGeometry extends THREE$1.BufferGeometry{constructor(e=1,t=1,i=1,n=8,s=1,a=!1,o=0,r=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:n,heightSegments:s,openEnded:a,thetaStart:o,thetaLength:r};const c=this;n=Math.floor(n),s=Math.floor(s);const l=[],d=[],h=[],u=[];let p=0;const m=[],y=i/2;let g=0;function f(i){const s=p,a=new THREE$1.Vector2,m=new THREE$1.Vector3;let f=0;const b=!0===i?e:t,E=!0===i?1:-1;for(let e=1;e<=n;e++)d.push(0,y*E,0),h.push(0,E,0),u.push(.5,.5),p++;const v=p;for(let e=0;e<=n;e++){const t=e/n*r+o,i=Math.cos(t),s=Math.sin(t);m.x=b*s,m.y=y*E,m.z=b*i,d.push(m.x,m.y,m.z),h.push(0,E,0),a.x=.5*i+.5,a.y=.5*s*E+.5,u.push(a.x,a.y),p++}for(let e=0;e<n;e++){const t=s+e,n=v+e;!0===i?l.push(n,n+1,t):l.push(n+1,n,t),f+=3}c.addGroup(g,f,!0===i?1:2),g+=f}!function(){const a=new THREE$1.Vector3,f=new THREE$1.Vector3;let b=0;const E=(t-e)/i;for(let c=0;c<=s;c++){const l=[],g=c/s,b=g*(t-e)+e;for(let e=0;e<=n;e++){const t=e/n,s=t*r+o,c=Math.sin(s),m=Math.cos(s);f.x=b*c,f.y=-g*i+y,f.z=b*m,d.push(f.x,f.y,f.z),a.set(c,E,m).normalize(),h.push(a.x,a.y,a.z),u.push(t,1-g),l.push(p++)}m.push(l)}for(let e=0;e<n;e++)for(let t=0;t<s;t++){const i=m[t][e],n=m[t+1][e],s=m[t+1][e+1],a=m[t][e+1],o=new THREE$1.Vector3(d[3*i+0],d[3*i+1],d[3*i+2]),r=new THREE$1.Vector3(d[3*n+0],d[3*n+1],d[3*n+2]),c=new THREE$1.Vector3(d[3*s+0],d[3*s+1],d[3*s+2]),h=new THREE$1.Vector3(d[3*a+0],d[3*a+1],d[3*a+2]),u=new THREE$1.Triangle(o,r,h),p=new THREE$1.Triangle(r,c,h);u.getArea()>1e-4&&(l.push(i,n,a),b+=3),p.getArea()>1e-4&&(l.push(n,s,a),b+=3)}c.addGroup(g,b,0),g+=b}(),a||(e>0&&f(!0),t>0&&f(!1)),this.setIndex(l),this.setAttribute("position",new THREE$1.Float32BufferAttribute(d,3)),this.setAttribute("normal",new THREE$1.Float32BufferAttribute(h,3)),this.setAttribute("uv",new THREE$1.Float32BufferAttribute(u,2))}static fromJSON(e){return new CylinderGeometry(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class PrismGeometry extends THREE$1.ExtrudeGeometry{constructor(e,t){const i=new THREE$1.Shape;i.moveTo(e[0].x,e[0].y);for(let t=1;t<e.length;t++)i.lineTo(e[t].x,e[t].y);i.lineTo(e[0].x,e[0].y);super(i,{steps:2,depth:t,bevelEnabled:!1}),this.vertices=e,this.height=t}clone(){return new this.constructor(this.vertices,this.height).copy(this)}}class BasicLine extends THREE$1.LineSegments{constructor(e,t,i,n,s,a,o=16777215){const r=[e,t,i,n,s,a],c=new THREE$1.BufferGeometry;c.setIndex([0,1]),c.setAttribute("position",new THREE$1.Float32BufferAttribute(r,3));super(c,new THREE$1.LineBasicMaterial({color:o,alphaToCoverage:!0,depthTest:!0,depthWrite:!1,polygonOffset:!0,polygonOffsetFactor:1,side:THREE$1.DoubleSide,transparent:!0}))}clone(){const e=this.geometry.attributes.position.array;return e[0]=point1.x,e[1]=point1.y,e[2]=point1.z,e[3]=point2.x,e[4]=point2.y,e[5]=point2.z,new this.constructor(e[0],e[1],e[2],e[3],e[4],e[5]).copy(this,!0)}setPoints(e,t){Vectors.sanity(e),Vectors.sanity(t);const i=this.geometry.attributes.position.array;i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=t.x,i[4]=t.y,i[5]=t.z,this.geometry.attributes.position.needsUpdate=!0,this.geometry.computeBoundingSphere()}}const _box$2=new THREE$1.Box3,_objQuaternion=new THREE$1.Quaternion,_objScale=new THREE$1.Vector3,_objPosition=new THREE$1.Vector3,_indices$1=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]);class BasicWireBox extends THREE$1.LineSegments{constructor(e,t=16777215,i=1){if(super(new THREE$1.WireframeGeometry,new THREE$1.LineBasicMaterial({color:t,opacity:i,alphaToCoverage:!0,depthTest:!1,depthWrite:!1,polygonOffset:!0,polygonOffsetFactor:1,side:THREE$1.DoubleSide,transparent:!0})),this.positions=new Float32Array(24),e&&e.isObject3D){const t=e.clone();t.lookAtCamera=!1,t.position.set(0,0,0),t.rotation.set(0,0,0),t.quaternion.set(0,0,0,1),t.scale.set(1,1,1),t.matrix.compose(t.position,t.quaternion,t.scale),t.matrixWorld.copy(t.matrix),t.matrixAutoUpdate=!1,_box$2.setFromObject(t,!0),ObjectUtils.clearObject(t),Vectors.sanity(_box$2.min),Vectors.sanity(_box$2.max)}else _box$2.set(new THREE$1.Vector3(-.5,-.5,-.5),new THREE$1.Vector3(.5,.5,.5));const n=_box$2.min,s=_box$2.max,a=this.positions;a[0]=s.x,a[1]=s.y,a[2]=s.z,a[3]=n.x,a[4]=s.y,a[5]=s.z,a[6]=n.x,a[7]=n.y,a[8]=s.z,a[9]=s.x,a[10]=n.y,a[11]=s.z,a[12]=s.x,a[13]=s.y,a[14]=n.z,a[15]=n.x,a[16]=s.y,a[17]=n.z,a[18]=n.x,a[19]=n.y,a[20]=n.z,a[21]=s.x,a[22]=n.y,a[23]=n.z;const o=[];for(let e=_indices$1.length-1;e>0;e-=2){const t=3*_indices$1[e-0],i=3*_indices$1[e-1];o.push(a[t+0],a[t+1],a[t+2]),o.push(a[i+0],a[i+1],a[i+2])}this.geometry.setAttribute("position",new THREE$1.Float32BufferAttribute(o,3)),this.clone=function(){const n=new this.constructor(e,t,i);return ObjectUtils.copyTransform(this,n),n}}getLocalPoints(){const e=[];for(let t=0;t<8;t++){const i=3*t,n=new THREE$1.Vector3;n.x=this.positions[i+0],n.y=this.positions[i+1],n.z=this.positions[i+2],e[t]=n}return e}getBox3(e){(e=e??new THREE$1.Box3).min.x=this.positions[18],e.min.y=this.positions[19],e.min.z=this.positions[20],e.max.x=this.positions[0],e.max.y=this.positions[1],e.max.z=this.positions[2]}}function setWireframeMaterialDefaults(e){e.transparent=!0,e.depthTest=!0,e.depthWrite=!1,e.polygonOffset=!0,e.polygonOffsetFactor=1,e.side=THREE$1.DoubleSide,e.alphaToCoverage=!0}class BasicWireframe extends THREE$1.LineSegments{constructor(e,t,i=1,n=!1){const s=new THREE$1.WireframeGeometry(e.geometry),a=new THREE$1.LineBasicMaterial({color:t,opacity:i});setWireframeMaterialDefaults(a),super(s,a),n&&(this.rotation.set(e.rotation.x,e.rotation.y,e.rotation.z),this.scale.set(e.scale.x,e.scale.y,e.scale.z),this.position.set(e.position.x,e.position.y,e.position.z)),this.clone=function(){return new this.constructor(e,t,i,n).copy(this,!0)}}}class FatWireframe extends Wireframe{constructor(e,t,i,n=1,s=!1){const a=new WireframeGeometry2(e.geometry),o=new LineMaterial({color:i,linewidth:t,resolution:new THREE$1.Vector2(500,500),opacity:n});setWireframeMaterialDefaults(o),o.depthTest=!1,material.resolution=new THREE$1.Vector2(1024,1024),super(a,o),s&&(this.rotation.set(e.rotation.x,e.rotation.y,e.rotation.z),this.scale.set(e.scale.x,e.scale.y,e.scale.z),this.position.set(e.position.x,e.position.y,e.position.z)),this.clone=function(){return new this.constructor(e,t,i,n,s).copy(this,!0)}}}class FatLine extends Line2{constructor(e,t,i,n,s,a,o=1,r=16777215){const c=[e,t,i,n,s,a],l=new LineGeometry;l.setPositions(c);const d=new LineMaterial({color:r,linewidth:o,alphaToCoverage:!0,depthTest:!0,depthWrite:!1,polygonOffset:!0,polygonOffsetFactor:1,side:THREE$1.DoubleSide,transparent:!0});d.resolution=new THREE$1.Vector2(1024,1024),super(l,d),this.computeLineDistances(),this.scale.set(1,1,1),this.point1=new THREE$1.Vector3(e,t,i),this.point2=new THREE$1.Vector3(n,s,a)}clone(){return new this.constructor(this.point1.x,this.point1.y,this.point1.z,this.point2.x,this.point2.y,this.point2.z,this.material.linewidth,this.material.color).copy(this,!0)}setPoints(e,t){Vectors.sanity(e),Vectors.sanity(t),this.point1.copy(e),this.point2.copy(t);const i=[e.x,e.y,e.z,t.x,t.y,t.z];this.geometry.setPositions(i),this.computeLineDistances()}}const _box$1=new THREE$1.Box3,_indices=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),_tempScale=new THREE$1.Vector3,_tempSize=new THREE$1.Vector3;class FatWireBox extends Line2{constructor(e,t=1,i=16777215,n=1){const s=new LineSegmentsGeometry,a=new LineMaterial({color:i,linewidth:t,opacity:n,alphaToCoverage:!0,depthTest:!1,depthWrite:!1,polygonOffset:!0,polygonOffsetFactor:1,side:THREE$1.DoubleSide,transparent:!0});if(a.resolution=new THREE$1.Vector2(1024,1024),super(s,a),this.positions=new Float32Array(24),e&&e.isObject3D){const t=e.clone();t.lookAtCamera=!1,t.position.set(0,0,0),t.rotation.set(0,0,0),t.quaternion.set(0,0,0,1),t.scale.set(1,1,1),t.matrix.compose(t.position,t.quaternion,t.scale),t.matrixWorld.copy(t.matrix),t.matrixAutoUpdate=!1,_box$1.setFromObject(t,!0),ObjectUtils.clearObject(t),Vectors.sanity(_box$1.min),Vectors.sanity(_box$1.max)}else _box$1.set(new THREE$1.Vector3(-.5,-.5,-.5),new THREE$1.Vector3(.5,.5,.5));const o=_box$1.min,r=_box$1.max,c=this.positions;c[0]=r.x,c[1]=r.y,c[2]=r.z,c[3]=o.x,c[4]=r.y,c[5]=r.z,c[6]=o.x,c[7]=o.y,c[8]=r.z,c[9]=r.x,c[10]=o.y,c[11]=r.z,c[12]=r.x,c[13]=r.y,c[14]=o.z,c[15]=o.x,c[16]=r.y,c[17]=o.z,c[18]=o.x,c[19]=o.y,c[20]=o.z,c[21]=r.x,c[22]=o.y,c[23]=o.z;const l=[];for(let e=_indices.length-1;e>0;e-=2){const t=3*_indices[e-0],i=3*_indices[e-1];l.push(c[t+0],c[t+1],c[t+2]),l.push(c[i+0],c[i+1],c[i+2])}this.geometry.setPositions(l),this.clone=function(){const s=new this.constructor(e,t,i,n);return ObjectUtils.copyTransform(this,s),s}}getLocalPoints(){const e=[];for(let t=0;t<8;t++){const i=3*t,n=new THREE$1.Vector3;n.x=this.positions[i+0],n.y=this.positions[i+1],n.z=this.positions[i+2],e[t]=n}return e}getAbsoluteSize(e){this.getSize(e),e.x=Math.abs(e.x),e.y=Math.abs(e.y),e.z=Math.abs(e.z)}getAverageSize(){return this.getSize(_tempSize),(_tempSize.x+_tempSize.y+_tempSize.z)/3}getBox3(e){(e=e??new THREE$1.Box3).min.x=this.positions[18],e.min.y=this.positions[19],e.min.z=this.positions[20],e.max.x=this.positions[0],e.max.y=this.positions[1],e.max.z=this.positions[2]}getSize(e){this.getBox3(_box$1),this.getWorldScale(_tempScale),e.x=(_box$1.max.x-_box$1.min.x)*Math.abs(_tempScale.x),e.y=(_box$1.max.y-_box$1.min.y)*Math.abs(_tempScale.y),e.z=(_box$1.max.z-_box$1.min.z)*Math.abs(_tempScale.z)}getMaxSize(){return this.getSize(_tempSize),Math.max(Math.max(_tempSize.x,_tempSize.y),_tempSize.z)}}const SCALE=500,SkyShader={uniforms:{uSky:{value:new THREE$1.Color(0,.85,.8)},uHorizon:{value:new THREE$1.Color(1,.75,.5)},uGround:{value:new THREE$1.Color(.9,.7,.5)},uScale:{value:SCALE}},vertexShader:"\n        varying vec3 vWorldPosition;\n\n        void main() {\n            vec4 worldPosition = modelMatrix * vec4(position, 1.0);\n            vWorldPosition = worldPosition.xyz;\n            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n        }",fragmentShader:"\n        uniform vec3    uSky;\n        uniform vec3    uHorizon;\n        uniform vec3    uGround;\n        uniform float   uScale;\n        varying vec3    vWorldPosition;\n\n        void main() {\n            float lowerGround =         0.0;\n            float h = normalize(vWorldPosition + lowerGround).y;\n\n            // Sky fade (brighten at horizon)\n            float skyFade = pow(vWorldPosition.y / (uScale * 0.25), 0.4);\n            skyFade = clamp(skyFade, 0.0, 1.0);\n            vec3 sky = mix(uHorizon, uSky, skyFade);\n\n            // Seperates ground and sky, solid horizon: clamp(h * uScale, 0.0, 1.0)\n            float blurHorizon =         0.05;\n            float compressHorizon =     5.0;\n            float skyMix = max(pow(max(h, 0.0), blurHorizon) * compressHorizon, 0.0);\n            skyMix = clamp(skyMix, 0.0, 1.0);\n            vec3 outColor = mix(uGround, sky, skyMix);\n\n            // Output Color\n            gl_FragColor = vec4(outColor, 1.0);\n        }"};class SkyObject extends THREE$1.Mesh{constructor(){super(new THREE$1.SphereGeometry(1),new THREE$1.ShaderMaterial({name:"SkyShader",fragmentShader:SkyShader.fragmentShader,vertexShader:SkyShader.vertexShader,uniforms:THREE$1.UniformsUtils.clone(SkyShader.uniforms),side:THREE$1.BackSide,depthTest:!1,depthWrite:!1})),this.isSky=!0,this.baseScale=SCALE,this.scale.setScalar(this.baseScale)}copy(e,t){return super.copy(e,t),this.baseScale=e.baseScale,this.scale.setScalar(this.baseScale),this}}const _clearColor=new THREE$1.Color(16777215),_materialCache=[],_currClearColor=new THREE$1.Color;let _emptyScene,_renderer;class GpuPickerPass extends Pass{constructor(e,t){super();const i=this;this.scene=e,this.camera=t,this.overrideMaterial=void 0,this.clearColor=void 0,this.clearAlpha=0,this.clear=!1,this.clearDepth=!1,this.needsSwap=!1,this.renderDebugView=!1,this.needPick=!1,this.x=0,this.y=0,this.pickedId=-1;const n=document.createElement("canvas");n.width=64,n.height=64;const s=n.getContext("2d");s.fillStyle="rgb(255,255,255)",s.beginPath(),s.arc(32,32,32,0,2*Math.PI),s.closePath(),s.fill();const a=new THREE$1.CanvasTexture(n);function o(e){const t=e.object;if(!t||!t.isObject3D)return;if(!t.visible)return;if(t.locked)return;if(t.userData.flagIgnore)return;const n=t.id,s=t.material,o=t.geometry;let r=0;s.morphTargets&&o.isBufferGeometry&&(r=o.morphAttributes.position.length>0?1:0);const c=t.isSkinnedMesh?1:0,l=r|c<<1|(!0===t.isInstancedMesh?1:0)<<2|(s.side===THREE$1.FrontSide?1:0)<<3|(s.side===THREE$1.BackSide?1:0)<<4|(s.side===THREE$1.DoubleSide?1:0)<<5|(s.isSpriteMaterial?1:0)<<6;let d=_materialCache[l];d||(d=new THREE$1.ShaderMaterial({defines:{USE_UV:"",USE_LOGDEPTHBUF:""},vertexShader:THREE$1.ShaderChunk.meshbasic_vert,fragmentShader:"\n                        #include <common>\n\n                        varying vec2 vUv;\n\n                        uniform float opacity;\n                        uniform sampler2D map;\n                        uniform vec4 objectId;\n                        uniform float useMap;\n\n                        #include <logdepthbuf_pars_fragment>\n\n                        void main() {\n                            #include <logdepthbuf_fragment>\n\n                            gl_FragColor = objectId;\n\n                            if (opacity < 0.05) discard;\n                            if (useMap > 0.0) {\n                                vec4 texelColor = texture2D(map, vUv);\n                                if (texelColor.a < 0.05) discard;\n                            }\n                        }\n                    ",fog:!1,lights:!1,side:t.isSprite?THREE$1.DoubleSide:THREE$1.FrontSide}),d.uniforms={opacity:{value:1},map:{value:void 0},uvTransform:{value:new THREE$1.Matrix3},objectId:{value:[1,1,1,1]},useMap:{value:0}},d.side=s.side,d.skinning=c>0,d.morphTargets=r>0,_materialCache[l]=d),d.uniforms.objectId.value=[(255&n)/255,(n>>8&255)/255,(n>>16&255)/255,(n>>24&255)/255],d.uniforms.useMap.value=s.map?1:0,s.map&&(d.uniforms.map.value=t.isSpriteHelper?a:s.map),d.uniformsNeedUpdate=!0,_renderer.renderBufferDirect(i.camera,i.scene,o,d,t,null)}this.spriteMap=a,_emptyScene=new THREE$1.Scene,_emptyScene.onAfterRender=function(){const e=_renderer.renderLists.get(i.scene,0);e.opaque.forEach(o),e.transmissive.forEach(o),e.transparent.forEach(o)},this.pickingTarget=new THREE$1.WebGLRenderTarget(1,1,{minFilter:THREE$1.NearestFilter,magFilter:THREE$1.NearestFilter,format:THREE$1.RGBAFormat,colorSpace:THREE$1.LinearSRGBColorSpace}),this.pixelBuffer=new Uint8Array(4*this.pickingTarget.width*this.pickingTarget.height)}dispose(){this.pickingTarget&&this.pickingTarget.dispose&&this.pickingTarget.dispose(),this.spriteMap&&this.spriteMap.dispose&&this.spriteMap.dispose(),console.warn("GpuPickerPass: Instance was disposed!")}render(e,t,i){if(!1===this.needPick&&!1===this.renderDebugView)return;_renderer=e;const n=e.domElement.width,s=e.domElement.height;this.camera.setViewOffset(n,s,this.x,this.y,1,1);const a=e.getRenderTarget(),o=e.getClearAlpha();e.getClearColor(_currClearColor),e.setRenderTarget(this.pickingTarget),e.setClearColor(_clearColor),e.clear(),e.render(_emptyScene,this.camera),e.readRenderTargetPixels(this.pickingTarget,0,0,this.pickingTarget.width,this.pickingTarget.height,this.pixelBuffer),e.setRenderTarget(a),this.camera.clearViewOffset(),this.renderDebugView&&e.render(_emptyScene,this.camera),e.setClearColor(_currClearColor,o),this.needPick&&(this.pickedId=this.pixelBuffer[0]+(this.pixelBuffer[1]<<8)+(this.pixelBuffer[2]<<16)+(this.pixelBuffer[3]<<24),this.needPick=!1)}renderPickScene(e,t){_renderer=e;const i=e.getClearAlpha();e.getClearColor(_currClearColor),e.setClearColor(_clearColor),e.clear(),e.render(_emptyScene,t),e.setClearColor(_currClearColor,i)}}const boxGeometry=new THREE$1.BoxGeometry(.5,.5,.5),circleShape=(new THREE$1.Shape).absarc(0,0,.5),wedgeShape=new THREE$1.Shape([new THREE$1.Vector2(-.5,.5),new THREE$1.Vector2(-.5,-.5),new THREE$1.Vector2(.5,-.5)]);class Geometry{init(e={}){if(e.isBufferGeometry){const t=e.uuid;AssetManager$1.addAsset(e),(e=this.defaultData("style","asset")).asset=t}let t;switch(e.style){case"asset":const i=AssetManager$1.getAsset(e.asset);i&&i.isBufferGeometry&&(t=i);break;case"box":t=new THREE$1.BoxGeometry(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments);break;case"capsule":const n=Maths.clamp(e.radiusTop,.1,e.height)/1.5,s=Maths.clamp(e.radiusBottom,.1,e.height)/1.5,a=e.height/1.5;t=new CapsuleGeometry(n,s,a,e.radialSegments,e.heightSegments,e.capSegments,e.capSegments,e.thetaStart,e.thetaLength),t=GeometryUtils.uvMapSphere(t,"v");break;case"circle":t=new THREE$1.CircleGeometry(e.radius,e.segments,e.thetaStart,e.thetaLength);break;case"cone":t=new CylinderGeometry(0,e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength);break;case"cylinder":t=new CylinderGeometry(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength);break;case"lathe":const o=[];let r=AssetManager$1.getAsset(e.shape);if(r&&"Shape"===r.type){const t=r.getPoints(e.segments);for(let e=0;e<t.length;e++)o.push(new THREE$1.Vector2(t[e].x,t[e].y))}else for(let e=0;e<2.5;e+=.1)o.push(new THREE$1.Vector2(Math.abs(.4*Math.cos(e))+.2,.4*e));t=new THREE$1.LatheGeometry(o,e.segments,0,e.phiLength),t.center();break;case"plane":t=new THREE$1.PlaneGeometry(e.width,e.height,e.widthSegments,e.heightSegments);break;case"platonicSolid":switch(e.polyhedron){case"dodecahedron":default:t=new THREE$1.DodecahedronGeometry(e.radius,e.detail);break;case"icosahedron":t=new THREE$1.IcosahedronGeometry(e.radius,e.detail);break;case"octahedron":t=new THREE$1.OctahedronGeometry(e.radius,e.detail);break;case"tetrahedron":t=new THREE$1.TetrahedronGeometry(e.radius,e.detail)}break;case"ring":t=new THREE$1.RingGeometry(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength);break;case"roundedBox":t=new RoundedBoxGeometry(e.width,e.height,e.depth,e.segments,e.radius);break;case"shape":let c=AssetManager$1.getAsset(e.shape);c&&"Shape"===c.type||(c=wedgeShape);const l={depth:e.depth,curveSegments:e.curveSegments,steps:e.steps,bevelEnabled:e.bevelEnabled,bevelThickness:e.bevelThickness,bevelSize:e.bevelSize,bevelSegments:e.bevelSegments};t=new THREE$1.ExtrudeGeometry(c,l),t.center();break;case"sphere":t=new THREE$1.SphereGeometry(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength);break;case"torus":t=new THREE$1.TorusGeometry(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc);break;case"torusKnot":t=new THREE$1.TorusKnotGeometry(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q);break;case"tube":let d=AssetManager$1.getAsset(e.shape);d&&"Shape"===d.type||(d=circleShape);const h=new THREE$1.CurvePath,u=d.getPoints(Math.max(256,4*e.tubularSegments));for(let e=0;e<u.length-1;e++){const t=u[e],i=u[e+1];h.curves.push(new THREE$1.LineCurve3(new THREE$1.Vector3(t.x,t.y,0),new THREE$1.Vector3(i.x,i.y,0)))}t=new THREE$1.TubeGeometry(h,e.tubularSegments,e.radius,e.radialSegments,e.closed),t.center();break;default:console.error("Geometry Component: Invalid style "+e.style)}if(t&&t.isBufferGeometry){const i=t.constructor.name;if(e.simplify<1){const i=new SimplifyModifier,n=Math.max(3,Math.floor(t.attributes.position.count*(1-e.simplify)));let s=i.modify(t,n);s&&(t.dispose(),t=s)}const n={split:e.edgeSplit??!1,uvSmooth:e.uvSmooth??!1,flatOnly:e.flatOnly??!1,preserveEdges:!1,maxTriangles:25e3};if(n.split||e.subdivide>0){let i=LoopSubdivision.modify(t,e.subdivide,n);i&&(t.dispose(),t=i)}if("cube"===e.textureMapping?t=GeometryUtils.uvMapCube(t):"sphere"===e.textureMapping&&(t=GeometryUtils.uvMapSphere(t)),Array.isArray(e.textureWrap)&&(1!==e.textureWrap[0]||1!==e.textureWrap[1])){const i=Math.max(e.textureWrap[0],0),n=Math.max(e.textureWrap[1],0);GeometryUtils.repeatTexture(t,i,n)}t.name=i}this.backend=t,this.data=e}dispose(){}attach(){if(this.entity){const e=this.entity.getComponent("material");e&&e.attach()}}detach(){if(this.entity){const e=this.entity.getComponent("material");e&&e.detach()}}}Geometry.config={schema:{style:[{type:"select",default:"box",select:["asset","box","capsule","circle","cone","cylinder","lathe","plane","platonicSolid","ring","roundedBox","shape","sphere","torus","torusKnot","tube"]}],asset:{type:"asset",class:"geometry",if:{style:["asset"]}},shape:{type:"asset",class:"shape",if:{style:["lathe","shape","tube"]}},styleDivider:{type:"divider"},polyhedron:[{type:"select",default:"dodecahedron",select:["dodecahedron","icosahedron","octahedron","tetrahedron"],if:{style:["platonicSolid"]}}],points:{type:"shape",alias:"points",default:null,if:{style:["lathe"]}},shapes:{type:"shape",alias:"shape",default:null,if:{style:["shape"]}},path:{type:"shape",alias:"curve",default:null,if:{style:["tube"]}},depth:[{type:"number",default:1,min:0,step:"grid",if:{style:["box","roundedBox"]}},{type:"number",default:.5,min:0,step:"grid",if:{style:["shape"]}}],height:[{type:"number",default:1,min:0,step:"grid",if:{style:["box","capsule","cone","cylinder","plane","roundedBox"]}}],width:[{type:"number",default:1,min:0,step:"grid",if:{style:["box","plane","roundedBox"]}}],widthSegments:[{type:"int",default:1,min:1,max:1024,promode:!0,if:{style:["box","plane"]}},{type:"int",default:24,min:4,max:1024,if:{style:["sphere"]}}],heightSegments:[{type:"int",default:1,min:1,max:1024,promode:!0,if:{style:["box","plane"]}},{type:"int",default:1,min:1,max:1024,if:{style:["cone","cylinder"]}},{type:"int",default:24,min:1,max:1024,if:{style:["sphere"]}}],depthSegments:[{type:"int",default:1,min:1,max:1024,promode:!0,if:{style:["box"]}}],radius:[{type:"number",default:.25,min:0,step:.01,if:{style:["roundedBox"]}},{type:"number",default:.5,min:0,step:.01,if:{style:["circle","cone","platonicSolid","sphere"]}},{type:"number",default:.5,min:0,step:.01,if:{style:["torus"]}},{type:"number",default:.4,min:0,step:.01,if:{style:["torusKnot"]}},{type:"number",default:.1,min:0,step:.01,if:{style:["tube"]}}],radiusTop:[{type:"number",default:.5,min:0,step:.01,if:{style:["capsule"]}},{type:"number",default:.5,min:0,step:.01,if:{style:["cylinder"]}}],radiusBottom:[{type:"number",default:.5,min:0,step:.01,if:{style:["capsule"]}},{type:"number",default:.5,min:0,step:.01,if:{style:["cylinder"]}}],segments:[{type:"int",default:36,min:3,max:64,if:{style:["circle"]}},{type:"int",default:16,min:1,max:64,if:{style:["lathe"]}},{type:"int",default:4,min:1,max:10,if:{style:["roundedBox"]}}],thetaLength:[{type:"angle",default:2*Math.PI,min:0,max:360,if:{style:["circle","ring"]}},{type:"angle",default:2*Math.PI,min:0,max:360,promode:!0,if:{style:["capsule","cone","cylinder"]}},{type:"angle",default:Math.PI,min:0,max:720,promode:!0,if:{style:["sphere"]}}],thetaStart:[{type:"angle",default:0,if:{style:["circle","ring","sphere"]}},{type:"angle",default:0,promode:!0,if:{style:["capsule","cone","cylinder"]}}],phiLength:{type:"angle",default:2*Math.PI,max:360,if:{style:["lathe","sphere"]}},phiStart:{type:"angle",default:0,if:{style:["sphere"]}},capSegments:{type:"int",default:6,min:1,max:36,if:{style:["capsule"]}},radialSegments:[{type:"int",default:24,min:2,max:64,if:{style:["capsule","cone","cylinder","torus","torusKnot","tube"]}}],openEnded:{type:"boolean",default:!1,if:{style:["cone","cylinder"]}},detail:{type:"slider",default:0,min:0,max:9,step:1,precision:0,if:{style:["platonicSolid"]}},innerRadius:{type:"number",default:.25,min:0,step:.01,if:{style:["ring"]}},outerRadius:{type:"number",default:.5,min:0,step:.01,if:{style:["ring"]}},phiSegments:{type:"int",default:10,min:1,max:64,promode:!0,if:{style:["ring"]}},thetaSegments:{type:"int",default:36,min:3,max:128,if:{style:["ring"]}},steps:{type:"int",alias:"Depth Segments",default:3,min:1,max:128,promode:!0,if:{style:["shape"]}},bevelEnabled:{type:"boolean",alias:"bevel",default:!1,if:{style:["shape"]},rebuild:!0},bevelThickness:{type:"number",default:.1,min:0,step:.01,if:{style:["shape"],bevelEnabled:[!0]}},bevelSize:{type:"number",default:.1,min:0,step:.01,if:{style:["shape"],bevelEnabled:[!0]}},bevelSegments:{type:"int",default:4,min:0,max:64,promode:!0,if:{style:["shape"],bevelEnabled:[!0]}},curveSegments:{type:"int",default:16,min:1,max:128,promode:!0,if:{style:["shape"]}},tube:[{type:"number",default:.2,min:0,step:.01,if:{style:["torus"]}},{type:"number",default:.1,min:0,step:.01,if:{style:["torusKnot"]}}],tubularSegments:[{type:"int",default:32,min:3,max:128,if:{style:["torus"]}},{type:"int",default:64,min:3,max:128,if:{style:["torusKnot"]}},{type:"int",default:128,min:2,if:{style:["tube"]}}],arc:{type:"angle",default:2*Math.PI,min:0,max:360,if:{style:["torus"]}},p:{type:"number",default:2,min:1,max:128,if:{style:["torusKnot"]}},q:{type:"number",default:3,min:1,max:128,if:{style:["torusKnot"]}},closed:{type:"boolean",default:!0,if:{style:["tube"]}},modifierDivider:{type:"divider"},simplify:{type:"slider",default:1,min:0,max:1},subdivide:{type:"slider",default:0,min:0,max:3,step:1,precision:0,rebuild:!0},edgeSplit:{type:"boolean",default:!1,hide:{subdivide:[0]}},uvSmooth:{type:"boolean",default:!1,promode:!0,hide:{subdivide:[0]}},flatOnly:{type:"boolean",default:!1,promode:!0,hide:{subdivide:[0]}},textureDivider:{type:"divider"},textureMapping:[{type:"select",default:"cube",select:["none","cube","sphere"],if:{style:["shape"]}},{type:"select",default:"none",select:["none","cube","sphere"],not:{style:["shape"]}}],textureWrap:{type:"vector",size:2,tint:!1,default:[1,1],min:0,step:.2,precision:2,label:["X","Y"]}},icon:"",color:"rgb(255, 113, 0)",multiple:!1,dependencies:["material"],group:["Entity3D"]},ComponentManager.register("geometry",Geometry);const blendingModes=["NoBlending","NormalBlending","AdditiveBlending","SubstractiveBlending","MultiplyBlending","CustomBlending"],sides=["FrontSide","BackSide","DoubleSide"],depthPacking=["BasicDepthPacking","RGBADepthPacking"];class Material{init(e={}){const t={};if(e.isMaterial){const t=e.uuid;AssetManager$1.addAsset(e),(e=this.defaultData("style","asset")).asset=t}else{for(const i in e){const n=e[i];t[i]=n;let s=Material.config.schema[i];if(Array.isArray(s)&&s.length>0&&(s=s[0]),n&&s&&"asset"===s.type)if(n.isTexture)AssetManager$1.addAsset(n);else{const e=AssetManager$1.getAsset(n);e&&e.isTexture?t[i]=e:t[i]=null}}delete t.base,delete t.style,delete t.edgeSize,delete t.gradientSize,delete t.premultiplyAlpha,delete t.useUv,"string"==typeof t.blending&&(t.blending=blendingModes.indexOf(t.blending)),"string"==typeof t.side&&(t.side=sides.indexOf(t.side)),"BasicDepthPacking"===t.depthPacking&&(t.depthPacking=THREE$1.BasicDepthPacking),"RGBADepthPacking"===t.depthPacking&&(t.depthPacking=THREE$1.RGBADepthPacking)}let i;switch(e.style){case"asset":const n=AssetManager$1.getAsset(e.asset);n&&n.isMaterial&&(i=n.clone());break;case"basic":i=new THREE$1.MeshBasicMaterial(t);break;case"depth":i=new THREE$1.MeshDepthMaterial(t);break;case"lambert":i=new THREE$1.MeshLambertMaterial(t);break;case"matcap":i=new THREE$1.MeshMatcapMaterial(t);break;case"normal":i=new THREE$1.MeshNormalMaterial(t);break;case"phong":i=new THREE$1.MeshPhongMaterial(t);break;case"physical":i=new THREE$1.MeshPhysicalMaterial(t);break;case"points":i=new THREE$1.PointsMaterial(t);break;case"shader":i=new THREE$1.ShaderMaterial(t);break;case"standard":i=new THREE$1.MeshStandardMaterial(t);break;default:console.error(`Material Component: Invalid style '${e.style}'`)}i&&i.isMaterial,this.backend=i,this.data=e}dispose(){}attach(){refreshMesh(this)}detach(){refreshMesh(this)}}function extendMaterial(e,t={style:"basic",premultiplyAlpha:!0}){if(!e||!e.isMaterial)return;const i=t&&1===t.opacity&&void 0===t.map;return e.transparent=!i,e.alphaTest=.01,e.polygonOffset=!0,e.polygonOffsetFactor=1,e.onBeforeCompile=function(e){t.premultiplyAlpha&&e.fragmentShader&&(e.fragmentShader=e.fragmentShader.replace("#include <premultiplied_alpha_fragment>","gl_FragColor.rgba *= gl_FragColor.a;"))},t.premultiplyAlpha&&(e.blending=THREE$1.CustomBlending,e.blendEquation=THREE$1.AddEquation,e.blendSrc=THREE$1.OneFactor,e.blendDst=THREE$1.OneMinusSrcAlphaFactor,e.blendEquationAlpha=THREE$1.AddEquation,e.blendSrcAlpha=THREE$1.OneFactor,e.blendDstAlpha=THREE$1.OneMinusSrcAlphaFactor),e.needsUpdate=!0,e}function refreshMesh(e){if(e.entity&&e.mesh&&(e.entity.remove(e.mesh),ObjectUtils.clearObject(e.mesh),e.mesh=void 0),!e.attached)return;if(!e.backend||!e.backend.isMaterial)return;const t=e.backend.clone();extendMaterial(t,e.toJSON());const i=e.entity.getComponent("geometry");if(!i)return;if(!i.attached)return;const n=i.backend;if(!n)return;if(e.data&&"points"===e.data.style){const i=n.clone();e.data.useUv||i.deleteAttribute("uv"),e.mesh=new THREE$1.Points(i,t),i.dispose()}else e.mesh=new THREE$1.Mesh(n,t),e.mesh.castShadow=e.entity.castShadow,e.mesh.receiveShadow=e.entity.receiveShadow;e.mesh.name=`Backend Object3D for ${e.entity.name}`;!0===e.backend.isMeshPhysicalMaterial&&e.backend.transmission>0&&(e.backend.envMap=hdrEquirect),e.backend.opacity<.05&&(SceneManager.app&&SceneManager.app.isPlaying||(t.map=null,t.opacity=.25,t.wireframe=!0,e.mesh.castShadow=!1)),e.entity&&e.mesh&&e.entity.add(e.mesh)}Material.config={schema:{style:[{type:"select",default:"standard",promode:!0,select:["asset","basic","depth","lambert","matcap","normal","phong","physical","points","shader","standard"]},{type:"select",default:"standard",select:["asset","basic","points","standard"]}],styleDivider:{type:"divider"},asset:{type:"asset",class:"material",if:{style:["asset"]}},color:{type:"color",if:{style:["basic","lambert","matcap","phong","physical","points","standard"]}},emissive:{type:"color",default:0,promode:!0,if:{style:["lambert","phong","physical","standard"]}},emissiveIntensity:{type:"slider",default:1,min:0,max:2,promode:!0,if:{style:["lambert","phong","physical","standard"]}},opacity:{type:"slider",default:1,min:0,max:1,if:{style:["basic","depth","lambert","matcap","normal","phong","physical","points","standard"]}},depthTest:{type:"boolean",default:!0,promode:!0,if:{style:["basic","depth","lambert","matcap","normal","phong","physical","standard"]}},depthWrite:{type:"boolean",default:!0,promode:!0,if:{style:["basic","depth","lambert","matcap","normal","phong","physical","standard"]}},flatShading:{type:"boolean",default:!1,if:{style:["phong","physical","standard","normal","matcap"]}},premultiplyAlpha:{type:"boolean",default:!0,promode:!0,if:{style:["basic","depth","lambert","matcap","normal","phong","physical","points","standard"]}},wireframe:{type:"boolean",default:!1,if:{style:["basic","depth","lambert","normal","phong","physical","standard"]}},vertexColors:{type:"boolean",default:!1,promode:!0,if:{style:["basic","depth","lambert","matcap","normal","phong","physical","standard"]}},size:{type:"slider",default:.05,min:0,max:1,if:{style:["points"]}},sizeAttenuation:{type:"boolean",default:!0,if:{style:["points"]}},useUv:{type:"boolean",default:!1,if:{style:["points"]}},metalness:{type:"slider",default:.1,min:0,max:1,if:{style:["physical","standard"]}},roughness:{type:"slider",default:1,min:0,max:1,if:{style:["physical","standard"]}},specular:{type:"color",default:1118481,if:{style:["phong"]}},shininess:{type:"number",default:30,if:{style:["phong"]}},clearcoat:{type:"slider",default:0,min:0,max:1,if:{style:["physical"]}},clearcoatRoughness:{type:"slider",default:0,min:0,max:1,if:{style:["physical"]}},ior:{type:"slider",default:1.5,min:1,max:2,if:{style:["physical"]}},sheen:{type:"slider",default:0,min:0,max:1,if:{style:["physical"]}},sheenRoughness:{type:"slider",default:0,min:0,max:1,if:{style:["physical"]}},sheenColor:{type:"color",if:{style:["physical"]}},specularColor:{type:"color",promode:!0,if:{style:["physical"]}},specularIntensity:{type:"slider",default:1,min:0,max:2,promode:!0,if:{style:["physical"]}},thickness:{type:"slider",default:0,min:0,max:5,if:{style:["physical"]}},transmission:{type:"slider",default:0,min:0,max:1,if:{style:["physical"]}},depthPacking:{type:"select",default:"BasicDepthPacking",select:depthPacking,if:{style:["depth"]}},map:[{type:"asset",class:"texture",alias:"texture",if:{style:["basic","depth","lambert","matcap","phong","points","physical","standard"]}}],matcap:{type:"asset",class:"texture",if:{style:["matcap"]}},alphaMap:{type:"asset",class:"texture",promode:!0,if:{style:["basic","depth","lambert","matcap","phong","physical","points","standard"]}},bumpMap:{type:"asset",class:"texture",promode:!0,if:{style:["matcap","normal","phong","physical","standard"]}},bumpScale:{type:"slider",default:1,min:0,max:2,promode:!0,if:{style:["matcap","normal","phong","physical","standard"]}},clearcoatNormalMap:{type:"asset",class:"texture",promode:!0,if:{style:["physical"]}},clearcoatNormalScale:{type:"vector2",default:[1,1],promode:!0,if:{style:["physical"]}},displacementMap:{type:"asset",class:"texture",promode:!0,if:{style:["depth","matcap","normal","phong","physical","standard"]}},displacementScale:{type:"slider",default:1,min:0,max:2,promode:!0,if:{style:["depth","matcap","normal","phong","physical","standard"]}},emissiveMap:{type:"asset",class:"texture",promode:!0,if:{style:["lambert","phong","physical","standard"]}},metalnessMap:{type:"asset",class:"texture",promode:!0,if:{style:["physical","standard"]}},roughnessMap:{type:"asset",class:"texture",promode:!0,if:{style:["physical","standard"]}},specularMap:{type:"asset",class:"texture",promode:!0,if:{style:["basic","lambert","phong"]}},thicknessMap:{type:"asset",class:"texture",promode:!0,if:{style:["physical"]}},transmissionMap:{type:"asset",class:"texture",promode:!0,if:{style:["physical"]}},aoMap:{type:"asset",class:"texture",promode:!0,if:{style:["basic","lambert","phong","physical","standard"]}},envMap:{type:"asset",class:"texture",promode:!0,if:{style:["basic","lambert","phong","physical","standard"]}},lightMap:{type:"asset",class:"texture",promode:!0,if:{style:["basic","lambert","phong","physical","standard"]}},normalMap:{type:"asset",class:"texture",if:{style:["matcap","normal","phong","physical","standard"]}},side:{type:"select",default:"FrontSide",select:sides,if:{style:["basic","depth","lambert","matcap","normal","phong","physical","standard"]}}},icon:"",color:"rgb(165, 243, 0)",multiple:!1,dependencies:["geometry"],group:["Entity3D"]},ComponentManager.register("material",Material);class Mesh{init(e={}){const t=e.isObject3D?e:new THREE$1.Object3D;t.traverse((e=>{e.castShadow=this.entity.castShadow})),t.traverse((e=>{e.receiveShadow=this.entity.receiveShadow})),this.backed=t,this.data=e}dispose(){}attach(){this.entity&&this.backend&&this.entity.add(this.backend)}detach(){this.entity&&this.backend&&this.entity.remove(this.backend)}}Mesh.config={icon:"",color:"#F7DB63",multiple:!0,group:["Entity3D"]},ComponentManager.register("mesh",Mesh);const styles=["fixed","dynamic","kinematic"],colliders=["auto","ball","capsule","cone","cuboid","cylinder"],automatic=["box","sphere","hull","mesh"],_box=new THREE$1.Box3,_center=new THREE$1.Vector3,_quaternion=new THREE$1.Quaternion,_matrix=new THREE$1.Matrix4,_position=new THREE$1.Vector3,_scale=new THREE$1.Vector3,_size=new THREE$1.Vector3,_zero=new THREE$1.Vector3;class Rigidbody{init(e={}){let t;this.backend=t,this.data=e}onLoad(){const e=SceneManager.app?.scene?.physics?.backend,t=this.entity,i=this.data??{};if(!e||!t)return;let n;switch(i.style){case"dynamic":n=RAPIER.RigidBodyDesc.dynamic();break;case"kinematic":n=RAPIER.RigidBodyDesc.kinematicVelocityBased();break;default:n=RAPIER.RigidBodyDesc.fixed()}if(n.setTranslation(...t.position),n.setRotation(t.quaternion),"dynamic"===i.style||"kinematic"===i.style){null!=i.ccdEnabled&&n.setCcdEnabled(Boolean(i.ccdEnabled));const e=i.linearVelocity,t=i.angularVelocity;Array.isArray(e)&&e.length>2&&n.setLinvel(e[0],e[1],e[2]),Array.isArray(t)&&t.length>2&&n.setAngvel({x:t[0],y:t[1],z:t[2]})}if("dynamic"===i.style){null!=i.canSleep&&n.setCanSleep(Boolean(i.canSleep)),null!=i.addMass&&n.setAdditionalMass(parseFloat(i.addMass)),null!=i.gravityScale&&n.setGravityScale(parseFloat(i.gravityScale));const e=i.linearEnabled,t=i.rotateEnabled;Array.isArray(e)&&e.length>2&&n.enabledTranslations(e[0],e[1],e[2]),Array.isArray(t)&&t.length>2&&n.enabledRotations(t[0],t[1],t[2]),null!=i.linearDamping&&n.setLinearDamping(parseFloat(i.linearDamping)),null!=i.angularDamping&&n.setAngularDamping(parseFloat(i.angularDamping))}const s=e.createRigidBody(n);function a(t){t.setDensity(null!=i.density?i.density:1),t.setFriction(i.friction),t.setRestitution(i.bounce??0);const n=e.createCollider(t,s);"dynamic"!==i.style&&"kinematic"!==i.style||(n.setActiveCollisionTypes(RAPIER.ActiveCollisionTypes.DEFAULT|RAPIER.ActiveCollisionTypes.KINEMATIC_FIXED),n.setActiveEvents(RAPIER.ActiveEvents.COLLISION_EVENTS))}if(this.backend=s,"auto"===i.collider){const e=t.getComponent("geometry").backend;if(e&&e.isBufferGeometry)switch(i.generate){case"box":e.computeBoundingBox(),e.boundingBox.getCenter(_center),e.boundingBox.getSize(_size);const i=Math.abs(_size.x*t.scale.x/2),n=Math.abs(_size.y*t.scale.y/2),s=Math.abs(_size.z*t.scale.z/2),o=RAPIER.ColliderDesc.cuboid(i,n,s);o.setTranslation(_center.x*t.scale.x,_center.y*t.scale.y,_center.z*t.scale.z),a(o);break;case"sphere":e.computeBoundingSphere(),_center.copy(e.boundingSphere.center);const r=isNaN(e.boundingSphere.radius)?.5:e.boundingSphere.radius,c=Math.max(t.scale.x,Math.max(t.scale.y,t.scale.z)),l=RAPIER.ColliderDesc.ball(r*c);l.setTranslation(_center.x*t.scale.x,_center.y*t.scale.y,_center.z*t.scale.z),a(l);break;case"hull":const d=new Float32Array(e.attributes.position.array);a(RAPIER.ColliderDesc.convexHull(d));break;case"mesh":const h=new Float32Array(e.attributes.position.array),u=e.index?new Uint32Array(e.index.array):new Uint32Array([...Array(h.length/3).keys()]);a(RAPIER.ColliderDesc.trimesh(h,u))}}else if("ball"===i.collider){const e=.5*Math.max(t.scale.x,Math.max(t.scale.y,t.scale.z));a(RAPIER.ColliderDesc.ball(e))}else if("capsule"===i.collider);else if("cone"===i.collider);else if("cuboid"===i.collider){const e=.5*t.scale.x,i=.5*t.scale.y,n=.5*t.scale.z;a(RAPIER.ColliderDesc.cuboid(e,i,n))}else if("cylinder"===i.collider){const e=.5*t.scale.y,i=.5*Math.max(t.scale.x,t.scale.z);a(RAPIER.ColliderDesc.cylinder(e,i))}}onUpdate(e=0){const t=this.backend,i=this.entity,n=this.data??{};t&&i&&("fixed"===n.style?(t.setTranslation(i.position),t.setRotation(i.quaternion)):(i.position.copy(t.translation()),i.rotation.setFromQuaternion(_quaternion.copy(t.rotation()),void 0,!1)))}onRemove(){}setLinvel(e=0,t=0,i=0,n=!0){const s=this.backend,a=this.entity;s&&a&&s.setLinvel({x:e,y:t,z:i},n)}setAngvel(e=0,t=0,i=0,n=!0){const s=this.backend,a=this.entity;s&&a&&s.setAngvel({x:e,y:t,z:i},n)}colliderGeometry(){const e=this.entity,t=this.data??{};if(t&&e){if(t.collider&&"auto"===t.collider&&e.isEntity){const i=e.getComponent("geometry"),n=i?i.backend:void 0;if(n&&n.isBufferGeometry)switch(t.generate){case"box":n.computeBoundingBox(),n.boundingBox.getCenter(_center),n.boundingBox.getSize(_size);const e=Math.abs(_size.x),t=Math.abs(_size.y),i=Math.abs(_size.z),s=new THREE$1.BoxGeometry(e,t,i);return s.translate(_center.x,_center.y,_center.z),s;case"sphere":n.computeBoundingSphere(),_center.copy(n.boundingSphere.center);const a=isNaN(n.boundingSphere.radius)?.5:n.boundingSphere.radius,o=new THREE$1.SphereGeometry(a,32);return o.translate(_center.x,_center.y,_center.z),o;case"hull":const r=[],c=n.getAttribute("position");for(let e=0;e<c.count;e++){const t=new THREE$1.Vector3;t.fromBufferAttribute(c,e),r.push(t)}return new ConvexGeometry(r);case"mesh":return n.clone()}}switch(t.collider){case"ball":return new THREE$1.SphereGeometry(.5,32);case"capsule":case"cone":return;case"cuboid":return new THREE$1.BoxGeometry(1,1,1);case"cylinder":return new THREE$1.CylinderGeometry(.5,.5,1)}}}colliderShape(){return"auto"===this.data.collider?this.data.generate:this.data.collider}colliderStyle(){return this.data.style??"fixed"}}Rigidbody.config={schema:{style:{type:"select",default:"dynamic",select:styles},styleDivider:{type:"divider"},collider:{type:"select",default:"auto",select:colliders,rebuild:!0},generate:{type:"select",default:"box",select:automatic,if:{collider:["auto"]}},shapeDivider:{type:"divider"},ccdEnabled:{type:"boolean",default:!1,if:{style:["dynamic","kinematic"]}},canSleep:{type:"boolean",default:!0,if:{style:["dynamic"]}},gravityScale:{type:"number",default:1,if:{style:["dynamic"]}},addMass:{type:"number",default:0,min:0,if:{style:["dynamic"]}},density:{type:"number",default:1,min:0,step:.1,precision:2,promode:!0},bounce:{type:"slider",default:0,min:0,max:1,precision:2},friction:{type:"slider",default:.5,min:0,max:10,precision:2},moveDivider:{type:"divider",if:{style:["dynamic","kinematic"]}},linearVelocity:{type:"vector",size:3,tint:!0,default:[0,0,0],step:1,precision:2,if:{style:["dynamic","kinematic"]}},angularVelocity:{type:"vector",size:3,tint:!0,default:[0,0,0],step:1,precision:2,if:{style:["dynamic","kinematic"]}},linearEnabled:{type:"option",size:3,tint:!0,default:[!0,!0,!0],if:{style:["dynamic"]}},rotateEnabled:{type:"option",size:3,tint:!0,default:[!0,!0,!0],if:{style:["dynamic"]}},linearDamping:{type:"number",default:0,min:0,step:1,precision:2,if:{style:["dynamic"]}},angularDamping:{type:"number",default:0,min:0,step:1,precision:2,if:{style:["dynamic"]}}},icon:"",color:"#0F4F94",multiple:!1,group:["Entity3D"]},ComponentManager.register("rigidbody",Rigidbody);class Script{init(e={}){if(e.isScript){const t=e.uuid;AssetManager$1.addAsset(e),(e=this.defaultData()).script=t}const t=AssetManager$1.getAsset(e.script);if(t&&t.isScript){e.variables||(e.variables={});let i={};if(t.source)try{const e=`${t.source}\nreturn variables;`;i=new Function("",e)()}catch(e){}for(const t in i){const n=i[t];n.type?(t in e.variables&&(n.value=e.variables[t].value),void 0===n.value&&(n.value=n.default),void 0===n.value&&(n.value=ComponentManager.defaultValue(n.type))):n.value=null}e.variables=structuredClone(i)}this.backend=void 0,this.data=e}}Script.config={schema:{script:{type:"asset",class:"script",rebuild:!0},divider:{type:"divider"},variables:{type:"object",default:{}}},icon:"",color:"#090B11",width:"40%",multiple:!0,dependencies:[],group:["Entity3D"]},ComponentManager.register("script",Script);const exampleSelect=["Apple","Banana","Cherry","Zebra","Red"];class Test{init(e={}){let t;this.backend=t,this.data=e}dispose(){}attach(){this.entity&&this.backend&&this.entity.add(this.backend)}detach(){this.entity&&this.backend&&this.entity.remove(this.backend)}}Test.config={schema:{style:[{type:"select",default:"basic",select:["asset","basic","array"]}],divider:{type:"divider"},asset:{type:"asset",if:{style:["asset"]}},assetDivider:{type:"divider"},geometry:{type:"asset",class:"geometry",if:{style:["asset"]}},material:{type:"asset",class:"material",if:{style:["asset"]}},script:{type:"asset",class:"script",if:{style:["asset"]}},shape:{type:"asset",class:"shape",if:{style:["asset"]}},texture:{type:"asset",class:"texture",if:{style:["asset"]}},prefabDivider:{type:"divider"},prefab:{type:"asset",class:"prefab",if:{style:["asset"]}},select:{type:"select",default:"Zebra",select:exampleSelect,if:{style:["basic"]}},number:{type:"number",default:.05,min:0,max:1,label:"test",if:{style:["basic"]}},int:{type:"int",default:5,min:3,max:10,if:{style:["basic"]}},angle:{type:"angle",default:2*Math.PI,min:0,max:360,if:{style:["basic"]}},variable:{type:"variable",default:[0,0],min:0,max:100,if:{style:["basic"]}},slider:{type:"slider",default:0,min:0,max:9,step:1,precision:0,if:{style:["basic"]}},boolean:{type:"boolean",default:!0,if:{style:["basic"]}},color:{type:"color",default:16711680,if:{style:["basic"]}},string:{type:"string",if:{style:["basic"]}},multiline:{type:"string",rows:4,if:{style:["basic"]}},numberArray:{type:"vector",size:1,if:{style:["array"]}},vector2:{type:"vector",size:2,tint:!0,label:["x","y"],if:{style:["array"]}},vector3:{type:"vector",size:3,tint:!0,min:[1,1,1],max:[2,2,2],step:.1,precision:2,if:{style:["array"]}},vector4:{type:"vector",size:4,tint:!0,if:{style:["array"]}}},icon:"",color:"rgb(128, 128, 128)",multiple:!1,dependencies:[],group:["Entity3D"]},ComponentManager.register("test",Test),await RAPIER.init();const _gravity=new THREE$1.Vector3;class Physics{init(e={}){let t;this.backend=t,this.data=e}dispose(){const e=this.backend;e&&e.free()}attach(){}detach(){}onLoad(){_gravity.set(0,0,0),this.data.gravity&&_gravity.fromArray(this.data.gravity);const e=new RAPIER.World(_gravity);this.backend=e}onUpdate(e=0){const t=this.backend;t&&e>.01&&(t.timestep=e,t.step())}}Physics.config={schema:{gravity:{type:"vector",default:[0,-9.807,0],size:3,tint:!0,step:.1,precision:2}},icon:"",color:"#0F4F94",multiple:!1,dependencies:[],group:["World3D"]},ComponentManager.register("physics",Physics);const _camPosition=new THREE$1.Vector3,_camRotation=new THREE$1.Quaternion,_camRight=new THREE$1.Vector3,_camUp=new THREE$1.Vector3;class PixelPerfectPass extends Pass{constructor(e,t=1,i=1){super(),this.uniforms=THREE$1.UniformsUtils.clone(e.uniforms),this.material=new THREE$1.ShaderMaterial({name:e.name??"NamelessShader",defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader}),this.pixelQuad=new FullScreenQuad(this.material),this.pixelSize=new THREE$1.Vector2,this.setPixelSize(t,i)}render(e,t,i){const n=this.camera;if(!n)return;n.getWorldPosition(_camPosition),n.getWorldQuaternion(_camRotation),_camRight.set(1,0,0).applyQuaternion(_camRotation),_camUp.set(0,1,0).applyQuaternion(_camRotation);const s=_camPosition.dot(_camRight)*n.zoom,a=_camPosition.dot(_camUp)*n.zoom;this.uniforms.uCamera.value.x=s,this.uniforms.uCamera.value.y=a,this.uniforms.tDiffuse.value=i.texture,e.setRenderTarget(this.renderToScreen?null:t),this.pixelQuad.render(e)}dispose(){this.material.dispose(),this.pixelQuad.dispose()}setPixelSize(e=1,t=1){null==t&&(t=e),e=Math.min(1024,Math.max(1,parseInt(e))),t=Math.min(1024,Math.max(1,parseInt(t))),this.pixelSize.set(e,t),this.uniforms.uCellSize.value=this.pixelSize}setFixedSize(e,t){this.uniforms.fixedsize.value.x=e,this.uniforms.fixedsize.value.y=t}setSize(e,t){this.uniforms.resolution.value.x=e,this.uniforms.resolution.value.y=t}}const MixShader={uniforms:{baseTexture:{value:null},bloomTexture:{value:null}},vertexShader:"\n        varying vec2 vUv;\n        void main() {\n            vUv = uv;\n            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n        }\n    ",fragmentShader:"\n        uniform sampler2D baseTexture;\n        uniform sampler2D bloomTexture;\n        varying vec2 vUv;\n        void main() {\n            gl_FragColor = texture2D(baseTexture, vUv) + vec4(1.0) * texture2D(bloomTexture, vUv);\n        }\n    "};class SelectiveBloomPass extends Pass{constructor(e,t,i){super();const n=this;this.copyPass=new ShaderPass(CopyShader),this.copyPass.material.blending=THREE$1.NoBlending,this.renderPass=new RenderPass(null,null),this.renderPass.clear=!1,this.bloomPass=new UnrealBloomPass(new THREE$1.Vector2,e,t,i),this.mixPass=new ShaderPass(new THREE$1.ShaderMaterial({name:"MixShader",uniforms:THREE$1.UniformsUtils.clone(MixShader.uniforms),vertexShader:MixShader.vertexShader,fragmentShader:MixShader.fragmentShader})),Object.defineProperties(n,{scene:{get:function(){return n.renderPass.scene},set:function(e){n.renderPass.scene=e}},camera:{get:function(){return n.renderPass.camera},set:function(e){n.renderPass.camera=e}}}),this.needsSwap=!0}render(e,t,i,n,s){if(!this.bufferTarget){this._pixelRatio=e.getPixelRatio();const t=e.getSize(new THREE$1.Vector2),i=t.width*this._pixelRatio,n=t.height*this._pixelRatio;this.bufferTarget=new THREE$1.WebGLRenderTarget(i,n,{type:THREE$1.HalfFloatType}),this.bufferTarget.texture.name="BufferTarget"}const a=this.renderPass.camera;a&&(this.copyPass.render(e,this.bufferTarget,i,n),e.setRenderTarget(i),e.clearColor(),a.layers.disable(LAYERS.BASE),a.layers.enable(LAYERS.BLOOM),this.renderPass.render(e,t,i),a.layers.disable(LAYERS.BLOOM),a.layers.enable(LAYERS.BASE),this.bloomPass.render(e,t,i,n,s),this.mixPass.material.uniforms.baseTexture.value=this.bufferTarget.texture,this.mixPass.material.uniforms.bloomTexture.value=i.texture,this.mixPass.render(e,t,i))}setSize(e,t){const i=e*(this._pixelRatio??window.devicePixelRatio),n=t*(this._pixelRatio??window.devicePixelRatio);this.bufferTarget&&this.bufferTarget.setSize(i,n),this.copyPass&&this.copyPass.setSize(e,t),this.renderPass&&this.renderPass.setSize(e,t),this.bloomPass&&this.bloomPass.setSize(e,t),this.mixPass&&this.mixPass.setSize(e,t)}dispose(){this.bufferTarget&&this.bufferTarget.dispose(),this.copyPass&&this.copyPass.dispose(),this.renderPass&&this.renderPass.dispose(),this.bloomPass&&this.bloomPass.dispose(),this.mixPass&&this.mixPass.dispose()}}const CHARACTERS_PER_ROW=16,AsciiShader={name:"AsciiShader",uniforms:{resolution:{value:new THREE$1.Vector2},fixedsize:{value:new THREE$1.Vector2},uCamera:{value:new THREE$1.Vector2},uCellSize:{value:16},tDiffuse:{value:null},tCharacters:{value:null},uCharacterCount:{value:0},uColor:{value:new THREE$1.Color}},vertexShader:"\n        varying vec2 vUv;\n        void main() {\n            vUv = uv;\n            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n        }",fragmentShader:`\n        #include <common>\n\n        uniform vec2 resolution;\n        uniform vec2 fixedsize;\n        uniform vec2 uCamera;\n        uniform vec2 uCellSize;\n        uniform sampler2D tDiffuse;\n        uniform sampler2D tCharacters;\n        uniform float uCharacterCount;\n        uniform vec3 uColor;\n\n        varying vec2 vUv;\n\n        const vec2 SIZE = vec2(${CHARACTERS_PER_ROW});\n\n        void main() {\n            vec2 cell = fixedsize / uCellSize;\n            vec2 grid = 1.0 / cell;\n            vec2 pixel = 1.0 / fixedsize;\n            vec2 actual = 1.0 / resolution;\n\n            // Camera Offset\n            vec2 fract = pixel * mod(uCamera, uCellSize);\n\n            // Image Color\n            vec2 pixelUV = grid * (0.5 + floor((vUv + fract) / grid));\n            pixelUV -= fract;\n            vec4 pixelized = texture2D(tDiffuse, pixelUV);\n\n            // Character\n            float greyscale = luminance(pixelized.rgb);\n            float characterIndex = floor((uCharacterCount - 1.0) * greyscale);\n            vec2 characterPosition = vec2(mod(characterIndex, SIZE.x), floor(characterIndex / SIZE.y));\n            vec2 offset = vec2(characterPosition.x, -characterPosition.y) / SIZE;\n            vec2 charUV = mod((vUv + fract) * (cell / SIZE), 1.0 / SIZE) - vec2(0.0, 1.0 / SIZE) + offset;\n            vec4 asciiCharacter = texture2D(tCharacters, charUV);\n\n            gl_FragColor = vec4(uColor * asciiCharacter.rgb, pixelized.a);\n        }`,createCharactersTexture:function(e){const t=document.createElement("canvas"),i=1024,n=i/CHARACTERS_PER_ROW;t.width=t.height=i;const s=new THREE$1.CanvasTexture(t,void 0,THREE$1.RepeatWrapping,THREE$1.RepeatWrapping,THREE$1.LinearFilter,THREE$1.LinearFilter),a=t.getContext("2d");a.clearRect(0,0,i,i),a.font="54px arial",a.textAlign="center",a.textBaseline="middle";for(let t=0;t<e.length;t++){const i=e[t],s=t%CHARACTERS_PER_ROW,o=Math.floor(t/CHARACTERS_PER_ROW);a.fillStyle="#fff",a.fillText(i,s*n+n/2,o*n+n/2)}return s.needsUpdate=!0,s}},CartoonShader={name:"CartoonShader",uniforms:{resolution:{value:new THREE$1.Vector2},tDiffuse:{value:null},uEdgeColor:{value:new THREE$1.Color(0)},uEdgeStrength:{value:2},uGradient:{value:8}},vertexShader:"\n        varying vec2 vUv;\n        void main() {\n            vUv = uv;\n            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n        }",fragmentShader:"\n        #include <common>\n\n        uniform vec2 resolution;\n        uniform sampler2D tDiffuse;\n        uniform vec3 uEdgeColor;\n        uniform float uEdgeStrength;\n        uniform float uGradient;\n\n        varying vec2 vUv;\n\n        //***** Fast Rgb / Hsv Conversion Functions *****/\n\n        vec3 rgbToHsv(vec3 c) {\n            vec4  K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n            vec4  p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));\n            vec4  q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));\n            float d = q.x - min(q.w, q.y);\n            float e = 1.0e-10;\n            return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\n        }\n\n        vec3 hsvToRgb(vec3 c) {\n            vec4  K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n            vec3  p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n            return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n        }\n\n        //***** Cartoon Filter Functions *****/\n\n        // Averaged pixel intensity from 3 color channels\n        float avgIntensity(vec4 pix) {\n            return (pix.r + pix.g + pix.b) / 3.0;\n        }\n\n        // Returns pixel color\n        float isEdge(in vec2 coords) {\n            float dxtex = 1.0 / float(resolution.x); // textureSize(tDiffuse, 0));\n            float dytex = 1.0 / float(resolution.y); // textureSize(tDiffuse, 0));\n            float pix[9];\n            int   k = -1;\n            float delta;\n\n            // Read neighboring pixel intensities\n            for (int i = -1; i < 2; i++) {\n                for (int j = -1; j < 2; j++) {\n                    k++;\n                    pix[k] = avgIntensity(texture2D(tDiffuse, coords + vec2(float(i) * dxtex, float(j) * dytex)));\n                }\n            }\n\n            // Average color differences around neighboring pixels\n            delta = (abs(pix[1] - pix[7]) + abs(pix[5] - pix[3]) + abs(pix[0] - pix[8]) + abs(pix[2] - pix[6]) ) / 4.0;\n            return clamp((uEdgeStrength * 10.0) * delta, 0.0, 1.0);\n        }\n\n        void main() {\n            // Start\n            vec4 texel = texture2D(tDiffuse, vUv);\n\n            // Color Gradient\n            float clrs = 1.0 / uGradient;\n\n            // Toon\n            vec3 hsv = rgbToHsv(texel.rgb);\n            hsv.x = clamp(0.01 * (floor(hsv.x / 0.01)), 0.0, 1.0);\n            hsv.y = clamp(0.01 * (floor(hsv.y / 0.01)), 0.0, 1.0);\n            hsv.z = clamp(clrs * floor(hsv.z / clrs), 0.0, 1.0);\n            // hsv.z = clamp(clrs * (floor(hsv.z / clrs) + (1.0 * texel.a)), 0.0, 1.0);\n\n            vec3 rgb = hsvToRgb(hsv.xyz);\n\n            // Edge\n            float edge = (uEdgeStrength > 0.0) ? isEdge(vUv) : 0.0;\n            if (edge >= 0.1) { // edge threshold\n                rgb = mix(rgb, uEdgeColor, clamp(edge * 3.0, 0.0, 1.0));\n            }\n\n            // Final\n            texel.rgb = vec3(rgb.x, rgb.y, rgb.z);\n            gl_FragColor = texel;\n        }"},empty256=[];for(let e=0;e<256;e++)empty256.push(new THREE$1.Vector3);const DitherShader={name:"DitherShader",uniforms:{resolution:{value:new THREE$1.Vector2},fixedsize:{value:new THREE$1.Vector2},uCamera:{value:new THREE$1.Vector2},uCellSize:{value:new THREE$1.Vector2},tDiffuse:{value:null},uPaletteRgb:{value:[new THREE$1.Vector3(0,0,0),new THREE$1.Vector3(1,1,1),...empty256]},uPaletteSize:{value:2},uBias:{value:0}},vertexShader:"\n        varying vec2 vUv;\n        void main() {\n            vUv = uv;\n            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n        }",fragmentShader:"\n        #include <common>\n\n        uniform vec2 resolution;\n        uniform vec2 fixedsize;\n        uniform vec2 uCamera;\n        uniform vec2 uCellSize;\n        uniform sampler2D tDiffuse;\n        uniform vec3[256] uPaletteRgb;\n        uniform int uPaletteSize;\n        uniform float uBias;\n\n        varying vec2 vUv;\n\n        const int[64] ditherTable = int[](\n            0,  32, 8,  40, 2,  34, 10, 42,\n            48, 16, 56, 24, 50, 18, 58, 26,\n            12, 44, 4,  36, 14, 46, 6,  38,\n            60, 28, 52, 20, 62, 30, 54, 22,\n            3,  35, 11, 43, 1,  33, 9,  41,\n            51, 19, 59, 27, 49, 17, 57, 25,\n            15, 47, 7,  39, 13, 45, 5,  37,\n            63, 31, 55, 23, 61, 29, 53, 21\n        );\n\n        float euclideanDistance(vec3 clr1, vec3 clr2) {\n            vec3 diff = abs(clr1 - clr2);\n            vec3 sqrd = diff * diff;\n            return sqrt(diff.x + diff.y + diff.z);\n        }\n\n        float lumDistance(vec3 clr1, vec3 clr2) {\n            float l1 = luminance(clr1);\n            float l2 = luminance(clr2);\n            return abs(l1 - l2);\n        }\n\n        float colorDistance(vec3 clr1, vec3 clr2) {\n            float ld = lumDistance(clr1, clr2);\n            float ed = euclideanDistance(clr1, clr2);\n            return ((ld * 1.0) + (ed * 3.0)) / 4.0;\n        }\n\n        vec3[2] closestColors(vec3 color) {\n            vec3 closest = vec3(-10.0, -10.0, -10.0);\n            vec3 second = vec3(-10.0, -10.0, -10.0);\n            vec3 temp;\n            for (int i = 0; i < uPaletteSize; i++) {\n                temp = uPaletteRgb[i];\n                float distance = colorDistance(uPaletteRgb[i], color);\n                if (distance < colorDistance(closest, color)) {\n                    second = closest;\n                    closest = temp;\n                } else if (distance < colorDistance(second, color)) {\n                    second = temp;\n                }\n            }\n            return vec3[](closest, second);\n        }\n\n        vec3 stepColor(vec3 v) {\n            return floor(0.5 + (v * 4.0)) / 4.0;\n        }\n\n        vec3 dither(vec2 pos, vec3 color) {\n            int x = int(pos.x);\n            int y = int(pos.y);\n            float limit = (float(ditherTable[x + y * 8] + 1) / 64.0) + uBias;\n\n            vec3 cs[2] = closestColors(color);\n            float diff = colorDistance(color, cs[0]) / colorDistance(color, cs[1]);\n            vec3 resultColor = (diff < limit) ? cs[0] : cs[1];\n            return resultColor;\n        }\n\n        void main() {\n            vec4 texel = texture2D(tDiffuse, vUv);\n\n            // // Simple\n            // vec2 pos = gl_FragCoord.xy / uCellSize;\n\n            // // Camera Align\n            vec2 cell = resolution / (uCellSize * 8.0);\n            vec2 pixel = 1.0 / resolution;\n            vec2 ratio = resolution / fixedsize;\n            vec2 fract = pixel * mod(uCamera * ratio, (uCellSize * 8.0));\n            vec2 pos = mod((vUv + fract) * cell, 1.0) * 8.0;\n\n            texel.rgb = dither(pos, texel.rgb);\n            gl_FragColor = texel;\n        }\n        "},LevelsShader={name:"LevelsShader",uniforms:{tDiffuse:{value:null},hue:{value:0},saturation:{value:0},brightness:{value:0},contrast:{value:0},grayscale:{value:0},negative:{value:!1},bitrate:{value:1}},vertexShader:"\n        varying vec2 vUv;\n        void main() {\n            vUv = uv;\n            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n        }",fragmentShader:"\n        #include <common>\n        uniform sampler2D tDiffuse;\n\n        uniform float hue;\n        uniform float saturation;\n        uniform float brightness;\n        uniform float contrast;\n        uniform float grayscale;\n        uniform float negative;\n        uniform float bitrate;\n\n        varying vec2 vUv;\n\n        void main() {\n            vec4 texel = texture2D(tDiffuse, vUv);\n\n            // Hue\n            float angle = hue * 3.14159265;\n            float s = sin(angle), c = cos(angle);\n            vec3 weights = (vec3(2.0 * c, -sqrt(3.0) * s - c, sqrt(3.0) * s - c) + 1.0) / 3.0;\n            float len = length(texel.rgb);\n            texel.rgb = vec3(\n                dot(texel.rgb, weights.xyz),\n                dot(texel.rgb, weights.zxy),\n                dot(texel.rgb, weights.yzx)\n            );\n\n            // Saturation\n            float average = (texel.r + texel.g + texel.b) / 3.0;\n            if (saturation > 0.0) {\n                texel.rgb += (average - texel.rgb) * (1.0 - 1.0 / (1.001 - saturation));\n            } else {\n                texel.rgb += (average - texel.rgb) * (- saturation);\n            }\n\n            // Brightness\n            float bright = brightness * texel.a;\n            texel.rgb += bright;\n\n            // Contrast\n            float clarity = min(contrast * texel.a, 0.9999);\n            if (clarity > 0.0) {\n                texel.rgb = (texel.rgb - 0.5) / (1.0 - clarity) + 0.5;\n            } else {\n                texel.rgb = (texel.rgb - 0.5) * (1.0 + clarity) + 0.5;\n            }\n\n            // Grayscale\n            float l = luminance(texel.rgb);\n            texel = mix(texel, vec4(l, l, l, texel.a), grayscale);\n\n            // Negative\n            texel.rgb = mix(texel.rgb, (1.0 - texel.rgb) * texel.a, negative);\n\n            // Bitrate (0 to 256)\n            texel.rgb = floor(texel.rgb * bitrate) / bitrate;\n\n            // Final\n            gl_FragColor = texel;\n        }"},TEXTURE_SIZE=64,_sources={brick:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAIAAAAlC+aJAAAEyWlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNS41LjAiPgogPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iCiAgICB4bWxuczpleGlmPSJodHRwOi8vbnMuYWRvYmUuY29tL2V4aWYvMS4wLyIKICAgIHhtbG5zOnBob3Rvc2hvcD0iaHR0cDovL25zLmFkb2JlLmNvbS9waG90b3Nob3AvMS4wLyIKICAgIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIKICAgIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIgogICAgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIKICAgdGlmZjpJbWFnZUxlbmd0aD0iNjQiCiAgIHRpZmY6SW1hZ2VXaWR0aD0iNjQiCiAgIHRpZmY6T3JpZW50YXRpb249IjEiCiAgIHRpZmY6UmVzb2x1dGlvblVuaXQ9IjIiCiAgIHRpZmY6WFJlc29sdXRpb249IjcyLzEiCiAgIHRpZmY6WVJlc29sdXRpb249IjcyLzEiCiAgIGV4aWY6UGl4ZWxYRGltZW5zaW9uPSI2NCIKICAgZXhpZjpQaXhlbFlEaW1lbnNpb249IjY0IgogICBleGlmOkNvbG9yU3BhY2U9IjEiCiAgIHBob3Rvc2hvcDpDb2xvck1vZGU9IjMiCiAgIHBob3Rvc2hvcDpJQ0NQcm9maWxlPSJzUkdCIElFQzYxOTY2LTIuMSIKICAg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",cross:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAFy2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNS41LjAiPgogPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgeG1sbnM6ZXhpZj0iaHR0cDovL25zLmFkb2JlLmNvbS9leGlmLzEuMC8iCiAgICB4bWxuczpwaG90b3Nob3A9Imh0dHA6Ly9ucy5hZG9iZS5jb20vcGhvdG9zaG9wLzEuMC8iCiAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyIKICAgIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIKICAgIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIgogICAgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIKICAgZXhpZjpDb2xvclNwYWNlPSIxIgogICBleGlmOlBpeGVsWERpbWVuc2lvbj0iNjQiCiAgIGV4aWY6UGl4ZWxZRGltZW5zaW9uPSI2NCIKICAgcGhvdG9zaG9wOkNvbG9yTW9kZT0iMyIKICAgcGhvdG9zaG9wOklDQ1Byb2ZpbGU9InNSR0IgSUVDNjE5NjYtMi4xIgogICB0aWZmOkltYWdlTGVuZ3RoPSI2NCIKICAgdGlmZjpJbWFnZVdpZHRoPSI2NCIKICAgdGlmZjpSZXNvbHV0aW9uVW5pdD0iMiIKICAgdGlmZjpYUmVzb2x1dGlvbj0iNzIvMSIKICAgdGlmZjpZUmVzb2x1dGlvbj0iNzIvMSIKICAgeG1wOk1ldGFkYXRhRGF0ZT0iMjAyMy0w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",knit:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAVCAYAAAAnzezqAAAEsWlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNS41LjAiPgogPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgeG1sbnM6ZXhpZj0iaHR0cDovL25zLmFkb2JlLmNvbS9leGlmLzEuMC8iCiAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyIKICAgIHhtbG5zOnBob3Rvc2hvcD0iaHR0cDovL25zLmFkb2JlLmNvbS9waG90b3Nob3AvMS4wLyIKICAgIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIKICAgIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIgogICAgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIKICAgZXhpZjpQaXhlbFhEaW1lbnNpb249IjMyIgogICBleGlmOlBpeGVsWURpbWVuc2lvbj0iMjEiCiAgIGV4aWY6Q29sb3JTcGFjZT0iMSIKICAgdGlmZjpJbWFnZVdpZHRoPSIzMiIKICAgdGlmZjpJbWFnZUxlbmd0aD0iMjEiCiAgIHRpZmY6UmVzb2x1dGlvblVuaXQ9IjIiCiAgIHRpZmY6WFJlc29sdXRpb249IjcyLzEiCiAgIHRpZmY6WVJlc29sdXRpb249IjcyLzEiCiAgIHBob3Rvc2hvcDpDb2xvck1vZGU9IjMiCiAgIHBob3Rvc2hvcDpJQ0NQcm9maWxlPSJzUkdCIElFQzYxOTY2LTIuMSIKICAgeG1wOk1vZGlmeURhdGU9IjIwMjMtMDct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",tile:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAEsWlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNS41LjAiPgogPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgeG1sbnM6ZXhpZj0iaHR0cDovL25zLmFkb2JlLmNvbS9leGlmLzEuMC8iCiAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyIKICAgIHhtbG5zOnBob3Rvc2hvcD0iaHR0cDovL25zLmFkb2JlLmNvbS9waG90b3Nob3AvMS4wLyIKICAgIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIKICAgIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIgogICAgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIKICAgZXhpZjpQaXhlbFhEaW1lbnNpb249IjMyIgogICBleGlmOlBpeGVsWURpbWVuc2lvbj0iMzIiCiAgIGV4aWY6Q29sb3JTcGFjZT0iMSIKICAgdGlmZjpJbWFnZVdpZHRoPSIzMiIKICAgdGlmZjpJbWFnZUxlbmd0aD0iMzIiCiAgIHRpZmY6UmVzb2x1dGlvblVuaXQ9IjIiCiAgIHRpZmY6WFJlc29sdXRpb249IjcyLzEiCiAgIHRpZmY6WVJlc29sdXRpb249IjcyLzEiCiAgIHBob3Rvc2hvcDpDb2xvck1vZGU9IjMiCiAgIHBob3Rvc2hvcDpJQ0NQcm9maWxlPSJzUkdCIElFQzYxOTY2LTIuMSIKICAgeG1wOk1vZGlmeURhdGU9IjIwMjMtMDctMjBUMTM6NDg6MzctMDc6MDAiCiAgIHhtcDpNZXRhZGF0YURhdGU9IjIwMjMtMDctMjBUMTM6NDg6MzctMDc6MDAiPgogICA8eG1wTU06SGlzdG9yeT4KICAgIDxyZGY6U2VxPgogICAgIDxyZGY6bGkKICAgICAgc3RFdnQ6YWN0aW9uPSJwcm9kdWNlZCIKICAgICAgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWZmaW5pdHkgUGhvdG8gMiAyLjAuMCIKICAgICAgc3RFdnQ6d2hlbj0iMjAyMy0wNy0yMFQxMzo0ODozNy0wNzowMCIvPgogICAgPC9yZGY6U2VxPgogICA8L3htcE1NOkhpc3Rvcnk+CiAgPC9yZGY6RGVzY3JpcHRpb24+CiA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgo8P3hwYWNrZXQgZW5kPSJyIj8+CBb9VgAAAYFpQ0NQc1JHQiBJRUM2MTk2Ni0yLjEAACiRdZHLS0JBFIc/tTDKKMhFiyAJa2VhBlGbICUqiBAz6LXR6ytQu9yrhLQN2goFUZtei/oLahu0DoKiCKJtrYvaVNzOVUGJPMOZ881v5hxmzoA1nFYyeoMXMtmcFpr0uxYWl1z2F+w46cBBd0TR1fFgcIa69nmPxYy3/Wat+uf+tZZYXFfA0iQ8pqhaTnhKeGY9p5q8I+xUUpGY8JmwR5MLCt+ZerTMryYny/xtshYOBcDaLuxK1nC0hpWUlhGWl+POpPNK5T7mSxzx7PycxB7xLnRCTOLHxTQTBBhmkFGZh+nHx4CsqJPvLeXPsia5iswqBTRWSZIih0fUvFSPS0yIHpeRpmD2/29f9cSQr1zd4YfGZ8N47wX7NvwUDePryDB+jsH2BJfZav7aIYx8iF6sau4DaNuE86uqFt2Fiy3ofFQjWqQk2cStiQS8nULrInTcQPNyuWeVfU4eILwhX3UNe/vQJ+fbVn4BPf5n0/P+XOAAAAAJcEhZcwAACxMAAAsTAQCanBgAAAJaSURBVEiJhZZBbhsxDEWfOEoMZNFNT9Ib5go9Ute9SLYFWhSJMWIXtuhPSkEFYyBLJP8nRVJq319fn+CEBs59NBjQoAGyHsN3f1tefIYP6M/wbf4JiZaV206/zS0VaGDQ4AWu8AP6FZ7gK/zZSSuGwmwpGxzQocEXeIMrdIMP+A1/wcSiTy7/dUKdvgF0OOAdGvTYtqxvk3WxvmIYDPHApq7NxRR6z8oxAmbMr8/JEJl10tWEZwzPsT7nfGRJ5XTmwAJ9y1qDozAuW8VLzQhNis4S3HKwiEKoWQZuWYxZRoCF2hCjJZrtk5+SKEiRkN3ztgZ9W65jKg/ZikgWvx9IbabXWI5EdYLEkMw2MeeZPnHIvuPeBGMF063b1zIYAn/3t3Bfa6rEUGtim7UpROvwHOg1Z1ZfQyAMdl90ioJOfCbolpMmZMxNaycmpQ+zbG1Hk8OIYaWSS0CADgZnTo9tJ/cdSwtD0T6PzDpMt50fisRM9PaJN7XKNRSRf2M5Ks39kbs30U3XTlvAhvhUwlicOMsZFC6qoI2+XKXbNIt2kM4AEXIxFxH03S7ZtJZLkTEEMHSK1y6TWI9eVCyonfvZFCtt97UlJg7nvOZW60gMHqyLv5bL6ph3eiFYriM15XqjMavcRCLqWR03gTThHk8KLZoexWXQwRv4A19fSgVVnQiKNh095uLdgwOebgpeW1OpybU5NimuY7664m7oDhd4ycmjZNvOqGXhGDZfdi/w63YGHd7hTZ495cx1lMVtud24X+ADnqG/w8/5fCcHl7yygrlolfY+4AJX+AddcvRRAxRgJAAAAABJRU5ErkJggg==",woven:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAFX2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNS41LjAiPgogPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgeG1sbnM6ZXhpZj0iaHR0cDovL25zLmFkb2JlLmNvbS9leGlmLzEuMC8iCiAgICB4bWxuczpwaG90b3Nob3A9Imh0dHA6Ly9ucy5hZG9iZS5jb20vcGhvdG9zaG9wLzEuMC8iCiAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyIKICAgIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIKICAgIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIgogICAgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIKICAgZXhpZjpDb2xvclNwYWNlPSIxIgogICBleGlmOlBpeGVsWERpbWVuc2lvbj0iNjQiCiAgIGV4aWY6UGl4ZWxZRGltZW5zaW9uPSI2NCIKICAgcGhvdG9zaG9wOkNvbG9yTW9kZT0iMyIKICAgcGhvdG9zaG9wOklDQ1Byb2ZpbGU9InNSR0IgSUVDNjE5NjYtMi4xIgogICB0aWZmOkltYWdlTGVuZ3RoPSI2NCIKICAgdGlmZjpJbWFnZVdpZHRoPSI2NCIKICAgdGlmZjpPcmllbnRhdGlvbj0iMSIKICAgdGlmZjpSZXNvbHV0aW9uVW5pdD0iMiIKICAgdGlmZjpYUmVzb2x1dGlvbj0iNzIvMSIKICAgdGlmZjpZUmVzb2x1dGlvbj0iNzIvMSIKICAgeG1wOk1ldGFkYXRhRGF0ZT0iMjAyMy0wNy0yMFQxNDoxMzozNC0wNzowMCIKICAgeG1wOk1vZGlmeURhdGU9IjIwMjMtMDctMjBUMTQ6MTM6MzQtMDc6MDAiPgogICA8eG1wTU06SGlzdG9yeT4KICAgIDxyZGY6U2VxPgogICAgIDxyZGY6bGkKICAgICAgeG1wTU06YWN0aW9uPSJwcm9kdWNlZCIKICAgICAgeG1wTU06c29mdHdhcmVBZ2VudD0iQWZmaW5pdHkgRGVzaWduZXIgKFNlcCAyMiAyMDE5KSIKICAgICAgeG1wTU06d2hlbj0iMjAyMC0wMi0xMlQyMDoyMTozOS0wNTowMCIvPgogICAgIDxyZGY6bGkKICAgICAgc3RFdnQ6YWN0aW9uPSJwcm9kdWNlZCIKICAgICAgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWZmaW5pdHkgUGhvdG8gMiAyLjAuMCIKICAgICAgc3RFdnQ6d2hlbj0iMjAyMy0wNy0yMFQxNDoxMzozNC0wNzowMCIvPgogICAgPC9yZGY6U2VxPgogICA8L3htcE1NOkhpc3Rvcnk+CiAgPC9yZGY6RGVzY3JpcHRpb24+CiA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgo8P3hwYWNrZXQgZW5kPSJyIj8++iZIrwAAAYFpQ0NQc1JHQiBJRUM2MTk2Ni0yLjEAACiRdZHLS0JBFIc/tTDKKMhFiyAJa2VhBlGbICUqiBAz6LXR6ytQu9yrhLQN2goFUZtei/oLahu0DoKiCKJtrYvaVNzOVUGJPMOZ881v5hxmzoA1nFYyeoMXMtmcFpr0uxYWl1z2F+w46cBBd0TR1fFgcIa69nmPxYy3/Wat+uf+tZZYXFfA0iQ8pqhaTnhKeGY9p5q8I+xUUpGY8JmwR5MLCt+ZerTMryYny/xtshYOBcDaLuxK1nC0hpWUlhGWl+POpPNK5T7mSxzx7PycxB7xLnRCTOLHxTQTBBhmkFGZh+nHx4CsqJPvLeXPsia5iswqBTRWSZIih0fUvFSPS0yIHpeRpmD2/29f9cSQr1zd4YfGZ8N47wX7NvwUDePryDB+jsH2BJfZav7aIYx8iF6sau4DaNuE86uqFt2Fiy3ofFQjWqQk2cStiQS8nULrInTcQPNyuWeVfU4eILwhX3UNe/vQJ+fbVn4BPf5n0/P+XOAAAAAJcEhZcwAACxMAAAsTAQCanBgAAA1gSURBVHiclZtNjGVFFcd/dV/d1/2633zBzCCTGWwyKkSJHyQQxI80cYHBGBMXGDWR58KVcWUgcanix06JG5TEvEQXJrpAQlAWJh3UhSTyoQIzYmAYh6+xh0z3TPf7vK9c3Hu6zz2v6nZTye17u27dOuf8z0dVnarn3ErfeWACLlvl7vvhiZPAMtAB2tWVqctVd11CdZ9Vz7PqmgJjYARsweQSfOfH8JMr/d6s3T+XTaHjYTqGOz8L37sDbrkWDnYgW6xo++rS9F2EttAtKrpCewhsQ1iH4Z/h8TX4URvOTGGUud2+3K2wvAwsVFcbyCuiHmhVlzCUV5dXd90uq+4C4mIJ7BcOwwn655yHMOutbI17KyPgb+fh7Dq4AbhhBdqoEmJcKmnnmppL6nXbkboGwNvAK/Ar4Plxb2WQQfAz6CzCYAJLx+DTBxTDIoygL4KJBVgtyCVaQLXJyzrXgfd/Dh58GH64Defpn5tVze64ADedB99V30lfwovwofvWtLX2BZCrwDrwKrjzYtD9c0xh2d8Ej5yF3wGfbMO9YvZa+Ja59gOAvCtUfV6adeco3H4Xaz84Bk8fhnEXTufw0UPwvha0D4BbZNeyROgsQlvTDMy7ibhqBu428DfD/dvQvQjFm/Bx962VfngDeAX40Cp8BjhA6QJ5RVjMuxUhkAJAa0Kb6AAmr8OVrVU2D8F4CcIi5DkcyOGAh4UMnHYj0bal65TgFgiJP4W6phAGMBnAcADDDQj+RuBa4BhwUCEul6fu23sFIgl+mknNXAv8QTi4DEsdKKo4k3nIW9BqVcILPa1JZ/5PCS51AoDcfdl3noPvlPTxy0owCXra/G1ws4zoEhLMCkNVn26h6k6ifKXtHa3rqG+F1vcYAPq5VQkv96Ki48GNIMsAv6g6037eJLz1f11EM7aIW8io0CqB2OnXM29tjjgAGvyUC2h5Jup7uajqfFt1JMGmyeRj5m9LMO1FQAFAA2tpyjsTwOaAQL3TwmfU3K3mijHL9W12hw+LUgz1WEeicUc9Fggz0lY0klO3Ng2A1v5+ANDad5Fnz3yR+gB40YygLndNqAkIKziJdtKXFlqA1iDErC7lBlA3eeFjpp5jcwXh1QNeox8TVvt7CgBddCAMxEHQVmYtQU90mkBAtYnNP7SgEg9ibuI1I9qUY2Zn1wEaAEE8Y1crTUOYvewEqyn4WQuwYGgBdZ2WU+q8ZiimsSaz32skaIodqXizV8yJ8ZEq8s6Cren7FNrWXGMmmCKutSAWoQXU64T9CkrkmxQPwbxrsiivGxBpYAnvZxjUQsf6TPUdE7bpvW6jg6CuszR2/5Zv50aJJhONmb8QjfWjfbFJiBQPWsD9lBQf+p0zNZn9QHdmhw37LkU09i7WTjP4bvp/N2Wed1er93YIkcWMBUCirZ2EaDxtZiY2R5+ZdrErZtZSNGAxBTUBV9Iuam28ZTK1uHDME9PMpYRp6l+7iAVGF+3buo3mSfMWWx/EeNgBQGs49qFjnvEYo00gxBiZEQfC+qW2Th1QbV8x4WP0NR9eVmmyFohpTAsnhGPBo0ngmEW5im5GnTGoB0099GpAYjRj/IuMM/McAK+zNnZaGYsPUNdGEwBNmhChJHMTG9+daRcbRlP8xoQvmAfC65SVTFJiLqCHtVjRlpIydfnfJkz1s569yV0sz85FaBBc09VKLky916lkn+iIyP8pEPZiqKAE28aWYPrRWR+reWkbiwP2WecmTX6QCeAl/z6kXCjIS1mdaZONBcGmkUCDok1Q8vqO3ZWfjeDlyjBjxizpDrp9DIS9hB9VAMwGwGVgGdwUnGY0A5wDF+Y1QOTZalsTnFb1YgFQJkdEYA2Wx5FVwjdlpJqywjohGhN+BPgNuLoBxQVwxyF/L7SLMja4DJhUEgsBm62xFhAzvalhYAiMIRQQ2pQpeE+ZrBTLKwhzeUGbpdrL9wuSwocBzMYQ/Fk4+yacW4NT98LRMRxuw8EC8ik4F+raFRewK8LYWJsAIFyF4i2YHIFJF+hA1oZ2u8xPZJKgcdQzVDYAarra7azmZY9wUoI/G8L4Cmxcglf8r+FnU3gCuG8KXx1DMS1z9D4rrb9GLLY40u9jABT1e7EBG7+Ff6/AmaPQXoSXgXtOwYevg4UuZcY4p5Y2r40IFnwpesQRNx4B28AGhJdh/F94awN+8xr83E/h0WXY2oI/vgNf2YJRB0YeljPIUgDYiVDK//U1gdkIRgN46TX47mvwNLuh4R/3wcPHyn2alt2RsrlCAcAGYLuKlaBZ7XfOtmH7T/A48H1g6B0MJ2UfrauwOYRrRhA88+Y2U4zElqsaeeuH01ITYUiYbOCeBP7ageGg1wsAp/v9Z07A5WU4vAAtsQCbKLV5BQtAoeqse04hnITBNfCLyzDIwHm3ynTc7wV6/TOb8NQmfPEAZHZfTneUygjForA2w3Kb2oUNeI41JgW4vNdj0u+HDmuhy+42emxT1lpfbDpsM06h6kuCbRcm7VXWq1jWylrQotd3wOwFeP4SLA1gcQRZFa2ZMB9NYxHWTjmt8CNwG5Cdh0OoiE+vl3XhlmVYXlD1sZ2q2HmE3PxvN13k+za4DiwdgI9V+BR+Cl/P4QUHSxl84204eqo8M5DJJAXqe/SpmZmdgBTszjIHwBa4S7DwLHwZeHYA/6k+fW8OX1uAbg4tvTcZO3SRcj+7ZpAiFtmGbAm6XXgA2G7DWf9t1h46BLNOaSI+h3yxHJZquzip1ZkV3q7rpW0b6IA7Ae1vwie24KGL8PunYHgJPr8MdyzCUqsC3u4YWQBiwdkO09pFfKkUtwQLK3DbzfDL6+BV/4FS26E6FOG06eh8vV6k2KxQai4+VfeC8tzRIciOw6EBrJ6CT50A3oLsILRkDtC0Ods0BGsL1MLvzi4hh9at0OnADR046btlpYsFndiO8F6rMQzBqbrnVAsQcDn4hWp7/njFtOwWx8xfK4MIALpYBQk/YtHXlPRbC9DyOuJmzAcRK/y7WY7KbrDkGgpDQ1uaXoA1nQqzz1Jm6lnzKf0V6lmOAS1Q+nxN43rsjQkfWwekFiTabKfEBZK+5L3wEaMZAyOofnQM0HOBjDoYcgoux2yOagBSWtcX1KemInimnm17KXYxI3zE6NnIH7MCO/mxexLShxzQ2IkvqYirMzIxbWjCevix+YOmNLpOwFg6MdqxNrak0mdyybJ7x+VTw02qgxgAsfm4dQU7W9OJkFwxn4o7satWKqLW6mL91Q59xqaZTdqPAaD9zpr1zLRLgdGktX0BEHZ5TvVl3SpDnQ9ILTaatCFFE52pOu0CWtDMvNdAJQOvo5aVSrkAsW9Ve1vvLSIpQffSgF2rpxhqMu2Yhnbqwm699LkXANYaYtY9dz6gydw0UctAbAmaAsH2acFvCn6Y5yYA9LOdHu/UpTqzQu9FvKld6p3tywZTG2BTpendXu0yW5HS4H5KEzD77dMKH3C1HMP8+/p3qQSpTpXpEjtGN8eQI+3fMcZt/X6+sczGBBU+Uv1KXVMfth8fa6BLkwalo5jQMe1YYWPMWzAyQq1Om2wMkJjgMUDkGx8zGTvOp0oK4aZ31kxjJhpr70y/WvgUPZubiMnqLQN2Dq2HniYQUsgTETLlpymAZH6hh7UUH/t1K+ln53xAatyPzaz0mJ8S3P6v84SaKZtbnAfEEZQbpIqlnbImobEzEbLC2zE4JOr0c1NOILVHYBOqOtFqF0mx+CQ8oOpT7qfT9QKAbAR7SSHDvAWI4FpgPZMSYntZgd0dsnt1cllgynVDqAXMmDtqcLT1aEvT6bmddYAFQBedVNAWYBMOqWSIZkB2hi0IkjKX3xV2VBvJJGmFaKsQwXWJ0TbbckxVf1CdEImZbFNKTFvCXgCUgrqKiRAVXs4oaCvQx2akiDsGUy/vtOD65IsGfay+D4AfQeEpt8IKyDy4GeUZgdTOrL6aovcu+qFm2mMIYwhDCCPgKrhtcAfBxbQvfdrlup0H2JgT25wdlc9hBqENwW/BZhtmVYpoYQYLsjMs/mKFTyVFbRSO7RxVwk+HMB7AdBPCOrQ2oH0c8m6phJqgImBsX8BF6Kd2ryYQBlBsw2QK0wUI/g240IXJErTL3+25I+1yZ7jVIiR3Za1p6jl7IMz5XbU3zwCKLRhchTcuwovrMDsLK4tw8iNwZAxtT3k4I6v1X88lxFzADq+RMwKzqzB8CTYPl5uk+AdZ+2mAfy7Cl+6Eu94Di6dg8VrIOuDsT+msRdRBqGte/K8SnMsQXobpv+DtF+HBAh6D1Qw4eRoeuFL+rjgXAHT/U1wlfIgCYCO/3qeshA9jKDZh+0l4bhPWboTb/RAeBTZGsPEHuOkeuP4kBD1Z0HnDmB9qJiTtVZh2gXJnqAvhdThXwGP0z12BPvR6V9bhkXfg7mPQtXuQ5fdhLnmqS2zmp0+HVIckZu/AxfXybMAzZ+FO7+CWDP6eQfsQbN0A7gi4Jcptar1P3yQ81KfROtcoDBbAdcAH4dhf4HrfW9kqWG07yDfg9CXIttj99ap8p38/rOckTQBo4Yfs/ISe/8EF4Ey7fH3+/wvUPJeZaLwzAAAAAElFTkSuQmCC"},PixelatedShader={name:"PixelatedShader",uniforms:{resolution:{value:new THREE$1.Vector2},fixedsize:{value:new THREE$1.Vector2},uCamera:{value:new THREE$1.Vector2},uCellSize:{value:new THREE$1.Vector2},tDiffuse:{value:null},tPixel:{value:null},uDiscard:{value:0}},vertexShader:"\n        varying vec2 vUv;\n        void main() {\n            vUv = uv;\n            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n        }",fragmentShader:"\n        #include <common>\n\n        uniform vec2 resolution;\n        uniform vec2 fixedsize;\n        uniform vec2 uCamera;\n        uniform vec2 uCellSize;\n        uniform sampler2D tDiffuse;\n        uniform sampler2D tPixel;\n        uniform float uDiscard;\n\n        varying vec2 vUv;\n\n        void main() {\n            vec2 cell = fixedsize / uCellSize;\n            vec2 grid = 1.0 / cell;\n            vec2 pixel = 1.0 / fixedsize;\n\n            // Camera Offset\n            vec2 fract = pixel * mod(uCamera, uCellSize);\n\n            // Pattern Pixel\n            //\n            //  +1.0┏━━━━━━━━━━┓\n            //      ┃       255┃        Blue Layer, Y Offset\n            //      ┃     192  ┃\n            //  +0.0┃   128    ┃\n            //      ┃ 64       ┃\n            //      ┃0         ┃        Green Layer, X Offset\n            //  -1.0┗━━ +0.0 ━━┛+1.0\n            //\n            // NOTE: 128 != 255/2.0, so apply adjustment (i.e. 128 * 0.99609375 == 127.5)\n            //\n            vec2 patternUV = mod((vUv + fract) * cell, 1.0);\n            vec4 pattern = texture2D(tPixel, patternUV);\n            vec2 offset;\n            float l = luminance(vec3(pattern.r));                           // r, grayscale\n            offset.x = grid.x * ((pattern.g * 0.99609375 * 2.0) - 1.0);     // g, x offset\n            offset.y = grid.y * ((pattern.b * 0.99609375 * 2.0) - 1.0);     // b, y offset\n\n            // Image Pixel\n            vec2 pixelUV = grid * (0.5 + floor((vUv + fract) / grid));\n            pixelUV -= fract;\n            pixelUV += offset;\n            vec4 pixelized = texture2D(tDiffuse, pixelUV);\n\n            // Too Dark?\n            float darkness = luminance(pixelized.rgb);\n            if (darkness < uDiscard) discard;\n\n            gl_FragColor = vec4(l * pixelized.rgb * pattern.a, pattern.a);\n        }",createStyleTexture:function(e){const t=document.createElement("canvas");t.width=TEXTURE_SIZE,t.height=TEXTURE_SIZE;const i=new THREE$1.CanvasTexture(t,void 0,THREE$1.RepeatWrapping,THREE$1.RepeatWrapping,THREE$1.NearestFilter,THREE$1.NearestFilter),n=t.getContext("2d");if(n.clearRect(0,0,TEXTURE_SIZE,TEXTURE_SIZE),_sources[e]){const t=document.createElement("img");t.onload=()=>{n.clearRect(0,0,TEXTURE_SIZE,TEXTURE_SIZE),n.drawImage(t,0,0,TEXTURE_SIZE,TEXTURE_SIZE),i.needsUpdate=!0},t.src=_sources[e]}else n.fillStyle="#ff8080",n.fillRect(0,0,TEXTURE_SIZE,TEXTURE_SIZE),i.needsUpdate=!0;return i}};class Post{init(e={}){let t;switch(e.style){case"ascii":t=new PixelPerfectPass(AsciiShader,e.textSize,e.textSize),t.uniforms.tCharacters.value=AsciiShader.createCharactersTexture(e.characters),t.uniforms.uCharacterCount.value=e.characters.length,t.uniforms.uColor.value.set(e.textColor);break;case"bloom":t=new SelectiveBloomPass(e.strength,e.radius,e.threshold);break;case"cartoon":t=new ShaderPass(CartoonShader),t.uniforms.uEdgeColor.value.set(e.edgeColor),t.uniforms.uEdgeStrength.value=e.edgeStrength,t.uniforms.uGradient.value=e.gradient,t.setSize=function(e,i){t.uniforms.resolution.value.x=e,t.uniforms.resolution.value.y=i};break;case"dither":t=new PixelPerfectPass(DitherShader,e.scale,e.scale);const i=AssetManager$1.getAsset(e.palette);if(i&&i.isPalette){const e=i.colors;if(e&&e.length>0){const i=Math.min(e.length,256),n=[];for(let t=0;t<256;t++)n.push(new THREE.Color(t<i?e[t]:0));t.uniforms.uPaletteRgb.value=n,t.uniforms.uPaletteSize.value=i}}t.uniforms.uBias.value=e.bias;break;case"edge":t=new ShaderPass(SobelOperatorShader),t.setFixedSize=function(e,i){t.uniforms.resolution.value.x=e,t.uniforms.resolution.value.y=i};break;case"levels":t=new ShaderPass(LevelsShader),t.uniforms.brightness.value=e.brightness,t.uniforms.contrast.value=e.contrast,t.uniforms.saturation.value=e.saturation,t.uniforms.hue.value=e.hue,t.uniforms.grayscale.value=e.grayscale,t.uniforms.negative.value=e.negative,t.uniforms.bitrate.value=Math.pow(2,e.bitrate);break;case"pixel":t=new PixelPerfectPass(PixelatedShader,e.cellSize[0],e.cellSize[1]),t.uniforms.tPixel.value=PixelatedShader.createStyleTexture(e.cellStyle),t.uniforms.uDiscard.value=e.cutOff;break;case"tint":t=new ShaderPass(ColorifyShader),t.uniforms.color.value.set(e.color);break;default:console.error(`Post Component: Invalid style '${e.style}'`)}this.backend=t,this.data=e}dispose(){const e=this.backend;if(e&&e.uniforms)for(const t in e.uniforms){const i=e.uniforms[t];i&&i.value&&i.value.isTexture&&"function"==typeof i.value.dispose&&i.value.dispose()}}}Post.config={schema:{style:[{type:"select",default:"levels",select:["ascii","bloom","cartoon","dither","edge","levels","pixel","tint"]}],divider:{type:"divider"},textSize:{type:"slider",default:16,min:4,max:64,step:1,precision:0,if:{style:["ascii"]}},textColor:{type:"color",default:16777215,if:{style:["ascii"]}},characters:{type:"string",default:" .,•:-+=*!?%X0#@",if:{style:["ascii"]}},threshold:{type:"slider",default:0,min:0,max:1,step:.05,precision:2,if:{style:["bloom"]}},strength:{type:"slider",default:1,min:0,max:3,step:.1,precision:2,if:{style:["bloom"]}},radius:{type:"slider",default:0,min:0,max:1,step:.05,precision:2,if:{style:["bloom"]}},edgeColor:{type:"color",default:0,if:{style:["cartoon"]}},edgeStrength:{type:"slider",default:0,min:0,max:1,precision:2,if:{style:["cartoon"]}},gradient:{type:"slider",default:5,min:2,max:32,step:1,precision:0,if:{style:["cartoon"]}},palette:{type:"asset",class:"palette",if:{style:["dither"]}},bias:{type:"slider",default:.25,min:-1,max:1,precision:2,step:.05,if:{style:["dither"]}},scale:{type:"slider",default:1,min:1,max:9,precision:2,step:1,if:{style:["dither"]}},bitrate:{type:"slider",promode:!0,default:8,min:0,max:8,step:1,precision:0,if:{style:["levels"]}},hue:{type:"angle",default:0,min:-360,max:360,if:{style:["levels"]}},saturation:{type:"slider",default:0,min:-1,max:1,step:.1,precision:2,if:{style:["levels"]}},brightness:{type:"slider",default:0,min:-1,max:1,step:.1,precision:2,if:{style:["levels"]}},contrast:{type:"slider",default:0,min:-1,max:1,step:.1,precision:2,if:{style:["levels"]}},grayscale:{type:"slider",default:0,min:0,max:1,step:.1,precision:2,if:{style:["levels"]}},negative:{type:"boolean",default:!1,if:{style:["levels"]}},cellStyle:{type:"select",default:"none",select:["none","brick","cross","knit","tile","woven"],if:{style:["pixel"]}},cellSize:{type:"vector",default:[8,8],size:2,tint:!0,aspect:!0,label:["x","y"],min:[1,1],max:[1e3,1e3],precision:[2,2],if:{style:["pixel"]}},cutOff:{type:"slider",promode:!0,default:0,min:0,max:1,step:.05,precision:2,if:{style:["pixel"]}},color:{type:"color",default:16711680,if:{style:["tint"]}}},icon:"",color:"rgb(64, 64, 64)",multiple:!0,dependencies:[],group:["World3D"]},ComponentManager.register("post",Post);export{App,AssetManager$1 as AssetManager,BasicLine,BasicWireBox,BasicWireframe,Camera3D,CameraUtils,CapsuleGeometry,Clock,ColorChange,ComponentManager,CylinderGeometry,DragControls,DrivingControls,Entity3D,EntityPool,EntityUtils,FatLine,FatWireBox,FatWireframe,FollowCamera,GeometryUtils,GpuPickerPass,Iris,KeyControls,Light3D,Maths,MoveCamera,ObjectUtils,OrbitControls,OrbitEntity,Palette,PrismGeometry,Project,RenderUtils,Renderer3D,RotateEntity,SVGBuilder,SceneManager,Script$1 as Script,SkyObject,Stage3D,Strings,System,Vectors,World3D,ZigZagControls};
